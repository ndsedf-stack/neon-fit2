<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>NEON FIT // OPÉRATIONS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700;800;900&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="program-data-v2.js"></script>
  <script src="app-v2.js"></script>
  
  <style>
    :root { 
      --void: #020408;
      --cyan: #22d3ee;
      --cyan-dim: #06b6d4;
      --purple: #c084fc;
      --magenta: #ff2d95;
    }
    
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      background-color: var(--void);
      font-family: 'Inter', sans-serif;
      color: #f8fafc;
      overflow-x: hidden;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    .font-hud { font-family: 'Chakra Petch', sans-serif; }
    
    /* ========== NEBULAS & GRAIN ========== */
    .nebula {
      position: fixed;
      width: 800px;
      height: 800px;
      border-radius: 50%;
      filter: blur(150px);
      opacity: 0;
      z-index: 0;
      pointer-events: none;
      animation: nebulaFade 2s ease-out 0.5s forwards;
    }
    
    @keyframes nebulaFade {
      to { opacity: 0.15; }
    }
    
    .nebula.cyan { 
      top: -20%; 
      left: -20%; 
      background: #164e63; 
    }
    
    .nebula.purple { 
      bottom: -20%; 
      right: -20%; 
      background: #581c87;
      animation-delay: 0.7s;
    }
    
    .grain-overlay {
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      z-index: 999;
      mix-blend-mode: screen;
    }
    
    /* ========== HEADER ========== */
    header {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 40;
      background: rgba(2, 4, 8, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      padding-top: env(safe-area-inset-top);
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
    }
    
    /* ========== TIMELINE ========== */
    .timeline-container { 
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding: 0 16px;
      gap: 8px;
      scrollbar-width: none;
      margin-bottom: 12px;
      -webkit-overflow-scrolling: touch;
    }
    
    .timeline-container::-webkit-scrollbar { display: none; }
    
    /* WEEK CHIPS */
    .week-chip { 
      scroll-snap-align: center;
      flex: 0 0 auto;
      width: 56px;
      height: 64px;
      background: rgba(255,255,255,0.005);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
      border-top: 1px solid rgba(255,255,255,0.15);
      border-radius: 16px;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform: translateZ(0);
      cursor: pointer;
      box-shadow: 0 4px 20px -4px rgba(0,0,0,0.3);
      opacity: 0;
      animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .week-chip:nth-child(1) { animation-delay: 0.05s; }
    .week-chip:nth-child(2) { animation-delay: 0.10s; }
    .week-chip:nth-child(3) { animation-delay: 0.15s; }
    .week-chip:nth-child(4) { animation-delay: 0.20s; }
    .week-chip:nth-child(5) { animation-delay: 0.25s; }
    .week-chip:nth-child(n+6) { animation-delay: 0.30s; }
    
    .week-chip:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 30px -4px rgba(34, 211, 238, 0.3);
    }
    
    .week-chip:active { 
      transform: scale(0.95);
      transition: transform 0.1s;
    }
    
    .week-chip.active { 
      background: rgba(34, 211, 238, 0.1);
      border-color: var(--cyan);
      box-shadow: 0 0 30px rgba(34, 211, 238, 0.4), 0 8px 25px -4px rgba(0,0,0,0.5);
      transform: scale(1.1);
    }
    
    .week-chip.active:hover {
      transform: translateY(-4px) scale(1.12);
    }
    
    .week-chip.deload { 
      border-color: rgba(34, 197, 94, 0.4);
      color: #22c55e;
    }
    
    .week-chip.deload.active { 
      background: rgba(34, 197, 94, 0.1);
      border-color: #22c55e;
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
    }
    
    .week-chip.peak { 
      border-color: rgba(168, 85, 247, 0.4);
      color: #a855f7;
    }
    
    .week-chip.peak.active { 
      background: rgba(168, 85, 247, 0.1);
      border-color: #a855f7;
      box-shadow: 0 0 30px rgba(168, 85, 247, 0.4);
    }
    
    /* ========== BLOCK INFO BANNER ========== */
    .block-info-banner {
      background: rgba(255, 255, 255, 0.005);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 12px;
      margin: 0 16px 12px;
      transition: all 0.3s ease;
      cursor: pointer;
      opacity: 0;
      animation: fadeInDown 0.6s ease-out 0.3s forwards;
    }
    
    .block-info-banner:hover {
      background: rgba(255, 255, 255, 0.02);
      border-color: rgba(255,255,255,0.12);
      transform: translateY(-2px);
    }
    
    .block-info-banner:active {
      transform: scale(0.98);
    }
    
    /* ========== GLASS CARDS ========== */
    .glass-card {
      background: rgba(255, 255, 255, 0.005);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      opacity: 0;
      transform: translateY(30px);
      animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .glass-card:nth-child(1) { animation-delay: 0.4s; }
    .glass-card:nth-child(2) { animation-delay: 0.5s; }
    .glass-card:nth-child(3) { animation-delay: 0.6s; }
    .glass-card:nth-child(4) { animation-delay: 0.7s; }
    .glass-card:nth-child(5) { animation-delay: 0.8s; }
    
    .glass-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 60px -10px rgba(34, 211, 238, 0.3);
      border-color: rgba(34, 211, 238, 0.3);
    }
    
    .glass-card:active {
      transform: translateY(-4px) scale(0.99);
      transition: transform 0.1s;
    }
    
    /* Card glow effect */
    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(34, 211, 238, 0.5), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .glass-card:hover::before {
      opacity: 1;
    }
    
    /* ========== BUTTONS ========== */
    .touch-pop {
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
    }
    
    .touch-pop:hover {
      transform: scale(1.1);
      filter: brightness(1.2);
    }
    
    .touch-pop:active { 
      transform: scale(0.95);
      transition: transform 0.1s;
    }
    
    .scan-btn {
      position: relative;
      overflow: hidden;
    }
    
    .scan-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(34, 211, 238, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.4s, height 0.4s;
    }
    
    .scan-btn:hover::before {
      width: 100%;
      height: 100%;
    }
    
    .scan-btn:hover {
      background: rgba(34, 211, 238, 0.2);
      border-color: var(--cyan);
      transform: scale(1.15) rotate(5deg);
    }
    
    .scan-btn:active {
      transform: scale(0.9) rotate(0deg);
    }
    
    /* Close button */
    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg) scale(1.1);
    }
    
    .close-btn:active {
      transform: rotate(90deg) scale(0.9);
    }
    
    /* ========== MODAL ========== */
    .modal-overlay { 
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(2, 4, 8, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    
    .modal-overlay.open { 
      opacity: 1;
      pointer-events: auto;
    }
    
    .modal-content { 
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      background: rgba(15, 15, 32, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 32px;
      padding: 24px;
      transform: scale(0.8) translateY(50px);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    }
    
    .modal-overlay.open .modal-content { 
      transform: scale(1) translateY(0);
    }
    
    /* ========== ANIMATIONS ========== */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.8;
        transform: scale(1.05);
      }
    }
    
    /* ========== ACHIEVEMENTS ========== */
    .achievement-card {
      opacity: 0;
      animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .achievement-card:nth-child(1) { animation-delay: 0.5s; }
    .achievement-card:nth-child(2) { animation-delay: 0.6s; }
    .achievement-card:nth-child(3) { animation-delay: 0.7s; }
    
    .achievement-card:hover {
      transform: translateY(-8px) scale(1.05);
    }
    
    .achievement-card:active {
      transform: translateY(-4px) scale(1.02);
    }
    
    /* Medal pulse effect */
    .achievement-card.unlocked i {
      animation: pulse 2s infinite;
    }
    
    /* ========== RESPONSIVE ========== */
    @supports (-webkit-touch-callout: none) {
      body {
        -webkit-overflow-scrolling: touch;
      }
      * {
        -webkit-tap-highlight-color: rgba(34, 211, 238, 0.1);
      }
    }
  </style>
</head>

<body class="antialiased pb-24">
  <script>document.addEventListener("touchstart", function(){}, true);</script>
  
  <!-- NEBULAS & GRAIN -->
  <div class="grain-overlay"></div>
  <div class="nebula cyan"></div>
  <div class="nebula purple"></div>
  <canvas id="starfield" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none;"></canvas>
  
  <!-- HEADER -->
  <header>
    <div class="px-4 h-14 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-hud font-black text-white tracking-wider" style="background: linear-gradient(to bottom, #ffffff 0%, #94a3b8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">OPÉRATIONS</h1>
        <div class="flex items-center gap-2 mt-1">
          <div style="width: 24px; height: 2px; background: var(--cyan); box-shadow: 0 0 10px var(--cyan);"></div>
          <span style="color: var(--cyan); font-size: 9px; font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase; text-shadow: 0 0 15px rgba(34, 211, 238, 0.4);">// TACTIQUES</span>
        </div>
      </div>
      
      <button onclick="window.location.href='index.html'" class="close-btn w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-slate-400 touch-pop border border-white/10">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    </div>
    
    <!-- TIMELINE -->
    <div class="timeline-container" id="timeline"></div>
    
    <!-- BLOCK INFO -->
    <div class="block-info-banner">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-[9px] font-bold text-slate-400 uppercase tracking-widest" id="block-label">BLOC ACTIF</div>
          <div class="text-sm font-hud font-bold text-white leading-none mt-1" id="block-name">LOADING...</div>
        </div>
        <div class="text-right">
          <div class="text-[9px] font-bold text-cyan-400 uppercase bg-cyan-400/10 px-2 py-1 rounded border border-cyan-400/20" id="block-tech">TECHNIQUE</div>
        </div>
      </div>
    </div>
  </header>
  
  <!-- MAIN CONTENT -->
  <main class="pt-[240px] px-4 space-y-4 relative z-10">
    <!-- ACHIEVEMENTS -->
    <section>
      <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 pl-1">Succès Récents</h2>
      
      <div class="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide">
        <div class="achievement-card unlocked flex-shrink-0 w-28 glass-card flex flex-col items-center justify-center gap-2 touch-pop">
          <i data-lucide="medal" class="w-6 h-6 text-yellow-500 drop-shadow-[0_0_10px_rgba(234,179,8,0.5)]"></i>
          <div class="text-[9px] text-center font-bold">Premier Sang</div>
        </div>
        
        <div class="achievement-card flex-shrink-0 w-28 glass-card flex flex-col items-center justify-center gap-2 touch-pop opacity-40 grayscale">
          <i data-lucide="dumbbell" class="w-6 h-6 text-slate-600"></i>
          <div class="text-[9px] text-center font-bold text-slate-500">Poids Lourd</div>
        </div>
        
        <div class="achievement-card flex-shrink-0 w-28 glass-card flex flex-col items-center justify-center gap-2 touch-pop opacity-40 grayscale">
          <i data-lucide="flame" class="w-6 h-6 text-slate-600"></i>
          <div class="text-[9px] text-center font-bold text-slate-500">Inferno</div>
        </div>
      </div>
    </section>
    
    <!-- WORKOUTS -->
    <section id="workouts-container" class="space-y-3"></section>
  </main>
  
  <!-- MODAL -->
  <div id="details-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-2xl font-hud font-black text-white uppercase" id="modal-title">TITRE</h3>
          <div class="text-xs font-bold text-cyan-400" id="modal-subtitle">SUBTITLE</div>
        </div>
        <button onclick="closeModal()" class="close-btn p-2 bg-white/10 rounded-full touch-pop">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      
      <div id="modal-body" class="space-y-3"></div>
      
      <div class="mt-6">
        <button id="modal-start-btn" class="w-full py-4 bg-gradient-to-r from-cyan-400 to-cyan-600 text-black font-black font-hud text-lg uppercase rounded-xl shadow-[0_0_30px_rgba(34,211,238,0.5)] touch-pop">
          LANCER LA MISSION
        </button>
      </div>
    </div>
  </div>
  
  <script>
    
    let currentWeek = Utils.getCurrentWeek();
    
    // STARFIELD
    const canvas = document.getElementById('starfield');
    const ctx = canvas.getContext('2d');
    let stars = [];
    
    function initStars() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      stars = [];
      for(let i=0; i<200; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() > 0.98 ? Math.random()*2 + 0.5 : Math.random(),
          speed: Math.random() * 0.2 + 0.02,
          opacity: Math.random(),
          fade: (Math.random() * 0.01) * (Math.random()>0.5 ? 1 : -1)
        });
      }
    }
    
    function animateStars() {
      ctx.clearRect(0,0,canvas.width, canvas.height);
      stars.forEach(s => {
        s.y -= s.speed;
        if(s.y < 0) s.y = canvas.height;
        s.opacity += s.fade;
        if(s.opacity > 1 || s.opacity < 0.2) s.fade *= -1;
        ctx.beginPath();
        ctx.fillStyle = 'rgba(255,255,255,' + s.opacity + ')';
        ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        ctx.fill();
        if(s.size > 1.2) {
          ctx.shadowBlur = 10;
          ctx.shadowColor = "white";
          ctx.fill();
          ctx.shadowBlur = 0;
        }
      });
      requestAnimationFrame(animateStars);
    }
    
    function initOps() { 
      initIcons();
      initStars();
      animateStars();
      renderTimeline();
      renderWorkouts(currentWeek);
      window.addEventListener('resize', initStars);
    }
    
    function renderTimeline() { 
      const container = document.getElementById('timeline');
      container.innerHTML = '';
      
      for (let i = 1; i <= 26; i++) { 
        const weekData = programData.getWeek(i);
        const isDeload = weekData.isDeload;
        const isPeak = i === 25;
        
        let extraClass = '';
        if (isDeload) extraClass = 'deload';
        if (isPeak) extraClass = 'peak';
        
        const chip = document.createElement('div');
        chip.className = `week-chip ${i === currentWeek ? 'active' : ''} ${extraClass}`;
        
        chip.onclick = () => { 
          document.querySelectorAll('.week-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          currentWeek = i;
          Utils.setCurrentWeek(i);
          if (navigator.vibrate) navigator.vibrate(10);
          renderWorkouts(i);
        };
        
        const label = isDeload ? 'DELOAD' : (isPeak ? 'PEAK' : 'SEM');
        chip.innerHTML = `
          <span class="text-[7px] font-bold opacity-60 uppercase">${label}</span>
          <span class="text-xl font-hud font-bold">${i}</span>
        `;
        
        container.appendChild(chip);
      }
      
      setTimeout(() => { 
        const active = container.querySelector('.active');
        if (active) active.scrollIntoView({ behavior: 'smooth', inline: 'center' });
      }, 500);
    }
    
    function renderWorkouts(week) { 
      const container = document.getElementById('workouts-container');
      container.innerHTML = '';
      
      const weekData = programData.getWeek(week);
      
      document.getElementById('block-label').textContent = `BLOC ${weekData.block} • SEMAINE ${week}`;
      const blockName = programData.info.blockTechniques[`block${weekData.block}`]?.name || "Unknown";
      document.getElementById("block-name").textContent = blockName.toUpperCase();
      
      const days = ['dimanche', 'mardi', 'vendredi', 'maison'];
      
      const dayMeta = { 
        'dimanche': { color: 'text-cyan-400', bg: 'bg-cyan-400/10', border: 'border-cyan-400/30', icon: 'zap' }, 
        'mardi': { color: 'text-pink-400', bg: 'bg-pink-400/10', border: 'border-pink-400/30', icon: 'dumbbell' }, 
        'vendredi': { color: 'text-cyan-400', bg: 'bg-cyan-400/10', border: 'border-cyan-400/30', icon: 'activity' }, 
        'maison': { color: 'text-slate-400', bg: 'bg-slate-800', border: 'border-slate-700', icon: 'home' } 
      };
      
      days.forEach((day, index) => { 
        const workout = weekData[day];
        if (!workout) return;
        
        const meta = dayMeta[day];
        
        let techniqueBadge = `<span class="px-2 py-0.5 rounded bg-black/40 border border-white/10 text-[9px] font-bold ${meta.color} uppercase">${weekData.technique.split('+')[0]}</span>`;
        
        if (day === 'maison') {
          techniqueBadge = `<span class="px-2 py-0.5 rounded bg-slate-800 border border-slate-700 text-[9px] font-bold text-slate-400 uppercase">ACCESSOIRE</span>`;
        }
        
        const card = document.createElement('div');
        card.className = `glass-card`;
        
        card.onclick = () => window.location.href = `briefing.html?week=${week}&day=${day}`;
        
        card.innerHTML = `
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-xl ${meta.bg} border ${meta.border} flex items-center justify-center shadow-lg">
              <i data-lucide="${meta.icon}" class="w-6 h-6 ${meta.color}"></i>
            </div>
            
            <div class="flex-1 ml-4">
              <div class="flex items-center gap-2 mb-1">
                ${techniqueBadge}
                <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">${day.toUpperCase()}</span>
              </div>
              <h3 class="text-lg font-hud font-black text-white uppercase leading-none">${workout.name.split('+')[0]}</h3>
            </div>
            
            <button class="scan-btn w-10 h-10 rounded-full bg-white/5 flex items-center justify-center transition-colors border border-white/10 relative z-10" data-day="${day}">
              <i data-lucide="eye" class="w-5 h-5 pointer-events-none relative z-10"></i>
            </button>
          </div>
          
          <div class="flex items-center justify-between border-t border-white/5 pt-3">
            <div class="flex gap-4">
              <div>
                <div class="text-[8px] font-bold text-slate-500 uppercase">Durée</div>
                <div class="text-sm font-mono font-bold text-white">${workout.duration}m</div>
              </div>
              <div>
                <div class="text-[8px] font-bold text-slate-500 uppercase">Séries</div>
                <div class="text-sm font-mono font-bold text-white">${workout.totalSets}</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-[8px] font-bold text-slate-500 uppercase">RPE</div>
               <div class="text-sm
font-bold text-pink-400">${weekData.rpeTarget}</div>
</div>
</div>
`;
    container.appendChild(card);
  });
  
  document.querySelectorAll('.scan-btn').forEach(btn => { 
    btn.addEventListener('click', (e) => { 
      e.stopPropagation();
      openDetails(btn.dataset.day);
    });
  });
  
  initIcons();
}

window.openDetails = (day) => {
  const workout = programData.getWorkout(currentWeek, day);
  Modal.open(
    day.toUpperCase(),
    workout.name,
    workout.exercises,
    () => window.location.href = `briefing.html?week=${currentWeek}&day=${day}`
  );
};

window.closeModal = () => {
  document.getElementById('details-modal').classList.remove('open');
};

initOps();
  </script>
</body>
</html>
