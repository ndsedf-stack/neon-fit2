<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>NeonLift AI - Protocol</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for React & Dependencies -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "@google/genai": "https://esm.sh/@google/genai@0.1.1"
      }
    }
    </script>

    <!-- Custom Styles -->
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #020408;
        color: #f8fafc;
        overflow-x: hidden;
        margin: 0;
      }
      h1, h2, h3, .font-techno {
        font-family: 'Chakra Petch', sans-serif;
      }
      
      /* Scrollbar */
      ::-webkit-scrollbar { width: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
      
      /* ULTRA TRANSPARENT FLOATING GLASS CARD */
      .glass-card {
        background: rgba(255, 255, 255, 0.005) !important; /* 0.5% Opacity - Almost Invisible */
        backdrop-filter: blur(16px); /* Strong blur to separate from background */
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      
      .glass-card:hover {
        background: rgba(255, 255, 255, 0.02) !important;
        border-color: rgba(6, 182, 212, 0.3);
        box-shadow: 0 0 50px rgba(6, 182, 212, 0.1);
        transform: translateY(-2px);
      }
      
      /* Neon Text Glow */
      .neon-text-glow { 
        text-shadow: 0 0 10px rgba(34, 211, 238, 0.8), 0 0 20px rgba(34, 211, 238, 0.4); 
      }

      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

      /* Shimmer Animation */
      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      .animate-shimmer {
        animation: shimmer 2s infinite linear;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { Zap, Activity, Clock, Trophy, Dumbbell, ChevronUp, ChevronDown, Sparkles, Send, Loader2, Bot } from 'lucide-react';
        import { GoogleGenAI } from "@google/genai";

        // --- MOCK DATA ---
        const DEFAULT_WORKOUT_DATA = {
          title: "DIMANCHE",
          subtitle: "// DOS + JAMBES",
          stats: [
            { label: "DURÉE", value: "68m", color: "text-cyan-400" },
            { label: "SÉRIES", value: "31", color: "text-slate-200" },
            { label: "EXERCICES", value: "8", color: "text-slate-200" },
            { label: "XP", value: "500", color: "text-purple-400" },
          ],
          exercises: [
            {
              id: 1,
              name: "Trap Bar Deadlift",
              tags: [
                { label: "DOS", type: "cyan" },
                { label: "COMPOUND", type: "pink" }
              ],
              sets: 5,
              reps: "6-8",
              load: "75kg",
              aiTip: "Garde le dos neutre. Engage tes dorsaux avant de tirer.",
              stats: { force: 90, hypertrophy: 60, endurance: 30 }
            },
            {
              id: 2,
              name: "Goblet Squat",
              tags: [
                { label: "JAMBES", type: "cyan" },
                { label: "COMPOUND", type: "pink" }
              ],
              sets: 4,
              reps: "10",
              load: "25kg",
              aiTip: "Belle profondeur. Attention à tes genoux à la remontée.",
              stats: { force: 60, hypertrophy: 85, endurance: 40 }
            },
            {
              id: 3,
              name: "Leg Press",
              tags: [
                { label: "JAMBES", type: "cyan" },
                { label: "ISOLATION", type: "pink" }
              ],
              sets: 4,
              reps: "10",
              load: "110kg",
              aiTip: null,
              stats: { force: 45, hypertrophy: 90, endurance: 50 }
            }
          ]
        };

        // --- BACKGROUND: STARFIELD ---
        const StarField = () => {
          const canvasRef = useRef(null);

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            let stars = [];
            let width = window.innerWidth;
            let height = window.innerHeight;

            const init = () => {
              width = window.innerWidth;
              height = window.innerHeight;
              canvas.width = width;
              canvas.height = height;
              stars = [];
              const numStars = Math.floor((width * height) / 3000); // More stars
              
              for(let i=0; i<numStars; i++) {
                stars.push({
                  x: Math.random() * width,
                  y: Math.random() * height,
                  size: Math.random() * 1.5,
                  speed: Math.random() * 0.15 + 0.05,
                  opacity: Math.random(),
                  fade: Math.random() * 0.01 + 0.005
                });
              }
            };

            const animate = () => {
              ctx.clearRect(0, 0, width, height);
              
              stars.forEach(star => {
                star.y -= star.speed;
                if (star.y < 0) star.y = height;
                
                // Twinkle effect
                star.opacity += star.fade;
                if (star.opacity > 1 || star.opacity < 0.1) star.fade = -star.fade;
                
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();

                if (star.size > 1.2 && star.opacity > 0.8) {
                   ctx.shadowBlur = 10;
                   ctx.shadowColor = "white";
                   ctx.fill();
                   ctx.shadowBlur = 0;
                }
              });
              
              requestAnimationFrame(animate);
            };

            init();
            animate();
            
            const handleResize = () => init();
            window.addEventListener('resize', handleResize);
            return () => window.removeEventListener('resize', handleResize);
          }, []);

          return <canvas ref={canvasRef} className="fixed top-0 left-0 w-full h-full pointer-events-none z-0" />;
        };

        // --- COMPONENT: CIRCULAR GAUGE ---
        const CircularGauge = ({ value, label, maxValue = 10, color = "text-slate-200", glow = false, delay = 0 }) => {
          const [percent, setPercent] = useState(0);
          
          // Parse logic: "6-8" -> 8, "75kg" -> 75
          const numericValue = parseFloat(String(value).match(/(\d+)/)?.[0] || 0);
          // Calculate percentage proportional to max
          const targetPercent = Math.min((numericValue / maxValue) * 100, 100);

          useEffect(() => {
            const timer = setTimeout(() => setPercent(targetPercent), 300 + delay);
            return () => clearTimeout(timer);
          }, [delay, targetPercent]);

          const radius = 38;
          const circumference = 2 * Math.PI * radius;
          const strokeDashoffset = circumference - (percent / 100) * circumference;

          // Unique ID for filter
          const uid = Math.random().toString(36).substr(2, 9);
          const strokeColor = glow ? "#06b6d4" : "#94a3b8"; // Cyan vs Slate

          return (
            <div className="flex flex-col items-center justify-center">
              <div className="relative w-24 h-24 flex items-center justify-center">
                <svg className="absolute w-full h-full -rotate-90 overflow-visible" viewBox="0 0 100 100">
                  <defs>
                    <linearGradient id={`grad_${uid}`} x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" stopColor={glow ? "#22d3ee" : "#64748b"} stopOpacity="1" />
                      <stop offset="100%" stopColor={glow ? "#0891b2" : "#334155"} stopOpacity="0.5" />
                    </linearGradient>
                    <filter id={`glow_${uid}`} x="-50%" y="-50%" width="200%" height="200%">
                      <feGaussianBlur stdDeviation={glow ? "4" : "0"} result="coloredBlur"/>
                      <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                      </feMerge>
                    </filter>
                  </defs>

                  {/* Outer Dashed Ring (Tech Look) */}
                  <circle
                    cx="50" cy="50" r="46"
                    stroke={glow ? "rgba(34, 211, 238, 0.2)" : "rgba(255,255,255,0.05)"}
                    strokeWidth="1" fill="none"
                    strokeDasharray="4 4"
                  />

                  {/* Track */}
                  <circle
                    cx="50" cy="50" r={radius}
                    stroke="rgba(255,255,255,0.05)"
                    strokeWidth="4" fill="none"
                  />

                  {/* Animated Stroke */}
                  <circle
                    cx="50" cy="50" r={radius}
                    stroke={`url(#grad_${uid})`}
                    strokeWidth="4" fill="none"
                    strokeDasharray={circumference}
                    strokeDashoffset={strokeDashoffset}
                    strokeLinecap="round"
                    className="transition-all duration-[1500ms] cubic-bezier(0.2, 0.8, 0.2, 1)"
                    filter={glow ? `url(#glow_${uid})` : ""}
                  />
                </svg>
                
                {/* Value Content */}
                <div className="z-10 flex flex-col items-center justify-center relative">
                   {glow && <div className="absolute w-12 h-12 bg-cyan-500/10 rounded-full blur-xl"></div>}
                   <span className={`text-xl font-bold font-techno tracking-wider ${color} ${glow ? 'neon-text-glow' : ''}`}>
                    {value}
                   </span>
                </div>
              </div>
              <span className="text-[10px] font-bold text-slate-500 uppercase tracking-widest -mt-2">{label}</span>
            </div>
          );
        };

        // --- COMPONENT: STAT BAR (High Quality) ---
        const StatBar = ({ label, value, colorClass, trackColorClass }) => (
          <div className="flex items-center gap-3 w-full group/bar">
            <span className="text-[9px] font-bold text-slate-500 w-12 uppercase tracking-widest text-right group-hover/bar:text-slate-300 transition-colors">{label}</span>
            <div className={`flex-1 h-1.5 ${trackColorClass} rounded-full overflow-hidden relative`}>
              <div 
                className={`h-full rounded-full ${colorClass} relative z-10 transition-all duration-1000 ease-out`} 
                style={{ width: `${value}%`, boxShadow: '0 0 8px currentColor' }}
              />
              <div className="absolute inset-0 z-20 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full h-full -translate-x-full animate-shimmer"></div>
            </div>
          </div>
        );

        // --- COMPONENT: CHAT ---
        const ChatInterface = ({ isOpen }) => {
          const [messages, setMessages] = useState([
            { role: 'model', text: "Je suis NeonLift. L'analyse biométrique est prête. En attente de vos instructions." }
          ]);
          const [input, setInput] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const bottomRef = useRef(null);

          useEffect(() => {
             if(isOpen) setTimeout(() => bottomRef.current?.scrollIntoView({ behavior: 'smooth' }), 100);
          }, [messages, isOpen]);

          const handleSend = async () => {
            if (!input.trim() || isLoading) return;
            const userMsg = input.trim();
            setInput('');
            setMessages(p => [...p, { role: 'user', text: userMsg }]);
            setIsLoading(true);
            try {
               const apiKey = process.env.API_KEY || "YOUR_KEY"; // In standalone HTML, this needs a real key or backend
               const ai = new GoogleGenAI({ apiKey });
               const chat = ai.chats.create({ model: 'gemini-2.5-flash', history: messages.map(m => ({ role: m.role, parts: [{ text: m.text }] })) });
               const result = await chat.sendMessageStream({ message: userMsg });
               let fullRes = '';
               setMessages(p => [...p, { role: 'model', text: '' }]);
               for await (const chunk of result) {
                 fullRes += chunk.text;
                 setMessages(p => { const n = [...p]; n[n.length-1].text = fullRes; return n; });
               }
            } catch(e) {
               setMessages(p => [...p, { role: 'model', text: "Connexion impossible (Mode démo/Standalone)." }]);
            } finally { setIsLoading(false); }
          };

          return (
             <div className="flex flex-col h-full bg-[#050a14]">
                <div className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide pb-20">
                   {messages.map((m, i) => (
                      <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                         <div className={`max-w-[85%] rounded-2xl p-4 ${m.role==='user'?'bg-indigo-600 text-white':'bg-white/5 border border-white/10 text-slate-300'}`}>
                            <p className="text-sm">{m.text}</p>
                         </div>
                      </div>
                   ))}
                   {isLoading && <Loader2 className="animate-spin text-indigo-400 m-4" />}
                   <div ref={bottomRef}/>
                </div>
                <div className="absolute bottom-0 w-full p-4 bg-[#050a14]/90 border-t border-white/5">
                   <div className="relative">
                      <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&handleSend()} className="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-4 pr-12 text-sm text-white focus:outline-none" placeholder="Message..." />
                      <button onClick={handleSend} className="absolute right-2 top-2 p-1.5 bg-indigo-600 rounded-lg text-white"><Send size={16}/></button>
                   </div>
                </div>
             </div>
          );
        };

        // --- MAIN APP ---
        const App = () => {
          const [isCoachOpen, setIsCoachOpen] = useState(false);
          const [data] = useState(DEFAULT_WORKOUT_DATA);

          return (
            <div className="min-h-screen relative font-sans text-slate-100 selection:bg-cyan-500/30">
              <StarField />
              <div className="fixed top-[-20%] left-[-10%] w-[600px] h-[600px] bg-cyan-900/10 blur-[150px] rounded-full pointer-events-none mix-blend-screen animate-pulse"></div>
              <div className="fixed bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-900/10 blur-[120px] rounded-full pointer-events-none mix-blend-screen opacity-60"></div>

              <div className="max-w-md mx-auto min-h-screen flex flex-col relative z-10 pb-32">
                
                {/* HEADER */}
                <header className="p-6 pt-10">
                  <div className="flex justify-between items-start">
                    <div>
                      <h1 className="text-4xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-b from-white via-slate-200 to-slate-400 font-techno uppercase drop-shadow-lg">
                        {data.title}
                      </h1>
                      <div className="flex items-center gap-3 mt-2">
                        <span className="h-[2px] w-6 bg-cyan-500 shadow-[0_0_10px_rgba(34,211,238,0.8)] rounded-full"></span>
                        <p className="text-[10px] font-mono tracking-[0.3em] text-cyan-400 font-bold uppercase opacity-90 drop-shadow-[0_0_5px_rgba(34,211,238,0.5)]">
                          {data.subtitle}
                        </p>
                      </div>
                    </div>
                    <div className="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center cursor-pointer hover:bg-white/10 backdrop-blur-md transition-all">
                      <span className="text-xs text-slate-400">✕</span>
                    </div>
                  </div>
                </header>

                {/* STATS */}
                <div className="grid grid-cols-4 gap-2 px-6 mb-8">
                  {data.stats.map((stat, i) => (
                    <div key={i} className="glass-card rounded-xl p-2.5 flex flex-col items-center justify-center text-center">
                      <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1">{stat.label}</span>
                      <span className={`text-lg font-bold font-techno ${stat.color} filter drop-shadow-sm`}>{stat.value}</span>
                    </div>
                  ))}
                </div>

                {/* PROTOCOL LABEL */}
                <div className="px-6 flex items-center gap-3 mb-6 opacity-80">
                  <div className="w-7 h-7 rounded-lg bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center shadow-[0_0_15px_rgba(6,182,212,0.1)]">
                    <Zap size={14} className="text-cyan-400 fill-cyan-400/20" />
                  </div>
                  <h2 className="text-xs font-bold tracking-[0.2em] uppercase font-techno text-slate-300">
                    Protocole d'entraînement
                  </h2>
                </div>

                {/* EXERCISES LIST */}
                <div className="px-4 space-y-6 flex-1">
                  {data.exercises.map((ex, idx) => (
                    <div key={ex.id} className="glass-card rounded-[2rem] p-6 relative group overflow-hidden">
                      
                      {/* Grid Pattern Overlay inside card for tech feel */}
                      <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none opacity-20"></div>

                      <div className="relative z-10">
                        {/* Header */}
                        <div className="flex justify-between items-start mb-6">
                          <div className="flex gap-4 items-center">
                            <div className="w-10 h-10 rounded-2xl bg-[#0F1522]/60 border border-white/5 text-slate-400 flex items-center justify-center font-techno font-bold text-lg shadow-inner">
                              {ex.id}
                            </div>
                            <div>
                              <h3 className="text-lg font-bold text-slate-100 font-techno leading-none mb-2 tracking-wide drop-shadow-md">{ex.name}</h3>
                              <div className="flex gap-2">
                                {ex.tags.map((tag, tIdx) => (
                                  <span key={tIdx} className={`text-[9px] font-bold px-2 py-0.5 rounded-full border uppercase tracking-wider backdrop-blur-md ${tag.type === 'cyan' ? 'border-cyan-500/20 text-cyan-300 bg-cyan-500/5' : 'border-pink-500/20 text-pink-300 bg-pink-500/5'}`}>
                                    {tag.label}
                                  </span>
                                ))}
                              </div>
                            </div>
                          </div>
                          {ex.aiTip && (
                             <div className="bg-indigo-500/10 border border-indigo-500/20 text-[9px] text-indigo-300 px-2 py-1 rounded-lg uppercase tracking-wider font-bold shadow-[0_0_10px_rgba(99,102,241,0.1)] flex items-center gap-1">
                               <Sparkles size={10} /> IA TIP
                             </div>
                          )}
                        </div>

                        {/* PROPORTIONAL GAUGES */}
                        <div className="flex justify-around items-center mb-6 px-1">
                           <CircularGauge value={ex.sets} label="SÉRIES" maxValue={8} delay={idx * 100} />
                           <CircularGauge value={ex.reps} label="REPS" maxValue={20} delay={idx * 100 + 100} />
                           <CircularGauge value={ex.load} label="CHARGE" maxValue={150} color="text-cyan-300" glow={true} delay={idx * 100 + 200} />
                        </div>

                        {/* STATS BARS + LIGHTNING ICON */}
                        {ex.stats && (
                          <div className="bg-[#050a14]/40 rounded-xl p-3 border border-white/5 flex gap-4 backdrop-blur-sm shadow-inner">
                             {/* Requested Lightning Icon Container */}
                             <div className="w-10 rounded-lg bg-gradient-to-br from-slate-800/30 to-slate-900/30 border border-white/5 flex items-center justify-center shrink-0 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
                                <Zap size={18} className="text-yellow-400 fill-yellow-400/20 drop-shadow-[0_0_8px_rgba(250,204,21,0.5)]" />
                             </div>
                             
                             <div className="flex-1 flex flex-col justify-center gap-2">
                                <StatBar label="FORCE" value={ex.stats.force} colorClass="bg-gradient-to-r from-orange-600 to-orange-400" trackColorClass="bg-orange-950/20" />
                                <StatBar label="HYPER" value={ex.stats.hypertrophy} colorClass="bg-gradient-to-r from-purple-600 to-purple-400" trackColorClass="bg-purple-950/20" />
                                <StatBar label="ENDUR." value={ex.stats.endurance} colorClass="bg-gradient-to-r from-cyan-600 to-cyan-400" trackColorClass="bg-cyan-950/20" />
                             </div>
                          </div>
                        )}
                      </div>
                    </div>
                  ))}
                </div>

                {/* COACH OVERLAY */}
                <div 
                  className={`fixed bottom-0 left-0 right-0 z-50 transition-all duration-500 cubic-bezier(0.19, 1, 0.22, 1) ${isCoachOpen ? 'h-[85vh]' : 'h-24'}`}
                >
                   <div 
                      className={`absolute -top-[100vh] left-0 w-full h-[200vh] bg-black/60 backdrop-blur-sm transition-opacity duration-500 ${isCoachOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
                      onClick={() => setIsCoachOpen(false)}
                   />

                   <div className="h-full max-w-md mx-auto bg-[#0a101d] rounded-t-[2.5rem] border-t border-white/10 shadow-[0_-20px_50px_rgba(0,0,0,0.8)] flex flex-col relative overflow-hidden">
                      <div 
                        onClick={() => setIsCoachOpen(!isCoachOpen)}
                        className="p-5 flex items-center gap-4 cursor-pointer hover:bg-white/5 transition-colors relative z-20 bg-[#0a101d]/90 backdrop-blur-md border-b border-white/5"
                      >
                        <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 p-[1px] shadow-[0_0_20px_rgba(99,102,241,0.3)]">
                           <div className="w-full h-full rounded-2xl bg-[#0a101d] flex items-center justify-center relative">
                              <Sparkles size={20} className="text-indigo-400" />
                           </div>
                        </div>
                        <div className="flex-1">
                          <h3 className="font-techno font-bold text-lg text-white tracking-wide">COACH IA</h3>
                          <p className="text-xs text-indigo-300/60 font-medium">Gemini 2.5 Active</p>
                        </div>
                        <div className={`w-10 h-10 rounded-full bg-white/5 flex items-center justify-center transition-transform duration-500 ${isCoachOpen ? 'rotate-180' : ''}`}>
                          <ChevronUp size={20} className="text-slate-400" />
                        </div>
                      </div>

                      <div className={`flex-1 relative flex flex-col transition-all duration-500 ${isCoachOpen ? 'opacity-100' : 'opacity-0'}`}>
                         <ChatInterface isOpen={isCoachOpen} />
                      </div>
                   </div>
                </div>

              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
