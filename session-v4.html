<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>NEON FIT V4 // MODE COMBAT</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            void: '#020408',
            'void-soft': '#0a0f14',
            cyan: '#22d3ee',
            magenta: '#c084fc',
            amber: '#f59e0b',
            lime: '#84cc16',
            purple: '#a855f7',
            emerald: '#10b981'
          },
          fontFamily: {
            display: ['Orbitron', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
            body: ['Inter', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <style>
    :root {
      --cyan: #22d3ee;
      --magenta: #c084fc;
      --amber: #f59e0b;
      --lime: #84cc16;
      --purple: #a855f7;
      --emerald: #10b981;
      --void: #020408;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      background: var(--void);
    }
    
    body {
      font-family: 'Inter', sans-serif;
      color: white;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding-top: env(safe-area-inset-top);
      touch-action: manipulation;
      position: fixed;
      inset: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    .font-display { font-family: 'Orbitron', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    
    /* Muscle Colors */
    .muscle-dos { --muscle-color: #22d3ee; }
    .muscle-pecs { --muscle-color: #c084fc; }
    .muscle-jambes { --muscle-color: #84cc16; }
    .muscle-epaules { --muscle-color: #f59e0b; }
    .muscle-bras { --muscle-color: #a855f7; }
    .muscle-abdos { --muscle-color: #10b981; }
    
    /* Tempo Bars */
    .tempo-bar {
      width: 24px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      overflow: hidden;
      position: relative;
    }
    
    .tempo-bar-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      border-radius: 12px;
      transition: height 0.1s linear;
    }
    
    .tempo-bar-descent .tempo-bar-fill {
      background: linear-gradient(to top, var(--cyan), transparent);
      box-shadow: 0 0 20px var(--cyan);
    }
    
    .tempo-bar-lift .tempo-bar-fill {
      background: linear-gradient(to top, var(--amber), transparent);
      box-shadow: 0 0 20px var(--amber);
    }
    
    /* Giant Counter */
    .counter-giant {
      font-size: clamp(80px, 25vw, 140px);
      font-weight: 900;
      line-height: 1;
      text-shadow: 0 0 60px rgba(34, 211, 238, 0.5);
    }
    
    /* Rest Timer Circle */
    .rest-circle {
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: center;
    }
    
    /* Validation Button - HUGE */
    .btn-validate {
      min-height: 80px;
      background: linear-gradient(135deg, var(--cyan), #06b6d4);
      border-radius: 20px;
      font-weight: 800;
      font-size: 20px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      box-shadow: 0 0 40px rgba(34, 211, 238, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
      transition: transform 0.1s, box-shadow 0.1s;
    }
    
    .btn-validate:active {
      transform: scale(0.97);
      box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
    }
    
    /* Weight Adjust Buttons */
    .btn-weight {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 28px;
      font-weight: 700;
      transition: background 0.1s, transform 0.1s;
    }
    
    .btn-weight:active {
      background: rgba(255,255,255,0.15);
      transform: scale(0.95);
    }
    
    /* Glass Panel */
    .glass-panel {
      background: rgba(10, 15, 20, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 24px;
    }
    
    /* Intensity Module Button */
    .btn-intensity {
      background: linear-gradient(135deg, rgba(192, 132, 252, 0.2), rgba(192, 132, 252, 0.05));
      border: 1px solid rgba(192, 132, 252, 0.3);
      border-radius: 16px;
      padding: 16px 24px;
      transition: all 0.2s;
    }
    
    .btn-intensity:active {
      background: rgba(192, 132, 252, 0.3);
      transform: scale(0.98);
    }
    
    /* Preset Buttons */
    .btn-preset {
      padding: 12px 20px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      font-weight: 600;
      transition: all 0.15s;
    }
    
    .btn-preset:active, .btn-preset.active {
      background: rgba(34, 211, 238, 0.2);
      border-color: rgba(34, 211, 238, 0.5);
      color: var(--cyan);
    }
    
    /* Optimal Window Bar */
    .optimal-window {
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(90deg, 
        rgba(239, 68, 68, 0.3) 0%, 
        rgba(34, 211, 238, 0.8) 30%, 
        rgba(16, 185, 129, 1) 50%, 
        rgba(34, 211, 238, 0.8) 70%, 
        rgba(249, 115, 22, 0.5) 100%
      );
      position: relative;
    }
    
    .optimal-marker {
      position: absolute;
      top: -4px;
      width: 4px;
      height: 16px;
      background: white;
      border-radius: 2px;
      box-shadow: 0 0 10px white;
      transition: left 0.5s ease-out;
    }
    
    /* XP Toast */
    @-webkit-keyframes xp-toast {
      0% { opacity: 0; -webkit-transform: translateX(-50%) translateY(-30px); transform: translateX(-50%) translateY(-30px); }
      15% { opacity: 1; -webkit-transform: translateX(-50%) translateY(0); transform: translateX(-50%) translateY(0); }
      85% { opacity: 1; -webkit-transform: translateX(-50%) translateY(0); transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; -webkit-transform: translateX(-50%) translateY(-20px); transform: translateX(-50%) translateY(-20px); }
    }
    @keyframes xp-toast {
      0% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
      15% { opacity: 1; transform: translateX(-50%) translateY(0); }
      85% { opacity: 1; transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }
    
    .xp-toast {
      -webkit-animation: xp-toast 2s ease-out forwards;
      animation: xp-toast 2s ease-out forwards;
    }
    
    /* Particles */
    @-webkit-keyframes particle-burst {
      0% { opacity: 1; -webkit-transform: scale(0); transform: scale(0); }
      100% { opacity: 0; -webkit-transform: scale(1); transform: scale(1); }
    }
    @keyframes particle-burst {
      0% { opacity: 1; transform: scale(0); }
      100% { opacity: 0; transform: scale(1); }
    }
    
    .particle-ring {
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 3px solid var(--cyan);
      -webkit-animation: particle-burst 0.6s ease-out forwards;
      animation: particle-burst 0.6s ease-out forwards;
    }
    
    /* Flash Screen */
    .flash-screen {
      position: fixed;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 100;
    }
    
    .flash-screen.flash {
      -webkit-animation: flash 0.15s ease-out;
      animation: flash 0.15s ease-out;
    }
    
    @-webkit-keyframes flash {
      0% { opacity: 0.3; }
      100% { opacity: 0; }
    }
    @keyframes flash {
      0% { opacity: 0.3; }
      100% { opacity: 0; }
    }
    
    /* Coaching Text */
    .coaching-text {
      font-style: italic;
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }
    
    /* Hidden by default */
    .hidden { display: none !important; }
    
    /* Swipe hint */
    .swipe-hint {
      font-size: 11px;
      color: rgba(255,255,255,0.3);
    }
    
    /* Score bar */
    .score-bar {
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
    }
    
    .score-bar-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease-out;
    }
    
    /* Tags */
    .tag-btn {
      padding: 8px 14px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 12px;
      font-weight: 600;
      transition: all 0.15s;
    }
    
    .tag-btn:active, .tag-btn.active {
      background: rgba(34, 211, 238, 0.15);
      border-color: rgba(34, 211, 238, 0.4);
      color: var(--cyan);
    }
    
    /* RIR Slider */
    .rir-slider {
      display: flex;
      gap: 8px;
    }
    
    .rir-option {
      flex: 1;
      padding: 16px 8px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      border: 2px solid transparent;
      text-align: center;
      transition: all 0.15s;
    }
    
    .rir-option:active, .rir-option.active {
      border-color: var(--cyan);
      background: rgba(34, 211, 238, 0.1);
    }
    
    .rir-option.active .rir-value {
      color: var(--cyan);
    }
  </style>
</head>

<body class="muscle-dos">
  
  <!-- Flash Screen Effect -->
  <div id="flash-screen" class="flash-screen"></div>
  
  <!-- XP Toast -->
  <div id="xp-toast" class="fixed top-20 left-1/2 -translate-x-1/2 z-50 opacity-0 pointer-events-none">
    <div class="flex items-center gap-3 px-5 py-3 rounded-2xl bg-black/90 backdrop-blur-xl border border-cyan/40" style="box-shadow: 0 0 40px rgba(34,211,238,0.4);">
      <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan to-magenta flex items-center justify-center">
        <span class="text-2xl">‚ö°</span>
      </div>
      <div>
        <div id="xp-amount" class="text-2xl font-black font-display text-transparent bg-clip-text bg-gradient-to-r from-cyan to-magenta" style="-webkit-background-clip: text;">+50 XP</div>
        <div class="text-xs font-bold text-white/50 uppercase tracking-widest">Serie validee</div>
      </div>
    </div>
  </div>
  
  <!-- Particle Container -->
  <div id="particle-container" class="fixed inset-0 pointer-events-none z-40 flex items-center justify-center"></div>

  <!-- ========== MODE SERIE ========== -->
  <div id="mode-serie" class="flex-1 flex flex-col">
    
    <!-- Header -->
    <header class="px-4 py-3 flex items-center justify-between">
      <button id="btn-back" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
        <span class="text-white/60">‚Üê</span>
      </button>
      <div class="text-center">
        <div class="text-xs font-bold text-white/40 uppercase tracking-widest">Mission en cours</div>
        <div id="workout-name" class="font-display font-bold text-sm text-white">DOS + JAMBES</div>
      </div>
      <button id="btn-focus" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
        <span class="text-white/60">‚óâ</span>
      </button>
    </header>
    
    <!-- Exercise Info -->
    <div class="px-4 py-2">
      <div class="glass-panel px-4 py-3">
        <div class="flex items-center justify-between">
          <div>
            <div id="exercise-name" class="font-display font-bold text-lg text-white">Trap Bar Deadlift</div>
            <div class="flex items-center gap-2 mt-1">
              <span id="muscle-tag" class="px-2 py-0.5 rounded text-xs font-bold uppercase bg-cyan/20 text-cyan border border-cyan/30">DOS</span>
              <span id="set-info" class="text-sm text-white/50">Serie <span id="current-set">3</span>/<span id="total-sets">5</span></span>
              <span class="text-white/30">‚Ä¢</span>
              <span id="tempo-info" class="text-sm text-white/50">Tempo 3-1-2</span>
            </div>
          </div>
          <div class="text-right">
            <div id="weight-display" class="font-mono font-bold text-2xl text-white">75<span class="text-sm text-white/50">kg</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Counter Area -->
    <div class="flex-1 flex items-center justify-center px-4 relative">
      
      <!-- Tempo Bar LEFT (Descente) -->
      <div class="tempo-bar tempo-bar-descent h-48 mr-6">
        <div id="tempo-descent" class="tempo-bar-fill" style="height: 0%;"></div>
        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] font-bold text-cyan/60 uppercase">3s</div>
      </div>
      
      <!-- Central Counter -->
      <div class="text-center">
        <div class="text-xs font-bold text-white/30 uppercase tracking-widest mb-2">Repetitions</div>
        <div id="rep-counter" class="counter-giant font-mono text-cyan">5</div>
        <div class="text-sm text-white/40 mt-2">sur <span id="target-reps">6-8</span></div>
        
        <!-- Coaching Text -->
        <div id="coaching-text" class="coaching-text mt-4 max-w-[200px] mx-auto">
          "Controle bas, explosion propre"
        </div>
      </div>
      
      <!-- Tempo Bar RIGHT (Remontee) -->
      <div class="tempo-bar tempo-bar-lift h-48 ml-6">
        <div id="tempo-lift" class="tempo-bar-fill" style="height: 0%;"></div>
        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] font-bold text-amber/60 uppercase">2s</div>
      </div>
      
    </div>
    
    <!-- Weight Adjust + Validate -->
    <div class="px-4 pb-4" style="padding-bottom: calc(env(safe-area-inset-bottom) + 16px);">
      
      <!-- Rep Counter Buttons -->
      <div class="flex items-center justify-center gap-6 mb-4">
        <button id="btn-rep-minus" class="btn-weight text-white/60">‚àí</button>
        <div class="text-center">
          <div class="text-xs font-bold text-white/30 uppercase">Reps</div>
        </div>
        <button id="btn-rep-plus" class="btn-weight text-white/60">+</button>
      </div>
      
      <!-- Weight Adjust -->
      <div class="flex items-center justify-between mb-4">
        <button id="btn-weight-minus" class="btn-weight text-white/60">‚àí</button>
        <div class="text-center">
          <div class="text-xs font-bold text-white/30 uppercase mb-1">Charge</div>
          <div id="weight-adjust-display" class="font-mono font-bold text-xl text-white">75 kg</div>
        </div>
        <button id="btn-weight-plus" class="btn-weight text-white/60">+</button>
      </div>
      
      <!-- Validate Button -->
      <button id="btn-validate" class="btn-validate w-full text-black font-display">
        ‚úì VALIDER SERIE
      </button>
      
      <!-- Swipe Hint -->
      <div class="swipe-hint text-center mt-3">
        ‚Üê Swipe gauche : Echec technique
      </div>
      
    </div>
    
  </div>

  <!-- ========== MODE REPOS ========== -->
  <div id="mode-repos" class="fixed inset-0 bg-void z-30 hidden flex-col">
    
    <!-- Header Repos -->
    <header class="px-4 py-3 flex items-center justify-between" style="padding-top: env(safe-area-inset-top);">
      <div class="text-xs font-bold text-amber/60 uppercase tracking-widest">Repos</div>
      <button id="btn-skip-rest" class="px-4 py-2 rounded-lg bg-white/5 text-xs font-bold text-white/50 uppercase">
        Skip ‚Üí
      </button>
    </header>
    
    <!-- Timer Circle -->
    <div class="flex-1 flex flex-col items-center justify-center px-4">
      
      <div class="relative w-64 h-64">
        <svg class="w-full h-full" viewBox="0 0 256 256">
          <defs>
            <linearGradient id="rest-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#22d3ee"/>
              <stop offset="50%" stop-color="#10b981"/>
              <stop offset="100%" stop-color="#f59e0b"/>
            </linearGradient>
          </defs>
          <!-- Background Circle -->
          <circle cx="128" cy="128" r="110" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="12"/>
          <!-- Progress Circle -->
          <circle id="rest-progress" cx="128" cy="128" r="110" fill="none" 
                  stroke="url(#rest-gradient)" stroke-width="12" 
                  stroke-dasharray="691" stroke-dashoffset="0"
                  class="rest-circle"/>
        </svg>
        
        <!-- Timer Display -->
        <div class="absolute inset-0 flex flex-col items-center justify-center">
          <div id="rest-timer" class="font-mono font-black text-6xl text-white">2:00</div>
          <div class="text-sm text-white/40 mt-1">/ <span id="rest-total">2:00</span></div>
        </div>
      </div>
      
      <!-- Optimal Window -->
      <div class="w-full max-w-xs mt-8">
        <div class="flex justify-between text-xs text-white/40 mb-2">
          <span>Trop court</span>
          <span class="text-emerald font-bold">Zone optimale</span>
          <span>Trop long</span>
        </div>
        <div class="optimal-window">
          <div id="optimal-marker" class="optimal-marker" style="left: 50%;"></div>
        </div>
      </div>
      
      <!-- Presets -->
      <div class="flex gap-3 mt-6">
        <button class="btn-preset" data-time="30">30s</button>
        <button class="btn-preset" data-time="60">60s</button>
        <button class="btn-preset active" data-time="90">90s</button>
        <button class="btn-preset" data-time="120">120s</button>
      </div>
      
      <!-- Next Exercise Preview -->
      <div class="glass-panel w-full max-w-xs mt-6 px-4 py-3">
        <div class="text-xs font-bold text-white/40 uppercase mb-1">Prochain</div>
        <div class="flex items-center justify-between">
          <div>
            <div id="next-exercise" class="font-display font-bold text-white">Rowing Haltere</div>
            <div class="text-sm text-white/50"><span id="next-sets">4</span>√ó<span id="next-reps">8-10</span> ‚Ä¢ <span id="next-weight">32</span>kg</div>
          </div>
          <span class="px-2 py-0.5 rounded text-xs font-bold uppercase bg-cyan/20 text-cyan border border-cyan/30">DOS</span>
        </div>
      </div>
      
      <!-- Intensification Button -->
      <button id="btn-intensify" class="btn-intensity w-full max-w-xs mt-4 flex items-center justify-center gap-3">
        <span class="text-xl">‚ö°</span>
        <span class="font-display font-bold text-magenta uppercase">Intensification</span>
      </button>
      
      <!-- Coaching -->
      <div id="rest-coaching" class="coaching-text text-center mt-4 max-w-xs">
        "Relache trapezes. Respire. Repars a 90s."
      </div>
      
    </div>
    
  </div>

  <!-- ========== MODE INTENSIFICATION ========== -->
  <div id="mode-intensification" class="fixed inset-0 bg-void/95 z-40 hidden flex-col">
    
    <header class="px-4 py-4 flex items-center justify-between" style="padding-top: calc(env(safe-area-inset-top) + 8px);">
      <button id="btn-close-intensify" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
        <span class="text-white/60">‚Üê</span>
      </button>
      <div class="font-display font-bold text-magenta uppercase">Intensification</div>
      <div class="w-10"></div>
    </header>
    
    <div class="flex-1 overflow-y-auto px-4 pb-8">
      
      <!-- Drop Set -->
      <div class="glass-panel p-4 mb-4">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-2xl">üíß</span>
          <div>
            <div class="font-display font-bold text-white">DROP SET</div>
            <div class="text-sm text-white/50">Reduit charge 20%, continue</div>
          </div>
        </div>
        <div class="text-xs text-white/40 mb-3">Serie ‚Üí 10s repos ‚Üí -20% charge ‚Üí Echec</div>
        <button class="w-full py-3 rounded-xl bg-gradient-to-r from-cyan/20 to-magenta/20 border border-white/10 font-bold text-white uppercase text-sm">
          Activer Drop Set
        </button>
      </div>
      
      <!-- Rest-Pause -->
      <div class="glass-panel p-4 mb-4">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-2xl">‚è∏Ô∏è</span>
          <div>
            <div class="font-display font-bold text-white">REST-PAUSE</div>
            <div class="text-sm text-white/50">20s repos ‚Üí 3-5 reps ‚Üí iso</div>
          </div>
        </div>
        <div class="text-xs text-white/40 mb-3">Serie ‚Üí 20s ‚Üí 3-5 reps ‚Üí 10s iso-hold</div>
        <button class="w-full py-3 rounded-xl bg-gradient-to-r from-cyan/20 to-magenta/20 border border-white/10 font-bold text-white uppercase text-sm">
          Activer Rest-Pause
        </button>
      </div>
      
      <!-- Myo-Reps -->
      <div class="glass-panel p-4 mb-4">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-2xl">üîÑ</span>
          <div>
            <div class="font-display font-bold text-white">MYO-REPS</div>
            <div class="text-sm text-white/50">Serie activatrice + minis</div>
          </div>
        </div>
        <div class="text-xs text-white/40 mb-3">12-15 reps ‚Üí 5s ‚Üí 5 reps √ó 3-4</div>
        <button class="w-full py-3 rounded-xl bg-gradient-to-r from-cyan/20 to-magenta/20 border border-white/10 font-bold text-white uppercase text-sm">
          Activer Myo-Reps
        </button>
      </div>
      
      <!-- Iso-Hold -->
      <div class="glass-panel p-4 mb-4">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-2xl">üîí</span>
          <div>
            <div class="font-display font-bold text-white">ISO-HOLD FIN</div>
            <div class="text-sm text-white/50">Maintien isometrique 8-10s</div>
          </div>
        </div>
        <div class="text-xs text-white/40 mb-3">Derniere rep ‚Üí Hold position basse/haute</div>
        <button class="w-full py-3 rounded-xl bg-gradient-to-r from-cyan/20 to-magenta/20 border border-white/10 font-bold text-white uppercase text-sm">
          Activer Iso-Hold
        </button>
      </div>
      
    </div>
    
  </div>

  <!-- ========== MODE RPE/RIR ========== -->
  <div id="mode-rpe" class="fixed inset-0 bg-void/95 z-40 hidden flex-col">
    
    <header class="px-4 py-4" style="padding-top: calc(env(safe-area-inset-top) + 8px);">
      <div class="text-center">
        <div class="text-xs font-bold text-white/40 uppercase tracking-widest">Evaluation Serie</div>
        <div class="font-display font-bold text-white mt-1">Serie <span id="rpe-set">3</span>/<span id="rpe-total-sets">5</span> ‚Ä¢ <span id="rpe-weight">75</span>kg ‚Ä¢ <span id="rpe-reps">6</span> reps</div>
      </div>
    </header>
    
    <div class="flex-1 px-4 pb-8 overflow-y-auto">
      
      <!-- RIR Slider -->
      <div class="mb-6">
        <div class="text-xs font-bold text-white/50 uppercase tracking-widest mb-3">Reps en Reserve (RIR)</div>
        <div class="rir-slider">
          <button class="rir-option" data-rir="3">
            <div class="rir-value font-mono font-bold text-xl text-white">3+</div>
            <div class="text-xs text-white/40 mt-1">Easy</div>
          </button>
          <button class="rir-option active" data-rir="2">
            <div class="rir-value font-mono font-bold text-xl text-cyan">2</div>
            <div class="text-xs text-white/40 mt-1">Good</div>
          </button>
          <button class="rir-option" data-rir="1">
            <div class="rir-value font-mono font-bold text-xl text-white">1</div>
            <div class="text-xs text-white/40 mt-1">Hard</div>
          </button>
          <button class="rir-option" data-rir="0">
            <div class="rir-value font-mono font-bold text-xl text-white">0</div>
            <div class="text-xs text-white/40 mt-1">Fail</div>
          </button>
        </div>
      </div>
      
      <!-- Score Technique -->
      <div class="glass-panel p-4 mb-6">
        <div class="text-xs font-bold text-white/50 uppercase tracking-widest mb-3">Score Technique</div>
        
        <div class="space-y-3">
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-white/60">Tempo</span>
              <span class="font-mono text-cyan">85%</span>
            </div>
            <div class="score-bar">
              <div class="score-bar-fill bg-gradient-to-r from-cyan to-emerald" style="width: 85%;"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-white/60">Range</span>
              <span class="font-mono text-emerald">100%</span>
            </div>
            <div class="score-bar">
              <div class="score-bar-fill bg-emerald" style="width: 100%;"></div>
            </div>
          </div>
          
          <div class="pt-2 border-t border-white/10">
            <div class="flex justify-between items-center">
              <span class="font-bold text-white">Score Global</span>
              <div class="flex items-center gap-2">
                <span class="font-mono font-bold text-2xl text-cyan">92</span>
                <span class="text-white/40">/100</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tags Rapides -->
      <div class="mb-6">
        <div class="text-xs font-bold text-white/50 uppercase tracking-widest mb-3">Tags Rapides</div>
        <div class="flex flex-wrap gap-2">
          <button class="tag-btn">Grip large</button>
          <button class="tag-btn">Tempo +1s</button>
          <button class="tag-btn">Pec dominant</button>
          <button class="tag-btn active">Epaule OK</button>
          <button class="tag-btn">Range reduit</button>
          <button class="tag-btn">Form drift</button>
        </div>
      </div>
      
      <!-- Continue Button -->
      <button id="btn-rpe-continue" class="btn-validate w-full text-black font-display">
        SUIVANT ‚Üí
      </button>
      
    </div>
    
  </div>

  <!-- ========== SCRIPTS ========== -->
  <script src="program-data.js"></script>
  <script src="app.js"></script>
  
  <script>
    // ========== STATE ==========
    const state = {
      currentExerciseIndex: 0,
      currentSet: 1,
      currentReps: 0,
      currentWeight: 75,
      restTime: 120,
      restRemaining: 0,
      isResting: false,
      selectedRIR: 2,
      exercises: [],
      workoutData: null
    };
    
    // ========== DOM ELEMENTS ==========
    const elements = {
      modeSerie: document.getElementById('mode-serie'),
      modeRepos: document.getElementById('mode-repos'),
      modeIntensification: document.getElementById('mode-intensification'),
      modeRpe: document.getElementById('mode-rpe'),
      exerciseName: document.getElementById('exercise-name'),
      muscleTag: document.getElementById('muscle-tag'),
      currentSet: document.getElementById('current-set'),
      totalSets: document.getElementById('total-sets'),
      tempoInfo: document.getElementById('tempo-info'),
      weightDisplay: document.getElementById('weight-display'),
      weightAdjustDisplay: document.getElementById('weight-adjust-display'),
      repCounter: document.getElementById('rep-counter'),
      targetReps: document.getElementById('target-reps'),
      coachingText: document.getElementById('coaching-text'),
      restTimer: document.getElementById('rest-timer'),
      restTotal: document.getElementById('rest-total'),
      restProgress: document.getElementById('rest-progress'),
      optimalMarker: document.getElementById('optimal-marker'),
      xpToast: document.getElementById('xp-toast'),
      xpAmount: document.getElementById('xp-amount'),
      flashScreen: document.getElementById('flash-screen'),
      particleContainer: document.getElementById('particle-container'),
      tempoDescent: document.getElementById('tempo-descent'),
      tempoLift: document.getElementById('tempo-lift')
    };
    
    // ========== INIT ==========
    function init() {
      loadWorkoutData();
      setupEventListeners();
      updateUI();
    }
    
    function loadWorkoutData() {
      const urlParams = new URLSearchParams(window.location.search);
      const week = parseInt(urlParams.get('week')) || 1;
      const day = urlParams.get('day') || 'dimanche';
      
      if (window.programData && window.programData.program) {
        const weekData = window.programData.program[`week${week}`];
        if (weekData && weekData[day]) {
          state.workoutData = weekData[day];
          state.exercises = weekData[day].exercises || [];
          document.getElementById('workout-name').textContent = weekData[day].name;
        }
      }
      
      if (state.exercises.length > 0) {
        loadExercise(0);
      }
    }
    
    function loadExercise(index) {
      if (index >= state.exercises.length) {
        finishWorkout();
        return;
      }
      
      const exercise = state.exercises[index];
      state.currentExerciseIndex = index;
      state.currentSet = 1;
      state.currentReps = 0;
      state.currentWeight = exercise.weight || 0;
      state.restTime = exercise.rest || 90;
      
      updateUI();
    }
    
    function updateUI() {
      const exercise = state.exercises[state.currentExerciseIndex];
      if (!exercise) return;
      
      elements.exerciseName.textContent = exercise.name;
      elements.currentSet.textContent = state.currentSet;
      elements.totalSets.textContent = exercise.sets;
      elements.tempoInfo.textContent = `Tempo ${exercise.tempo || '3-1-2'}`;
      elements.weightDisplay.innerHTML = `${state.currentWeight}<span class="text-sm text-white/50">kg</span>`;
      elements.weightAdjustDisplay.textContent = `${state.currentWeight} kg`;
      elements.repCounter.textContent = state.currentReps;
      elements.targetReps.textContent = exercise.reps;
      
      // Muscle tag color
      const muscles = exercise.muscle || [];
      const mainMuscle = muscles[0] || 'dos';
      updateMuscleColor(mainMuscle);
      elements.muscleTag.textContent = mainMuscle.toUpperCase();
      
      // Coaching text
      const coachingMessages = [
        '"Controle bas, explosion propre"',
        '"Lock les omoplates, respire"',
        '"Excentrique lent, concentrique explosif"',
        '"Une rep en reserve"'
      ];
      elements.coachingText.textContent = coachingMessages[state.currentSet % coachingMessages.length];
    }
    
    function updateMuscleColor(muscle) {
      const muscleClasses = ['muscle-dos', 'muscle-pecs', 'muscle-jambes', 'muscle-epaules', 'muscle-bras', 'muscle-abdos'];
      document.body.classList.remove(...muscleClasses);
      
      const muscleMap = {
        'dos': 'muscle-dos',
        'pectoraux': 'muscle-pecs',
        'pecs': 'muscle-pecs',
        'jambes': 'muscle-jambes',
        'quadriceps': 'muscle-jambes',
        'fessiers': 'muscle-jambes',
        'epaules': 'muscle-epaules',
        'bras': 'muscle-bras',
        'biceps': 'muscle-bras',
        'triceps': 'muscle-bras',
        'abdos': 'muscle-abdos'
      };
      
      const muscleClass = muscleMap[muscle.toLowerCase()] || 'muscle-dos';
      document.body.classList.add(muscleClass);
    }
    
    // ========== EVENT LISTENERS ==========
    function setupEventListeners() {
      // Rep buttons
      document.getElementById('btn-rep-minus').addEventListener('click', () => {
        if (state.currentReps > 0) {
          state.currentReps--;
          elements.repCounter.textContent = state.currentReps;
        }
      });
      
      document.getElementById('btn-rep-plus').addEventListener('click', () => {
        state.currentReps++;
        elements.repCounter.textContent = state.currentReps;
        animateTempoBars();
      });
      
      // Weight buttons
      document.getElementById('btn-weight-minus').addEventListener('click', () => {
        state.currentWeight = Math.max(0, state.currentWeight - 2.5);
        elements.weightDisplay.innerHTML = `${state.currentWeight}<span class="text-sm text-white/50">kg</span>`;
        elements.weightAdjustDisplay.textContent = `${state.currentWeight} kg`;
      });
      
      document.getElementById('btn-weight-plus').addEventListener('click', () => {
        state.currentWeight += 2.5;
        elements.weightDisplay.innerHTML = `${state.currentWeight}<span class="text-sm text-white/50">kg</span>`;
        elements.weightAdjustDisplay.textContent = `${state.currentWeight} kg`;
      });
      
      // Validate button
      document.getElementById('btn-validate').addEventListener('click', validateSet);
      
      // Skip rest
      document.getElementById('btn-skip-rest').addEventListener('click', endRest);
      
      // Intensification
      document.getElementById('btn-intensify').addEventListener('click', () => {
        elements.modeIntensification.classList.remove('hidden');
        elements.modeIntensification.classList.add('flex');
      });
      
      document.getElementById('btn-close-intensify').addEventListener('click', () => {
        elements.modeIntensification.classList.add('hidden');
        elements.modeIntensification.classList.remove('flex');
      });
      
      // RPE Continue
      document.getElementById('btn-rpe-continue').addEventListener('click', () => {
        elements.modeRpe.classList.add('hidden');
        elements.modeRpe.classList.remove('flex');
        startRest();
      });
      
      // RIR Options
      document.querySelectorAll('.rir-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.rir-option').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.selectedRIR = parseInt(btn.dataset.rir);
        });
      });
      
      // Rest presets
      document.querySelectorAll('.btn-preset').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const newTime = parseInt(btn.dataset.time);
          state.restTime = newTime;
          state.restRemaining = newTime;
          updateRestDisplay();
        });
      });
      
      // Tags
      document.querySelectorAll('.tag-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('active');
        });
      });
      
      // Back button
      document.getElementById('btn-back').addEventListener('click', () => {
        if (confirm('Quitter la session ?')) {
          window.location.href = 'workouts.html';
        }
      });
    }
    
    // ========== VALIDATE SET ==========
    function validateSet() {
      // Flash effect
      elements.flashScreen.classList.add('flash');
      setTimeout(() => elements.flashScreen.classList.remove('flash'), 150);
      
      // Particles
      createParticles();
      
      // XP Toast
      showXPToast(50);
      
      // Show RPE modal
      document.getElementById('rpe-set').textContent = state.currentSet;
      document.getElementById('rpe-total-sets').textContent = state.exercises[state.currentExerciseIndex].sets;
      document.getElementById('rpe-weight').textContent = state.currentWeight;
      document.getElementById('rpe-reps').textContent = state.currentReps;
      
      setTimeout(() => {
        elements.modeRpe.classList.remove('hidden');
        elements.modeRpe.classList.add('flex');
      }, 300);
    }
    
    // ========== REST TIMER ==========
    function startRest() {
      state.isResting = true;
      state.restRemaining = state.restTime;
      
      elements.modeRepos.classList.remove('hidden');
      elements.modeRepos.classList.add('flex');
      elements.modeSerie.classList.add('hidden');
      
      updateRestDisplay();
      
      // Start countdown
      const restInterval = setInterval(() => {
        if (!state.isResting) {
          clearInterval(restInterval);
          return;
        }
        
        state.restRemaining--;
        updateRestDisplay();
        
        if (state.restRemaining <= 0) {
          clearInterval(restInterval);
          endRest();
        }
      }, 1000);
    }
    
    function updateRestDisplay() {
      const minutes = Math.floor(state.restRemaining / 60);
      const seconds = state.restRemaining % 60;
      elements.restTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      const totalMinutes = Math.floor(state.restTime / 60);
      const totalSeconds = state.restTime % 60;
      elements.restTotal.textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
      
      // Update circle
      const circumference = 2 * Math.PI * 110; // 691
      const progress = state.restRemaining / state.restTime;
      const offset = circumference * (1 - progress);
      elements.restProgress.style.strokeDashoffset = offset;
      
      // Update optimal marker
      const markerPos = (1 - progress) * 100;
      elements.optimalMarker.style.left = `${markerPos}%`;
    }
    
    function endRest() {
      state.isResting = false;
      
      elements.modeRepos.classList.add('hidden');
      elements.modeRepos.classList.remove('flex');
      elements.modeSerie.classList.remove('hidden');
      
      // Next set or exercise
      const exercise = state.exercises[state.currentExerciseIndex];
      if (state.currentSet < exercise.sets) {
        state.currentSet++;
        state.currentReps = 0;
        updateUI();
      } else {
        loadExercise(state.currentExerciseIndex + 1);
      }
    }
    
    // ========== EFFECTS ==========
    function showXPToast(amount) {
      elements.xpAmount.textContent = `+${amount} XP`;
      elements.xpToast.classList.remove('opacity-0');
      elements.xpToast.classList.add('xp-toast');
      
      setTimeout(() => {
        elements.xpToast.classList.add('opacity-0');
        elements.xpToast.classList.remove('xp-toast');
      }, 2000);
    }
    
    function createParticles() {
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'particle-ring';
          particle.style.animationDelay = `${i * 0.1}s`;
          elements.particleContainer.appendChild(particle);
          
          setTimeout(() => particle.remove(), 700);
        }, i * 100);
      }
    }
    
    function animateTempoBars() {
      // Descent animation (3s)
      elements.tempoDescent.style.height = '100%';
      setTimeout(() => {
        elements.tempoDescent.style.height = '0%';
        // Lift animation (2s)
        elements.tempoLift.style.height = '100%';
        setTimeout(() => {
          elements.tempoLift.style.height = '0%';
        }, 2000);
      }, 3000);
    }
    
    function finishWorkout() {
      alert('Workout termine ! Redirection vers le debrief...');
      window.location.href = 'index.html';
    }
    
    // ========== INIT ==========
    document.addEventListener('DOMContentLoaded', init);
  </script>
  
</body>
</html>
