<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonFit - Statistics Hub</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. FONTS (Orbitron for HUD, Inter for UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- 3. CONFIGURATION TAILWIND -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              neon: { cyan: '#06b6d4', magenta: '#d946ef', lime: '#84cc16' }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              display: ['Orbitron', 'sans-serif'],
            },
            animation: {
              'spin-slow': 'spin 10s linear infinite',
              'spin-reverse-slow': 'spin 15s linear infinite reverse',
              'slideIn': 'slideIn 0.5s ease-out forwards',
              'shimmer': 'shimmer 2s infinite',
              'scan': 'scan 4s ease-in-out infinite',
            },
            keyframes: {
              slideIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              shimmer: {
                '0%': { transform: 'translateX(-100%)' },
                '100%': { transform: 'translateX(100%)' },
              },
              scan: {
                '0%, 100%': { transform: 'translateY(-100%)', opacity: '0' },
                '50%': { opacity: '0.3' }
              }
            }
          }
        }
      }
    </script>

    <!-- 4. IMPORT MAP (React & Lucide depuis le navigateur) -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0"
      }
    }
    </script>
    
    <!-- 5. BABEL (Pour compiler le JSX dans le navigateur) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background: #010101; color: #fff; overflow-x: hidden; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- APPLICATION LOGIC -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Activity, Heart, Zap, Flame, Trophy, Calendar, Settings, User, 
            Menu, X, Play, Pause, ChevronRight, Target, Bot, Plus, 
            MessageSquare, Trash2, Download, AlertCircle, TrendingUp,
            Layers, Clock, Battery, Fan, Disc, Dumbbell, Maximize2, RefreshCw, Cpu,
            RotateCcw, Power, Fingerprint, Hexagon
        } from 'lucide-react';

        // --- MOCK DATA / TYPES ---
        const ZONES = [
            { id: 'force', label: 'FORCE', range: '1-5 RM', percent: 15, sets: 6, color: 'bg-amber-500', shadow: 'shadow-amber-500/50' },
            { id: 'hyper', label: 'HYPERTROPHIE', range: '6-12 RM', percent: 65, sets: 28, color: 'bg-violet-500', shadow: 'shadow-violet-500/50' },
            { id: 'endu', label: 'ENDURANCE', range: '15+ RM', percent: 20, sets: 11, color: 'bg-cyan-500', shadow: 'shadow-cyan-500/50' },
        ];

        const MUSCLES_TURBINE = [
            { id: 'm1', name: 'PECTORAUX', volume: 2101, color: '#22d3ee' },
            { id: 'm2', name: 'DOS', volume: 2341, color: '#3b82f6' },
            { id: 'm3', name: 'JAMBES', volume: 2333, color: '#8b5cf6' },
            { id: 'm4', name: 'EPAULES', volume: 3151, color: '#d946ef' },
            { id: 'm5', name: 'BRAS', volume: 3015, color: '#f43f5e' },
            { id: 'm6', name: 'ABDOS', volume: 1200, color: '#10b981' },
        ];

        const MUSCLES_HUD = [
            { id: '1', name: 'PECS', sets: 12, volume: 2101, type: 'primary', normalized: 0.9, intensity: 8.5, recovery: 45 },
            { id: '2', name: 'DOS', sets: 16, volume: 2341, type: 'primary', normalized: 1.0, intensity: 9.2, recovery: 80 },
            { id: '3', name: 'JAMBES', sets: 14, volume: 2333, type: 'primary', normalized: 0.95, intensity: 9.5, recovery: 30 },
            { id: '4', name: 'EPAULES', sets: 10, volume: 3151, type: 'primary', normalized: 0.85, intensity: 7.8, recovery: 90 },
            { id: '5', name: 'BRAS', sets: 8, volume: 3015, type: 'primary', normalized: 0.8, intensity: 8.0, recovery: 95 },
            { id: '6', name: 'ABS', sets: 6, volume: 800, type: 'secondary', normalized: 0.6, intensity: 6.0, recovery: 100 },
        ];

        const WEEKS_DATA = [
            { id: 'w1', label: 'S1', volume: 28000, intensity: 75, status: 'completed', x: 60, y: 38 },
            { id: 'w2', label: 'S2', volume: 29500, intensity: 78, status: 'completed', x: 75, y: 55 },
            { id: 'w3', label: 'S3', volume: 27800, intensity: 72, status: 'current', x: 60, y: 75 },
            { id: 'w4', label: 'S4', volume: 31200, intensity: 80, status: 'upcoming', x: 35, y: 65 },
        ];

        // --- COMPONENTS ---

        // 1. NEON TRACKER (Radial Gauge)
        const NeonTracker = ({ score, sessions, sets, status }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const progressRefs = useRef({ sessions: 0, sets: 0, score: 0 });
            const isOptimal = score > 80;

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d', { alpha: true });
                if (!ctx) return;
                let animationId;

                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1;
                    const rect = containerRef.current.getBoundingClientRect();
                    const size = rect.width;
                    canvas.width = size * dpr;
                    canvas.height = size * dpr;
                    canvas.style.width = `${size}px`;
                    canvas.style.height = `${size}px`;
                    ctx.scale(dpr, dpr);
                };
                window.addEventListener('resize', handleResize);
                setTimeout(handleResize, 0);

                const toRad = (deg) => (deg * Math.PI) / 180;
                const createCarbonPattern = () => {
                    const pCanvas = document.createElement('canvas');
                    pCanvas.width = 8; pCanvas.height = 8;
                    const pCtx = pCanvas.getContext('2d');
                    if (pCtx) {
                        pCtx.fillStyle = '#050505'; pCtx.fillRect(0, 0, 8, 8);
                        pCtx.fillStyle = '#111'; pCtx.beginPath();
                        pCtx.moveTo(0, 8); pCtx.lineTo(8, 0); pCtx.lineTo(8, 8); pCtx.fill();
                    }
                    return ctx.createPattern(pCanvas, 'repeat');
                };

                const draw = () => {
                    if (!canvas) return;
                    const lerp = (start, end, factor) => start + (end - start) * factor;
                    progressRefs.current.sessions = lerp(progressRefs.current.sessions, sessions.current / sessions.max, 0.05);
                    progressRefs.current.sets = lerp(progressRefs.current.sets, sets.current / sets.max, 0.05);
                    progressRefs.current.score = lerp(progressRefs.current.score, score / 100, 0.05);

                    const size = canvas.width / (window.devicePixelRatio || 1);
                    const cx = size / 2; const cy = size / 2; const r = size * 0.42;

                    ctx.clearRect(0, 0, size, size);
                    
                    // Chassis
                    ctx.save();
                    ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 40; ctx.shadowOffsetY = 20;
                    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2);
                    const bezelGrad = ctx.createLinearGradient(0, 0, size, size);
                    bezelGrad.addColorStop(0, '#1e293b'); bezelGrad.addColorStop(0.5, '#0f172a'); bezelGrad.addColorStop(1, '#020617');
                    ctx.fillStyle = bezelGrad; ctx.fill(); ctx.restore();

                    // Carbon Face
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r * 0.95, 0, Math.PI * 2);
                    const pattern = createCarbonPattern(); if (pattern) ctx.fillStyle = pattern; ctx.fill();
                    const vignette = ctx.createRadialGradient(cx, cy, r * 0.5, cx, cy, r * 0.95);
                    vignette.addColorStop(0, 'rgba(0,0,0,0)'); vignette.addColorStop(1, 'rgba(0,0,0,0.9)');
                    ctx.fillStyle = vignette; ctx.fill(); ctx.restore();

                    // Rings
                    const startAngle = toRad(135); const totalAngle = toRad(270);
                    const drawRing = (radius, width, progress, color, glowColor) => {
                        const endAngle = startAngle + (totalAngle * progress);
                        ctx.lineCap = 'round';
                        ctx.beginPath(); ctx.arc(cx, cy, radius, startAngle, startAngle + totalAngle);
                        ctx.lineWidth = width; ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.stroke();
                        ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, radius, startAngle, endAngle);
                        ctx.lineWidth = width; ctx.strokeStyle = color; ctx.shadowColor = glowColor; ctx.shadowBlur = 20; ctx.stroke(); ctx.restore();
                        if (progress > 0) {
                            const tipX = cx + Math.cos(endAngle) * radius; const tipY = cy + Math.sin(endAngle) * radius;
                            ctx.beginPath(); ctx.arc(tipX, tipY, width/2, 0, Math.PI*2);
                            ctx.fillStyle = '#fff'; ctx.shadowColor = '#fff'; ctx.shadowBlur = 10; ctx.fill();
                        }
                    };
                    drawRing(r * 0.85, size * 0.04, progressRefs.current.sessions, '#3b82f6', '#3b82f6');
                    drawRing(r * 0.68, size * 0.03, progressRefs.current.sets, '#d946ef', '#d946ef');
                    const scoreColor = isOptimal ? '#f59e0b' : '#22d3ee';
                    drawRing(r * 0.55, size * 0.02, progressRefs.current.score, scoreColor, scoreColor);
                    
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r * 0.45, 0, Math.PI * 2); ctx.fillStyle = '#000'; ctx.fill(); ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 1; ctx.stroke(); ctx.restore();
                    animationId = requestAnimationFrame(draw);
                };
                draw();
                return () => { window.removeEventListener('resize', handleResize); cancelAnimationFrame(animationId); };
            }, [sessions, sets, score, isOptimal]);

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div>
                            <h2 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase">
                                <Cpu className="text-cyan-400" size={20} /> System Core
                            </h2>
                            <p className="text-[10px] text-gray-400 font-mono font-bold mt-1">PERFORMANCE TRACKER</p>
                        </div>
                        <div className={`px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border ${isOptimal ? 'border-amber-500/50 text-amber-500 bg-amber-500/10' : 'border-cyan-500/50 text-cyan-500 bg-cyan-500/10'}`}>
                            {status === 'consistent' ? 'OPTIMIZED' : 'WARNING'}
                        </div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-4 flex justify-center items-center relative" ref={containerRef}>
                        <div className="absolute inset-0 bg-cyan-500/5 blur-3xl rounded-full transform scale-75 pointer-events-none"></div>
                        <canvas ref={canvasRef} className="relative z-10 w-full aspect-square max-w-[350px]" />
                        <div className="absolute inset-0 flex items-center justify-center z-20 pointer-events-none">
                            <div className="flex flex-col items-center justify-center">
                                <span className="text-[9px] text-gray-500 tracking-[0.2em] font-display uppercase mb-1 font-bold">Sys.Opt</span>
                                <span className={`text-6xl font-display font-black tracking-tighter ${isOptimal ? 'text-amber-400 drop-shadow-[0_0_25px_rgba(251,191,36,0.6)]' : 'text-cyan-400 drop-shadow-[0_0_25px_rgba(34,211,238,0.6)]'}`}>
                                    {Math.round(score)}<span className="text-2xl align-top opacity-50">%</span>
                                </span>
                            </div>
                        </div>
                        <div className="absolute top-[45%] left-4 -translate-y-1/2 z-30 pointer-events-auto">
                            <div className="bg-black/80 backdrop-blur-md border border-blue-500/30 rounded-xl p-3 shadow-lg flex flex-col items-center w-20">
                                <div className="text-[9px] uppercase tracking-wider text-blue-400 font-bold mb-1">Séances</div>
                                <div className="text-xl font-display font-bold text-white leading-none">{sessions.current}<span className="text-[10px] text-gray-500">/{sessions.max}</span></div>
                            </div>
                        </div>
                        <div className="absolute top-[45%] right-4 -translate-y-1/2 z-30 pointer-events-auto">
                            <div className="bg-black/80 backdrop-blur-md border border-fuchsia-500/30 rounded-xl p-3 shadow-lg flex flex-col items-center w-20">
                                <div className="text-[9px] uppercase tracking-wider text-fuchsia-400 font-bold mb-1">Séries</div>
                                <div className="text-xl font-display font-bold text-white leading-none">{sets.current}<span className="text-[10px] text-gray-500">/{sets.max}</span></div>
                            </div>
                        </div>
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-3 divide-x divide-white/10">
                            <MiniStat icon={<Activity size={14}/>} label="HRV" value="42ms" color="text-emerald-400" />
                            <MiniStat icon={<Zap size={14}/>} label="KCAL" value="850" color="text-orange-400" />
                            <MiniStat icon={<Hexagon size={14}/>} label="FOCUS" value="98%" color="text-violet-400" />
                        </div>
                    </div>
                </div>
            );
        };
        const MiniStat = ({ icon, label, value, color }) => (
            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default h-24">
                <div className="text-gray-500 mb-1 opacity-80">{icon}</div>
                <div className="text-lg font-display font-bold text-white leading-none mb-1">{value}</div>
                <div className={`text-[9px] font-black uppercase tracking-widest ${color}`}>{label}</div>
            </div>
        );

        // 2. WEEKLY PROGRESS (Path Visualization)
        const WeeklyProgress = () => {
            const [hoveredWeek, setHoveredWeek] = useState(null);
            const [animReady, setAnimReady] = useState(false);
            useEffect(() => { setTimeout(() => setAnimReady(true), 100); }, []);
            const points = WEEKS_DATA.map(w => `${w.x},${w.y}`);
            const pathData = `M 50,50 L ${points.join(' L ')}`;
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 z-10 flex justify-between items-center">
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2"><TrendingUp className="text-cyan-400" size={20} /> PROGRESSION</h2>
                            <p className="text-[10px] text-gray-400 font-mono font-bold mt-1">HEBDOMADAIRE</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-cyan-500/20 text-[10px] font-black uppercase tracking-wider bg-cyan-500/5 text-cyan-400">CYCLE 1</div>
                    </div>
                    <div className="relative bg-[#020202] flex items-center justify-center p-6 h-[400px]">
                        <div className="absolute inset-0 opacity-20" style={{ backgroundImage: 'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255, 255, 255, 0.05) 1px, rgba(255, 255, 255, 0.05) 2px)' }}></div>
                        <div className="absolute inset-0 pointer-events-none">
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-[80%] bg-cyan-500/5 blur-[80px] rounded-full"></div>
                            {[25, 45, 65, 85].map((size, i) => (
                                <div key={i} className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border" style={{ width: `${size}%`, height: `${size}%`, borderColor: i === 3 ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.03)' }}></div>
                            ))}
                        </div>
                        <svg className="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stopColor="#06b6d4" stopOpacity="0.3" /><stop offset="30%" stopColor="#22d3ee" stopOpacity="0.8" /><stop offset="70%" stopColor="#22d3ee" stopOpacity="0.8" /><stop offset="100%" stopColor="#06b6d4" stopOpacity="0.3" />
                                </linearGradient>
                                <filter id="strongGlowLine"><feGaussianBlur stdDeviation="1.0" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            <path d={pathData} fill="none" stroke="rgba(255, 255, 255, 0.05)" strokeWidth="1.5" />
                            <path d={pathData} fill="none" stroke="url(#lineGrad)" strokeWidth="2.5" filter="url(#strongGlowLine)" strokeDasharray="200" strokeDashoffset={animReady ? "0" : "200"} className="transition-all duration-[2000ms] ease-out drop-shadow-[0_0_8px_rgba(34,211,238,0.3)]" strokeLinecap="round" strokeLinejoin="round" />
                        </svg>
                        <div className="absolute inset-0 z-20 w-full h-full">
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center w-24 h-24 rounded-full bg-black border-[2px] border-white/10 shadow-[0_0_30px_rgba(0,0,0,0.5)] z-10">
                                <div className="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-1">SCORE</div>
                                <div className="text-4xl font-black text-white leading-none">35</div>
                                <div className="text-[8px] text-cyan-500 font-mono mt-1 font-bold">/ 100</div>
                            </div>
                            {WEEKS_DATA.map((week) => {
                                const isHovered = hoveredWeek === week.id;
                                const isCurrent = week.status === 'current';
                                let translateClass = '';
                                if (week.x > 50 && week.y < 50) translateClass = 'translate-x-2 -translate-y-full';
                                else if (week.x > 50 && week.y >= 50) translateClass = 'translate-x-2 translate-y-2';
                                else if (week.x <= 50 && week.y >= 50) translateClass = '-translate-x-full translate-y-2';
                                else translateClass = '-translate-x-full -translate-y-full';
                                const badgeBorder = isCurrent ? 'border-red-500/50' : 'border-white/10';
                                const badgeBg = isCurrent ? 'bg-black/90' : 'bg-black/80';
                                const badgeText = isCurrent ? 'text-red-400' : 'text-cyan-400';
                                const dotColor = isCurrent ? 'bg-red-500' : 'bg-cyan-400';
                                const glowColor = isCurrent ? 'rgba(239, 68, 68, 0.6)' : 'rgba(34, 211, 238, 0.2)';
                                return (
                                    <div key={week.id} className="absolute" style={{ left: `${week.x}%`, top: `${week.y}%` }} onMouseEnter={() => setHoveredWeek(week.id)} onMouseLeave={() => setHoveredWeek(null)}>
                                        <div className="absolute -translate-x-1/2 -translate-y-1/2 group/node cursor-pointer">
                                            <div className={`w-3 h-3 rounded-full ${dotColor} relative z-10 transition-all duration-300 group-hover/node:scale-150`} style={{boxShadow: isCurrent ? `0 0 15px ${glowColor}, 0 0 30px ${glowColor}` : `0 0 5px ${glowColor}`}}></div>
                                            {isCurrent && (<><div className="absolute inset-0 -m-1 rounded-full bg-red-500/50 animate-pulse"></div></>)}
                                        </div>
                                        <div className={`absolute ${translateClass} transition-all duration-300 z-30 pointer-events-none ${isHovered ? 'scale-110' : 'scale-100'}`}>
                                            <div className={`backdrop-blur-md border px-3 py-2 rounded-xl flex flex-col min-w-[80px] ${badgeBg} ${badgeBorder} ${isCurrent ? 'shadow-lg' : 'shadow-none'}`}>
                                                <div className="flex justify-between items-center mb-1.5"><span className={`text-[9px] font-black uppercase px-1.5 py-0.5 rounded ${isCurrent ? 'bg-red-500 text-white' : 'bg-white/5 text-gray-400 border border-white/5'}`}>{week.label}</span></div>
                                                <div className="text-lg font-black text-white leading-none mb-1">{(week.volume / 1000).toFixed(1)}k</div>
                                                <div className={`text-[9px] font-mono font-bold ${badgeText}`}>{week.intensity}% INT</div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    <div className="relative bg-[#080808] border-t border-white/10">
                        <div className="relative grid grid-cols-4 divide-x divide-white/10">
                            {WEEKS_DATA.map((week, i) => {
                                const isHovered = hoveredWeek === week.id; const isCurrent = week.status === 'current';
                                return (
                                    <div key={i} className={`p-3 py-4 flex flex-col items-center justify-center transition-all cursor-pointer ${isHovered ? 'bg-white/5 scale-105' : 'hover:bg-white/5'} ${isCurrent ? 'bg-gradient-to-t from-red-500/10 to-transparent' : ''}`} onMouseEnter={() => setHoveredWeek(week.id)} onMouseLeave={() => setHoveredWeek(null)}>
                                        <div className="text-[9px] font-black text-gray-500 uppercase tracking-wider mb-1.5">SEM {i + 1}</div>
                                        <div className="text-lg font-black text-white leading-none mb-1">{(week.volume / 1000).toFixed(1)}k</div>
                                        <div className={`text-[8px] font-mono font-bold ${isCurrent ? 'text-red-400' : 'text-cyan-400'}`}>{week.intensity}% INT</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. VOLUME GAUGE
        const VolumeGauge = ({ volume, maxVolume = 25000, optimalMin = 15000, optimalMax = 22000, stats }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const currentValRef = useRef(0);
            const targetValRef = useRef(volume);
            useEffect(() => { targetValRef.current = volume; }, [volume]);
            useEffect(() => {
                const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d', { alpha: true }); if (!ctx) return;
                let animationId;
                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1; const rect = containerRef.current.getBoundingClientRect(); const size = rect.width;
                    canvas.width = size * dpr; canvas.height = size * dpr; canvas.style.width = `${size}px`; canvas.style.height = `${size}px`; ctx.scale(dpr, dpr);
                };
                window.addEventListener('resize', handleResize); setTimeout(handleResize, 0);
                const toRad = (deg) => (deg * Math.PI) / 180;
                const createCarbonPattern = () => {
                    const pCanvas = document.createElement('canvas'); pCanvas.width = 8; pCanvas.height = 8; const pCtx = pCanvas.getContext('2d');
                    if (pCtx) { pCtx.fillStyle = '#050505'; pCtx.fillRect(0, 0, 8, 8); pCtx.fillStyle = '#161616'; pCtx.beginPath(); pCtx.moveTo(0, 8); pCtx.lineTo(8, 0); pCtx.lineTo(8, 8); pCtx.fill(); }
                    return ctx.createPattern(pCanvas, 'repeat');
                };
                const draw = () => {
                    if (!canvas || !containerRef.current) return;
                    const diff = targetValRef.current - currentValRef.current;
                    if (Math.abs(diff) < 0.1) currentValRef.current = targetValRef.current; else currentValRef.current += diff * 0.08;
                    const size = canvas.width / (window.devicePixelRatio || 1); const cx = size / 2; const cy = size / 2; const r = size * 0.45;
                    const percent = Math.min(1, Math.max(0, currentValRef.current / maxVolume));
                    let themeColor = '#22d3ee';
                    const isOptimal = currentValRef.current >= optimalMin && currentValRef.current <= optimalMax;
                    const isOver = currentValRef.current > optimalMax;
                    if (isOptimal) themeColor = '#fbbf24'; else if (isOver) themeColor = '#ef4444';
                    
                    ctx.clearRect(0, 0, size, size);
                    ctx.save(); ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 30; ctx.shadowOffsetY = 10; ctx.beginPath(); ctx.arc(cx, cy, r * 1.05, 0, Math.PI * 2);
                    const bezelGrad = ctx.createLinearGradient(0, 0, size, size); bezelGrad.addColorStop(0, '#334155'); bezelGrad.addColorStop(0.5, '#0f172a'); bezelGrad.addColorStop(1, '#1e293b');
                    ctx.fillStyle = bezelGrad; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2); const pattern = createCarbonPattern(); if (pattern) ctx.fillStyle = pattern; ctx.fill();
                    const vignette = ctx.createRadialGradient(cx, cy, r * 0.6, cx, cy, r); vignette.addColorStop(0, 'rgba(0,0,0,0)'); vignette.addColorStop(1, 'rgba(0,0,0,0.9)'); ctx.fillStyle = vignette; ctx.fill(); ctx.restore();
                    
                    const startAng = toRad(135); const totalAng = toRad(270);
                    ctx.save();
                    const optStartPct = optimalMin / maxVolume; const optEndPct = optimalMax / maxVolume;
                    const optStartAng = startAng + (totalAng * optStartPct); const optEndAng = startAng + (totalAng * optEndPct);
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.85, optStartAng, optEndAng); ctx.lineWidth = r * 0.08; ctx.strokeStyle = 'rgba(251, 191, 36, 0.15)'; ctx.stroke();
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.92, optStartAng, optEndAng); ctx.lineWidth = 2; ctx.strokeStyle = '#fbbf24'; ctx.stroke(); ctx.restore();

                    ctx.save();
                    const tickCount = 50;
                    for (let i = 0; i <= tickCount; i++) {
                        const t = i / tickCount; const angle = startAng + (totalAng * t); const isMajor = i % 10 === 0; const isLit = t <= percent;
                        const outerRad = r * 0.82; const innerRad = outerRad - (isMajor ? r * 0.08 : r * 0.04);
                        const x1 = cx + Math.cos(angle) * innerRad; const y1 = cy + Math.sin(angle) * innerRad;
                        const x2 = cx + Math.cos(angle) * outerRad; const y2 = cy + Math.sin(angle) * outerRad;
                        ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
                        if (isLit) { ctx.strokeStyle = isMajor ? themeColor : 'rgba(255,255,255,0.5)'; ctx.lineWidth = isMajor ? 3 : 1; ctx.shadowColor = themeColor; ctx.shadowBlur = 10; } 
                        else { ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.shadowBlur = 0; }
                        ctx.stroke();
                        if (isMajor) {
                            const textRad = r * 0.65; const tx = cx + Math.cos(angle) * textRad; const ty = cy + Math.sin(angle) * textRad;
                            ctx.font = `bold ${Math.max(10, size * 0.04)}px "Orbitron", sans-serif`; ctx.fillStyle = isLit ? '#fff' : '#475569'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(`${Math.round((t * maxVolume) / 1000)}k`, tx, ty);
                        }
                    }
                    ctx.restore();

                    // LCD
                    ctx.save(); const lcdY = cy + r * 0.4; const lcdW = r * 0.6; const lcdH = r * 0.25;
                    ctx.fillStyle = '#000'; ctx.beginPath(); ctx.roundRect(cx - lcdW/2, lcdY - lcdH/2, lcdW, lcdH, 4); ctx.fill(); ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.stroke();
                    ctx.font = `bold ${size * 0.08}px "Orbitron", monospace`; ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.shadowColor = themeColor; ctx.shadowBlur = 15;
                    ctx.fillText(`${Math.round(currentValRef.current).toLocaleString()}`, cx, lcdY);
                    ctx.font = `bold ${size * 0.03}px "Inter", sans-serif`; ctx.fillStyle = themeColor; ctx.shadowBlur = 0; ctx.fillText("TOTAL LOAD (KG)", cx, lcdY + size * 0.06); ctx.restore();

                    // Needle
                    ctx.save(); const needleAngle = startAng + (totalAng * percent); const needleLen = r * 0.85;
                    ctx.translate(cx, cy); ctx.rotate(needleAngle); ctx.shadowColor = themeColor; ctx.shadowBlur = 20;
                    ctx.beginPath(); ctx.moveTo(0, -4); ctx.lineTo(needleLen, 0); ctx.lineTo(0, 4); ctx.lineTo(-15, 0); ctx.fillStyle = '#fff'; ctx.fill();
                    ctx.beginPath(); ctx.moveTo(needleLen * 0.7, -2); ctx.lineTo(needleLen, 0); ctx.lineTo(needleLen * 0.7, 2); ctx.fillStyle = themeColor; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, 6, 0, Math.PI * 2); ctx.fillStyle = '#cbd5e1'; ctx.fill(); ctx.beginPath(); ctx.arc(cx, cy, 2, 0, Math.PI * 2); ctx.fillStyle = '#0f172a'; ctx.fill(); ctx.restore();

                    animationId = requestAnimationFrame(draw);
                };
                draw();
                return () => { window.removeEventListener('resize', handleResize); cancelAnimationFrame(animationId); };
            }, [maxVolume, optimalMin, optimalMax]);

            const isOptimal = volume >= optimalMin && volume <= optimalMax;
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h3 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase"><TrendingUp size={18} className="text-cyan-400" />Volume Load</h3><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">WEEKLY ACCUMULATION</p></div>
                        <div className={`px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border ${isOptimal ? 'border-amber-500/50 text-amber-500 bg-amber-500/10' : 'border-cyan-500/50 text-cyan-500 bg-cyan-500/10'}`}>{isOptimal ? 'OPTIMAL ZONE' : 'BUILDING'}</div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex justify-center items-center relative" ref={containerRef}>
                        <div className="absolute inset-0 bg-cyan-500/5 blur-3xl rounded-full transform scale-75 pointer-events-none"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] opacity-50 [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)] pointer-events-none"></div>
                        <canvas ref={canvasRef} className="relative z-10 w-full aspect-square max-w-[350px]" />
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-2 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Layers size={12} /> Total Sets</span><span className="text-2xl font-display font-black text-white">{stats.sets}</span></div>
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Clock size={12} /> TUT (MIN)</span><span className="text-2xl font-display font-black text-white">{Math.floor(stats.tut / 60)}<span className="text-sm text-gray-500">:{String(stats.tut % 60).padStart(2, '0')}</span></span></div>
                        </div>
                    </div>
                    <div className={`py-1 text-center text-[8px] font-mono font-bold uppercase tracking-[0.2em] transition-colors duration-500 ${isOptimal ? 'bg-amber-500/20 text-amber-400' : 'bg-cyan-900/20 text-cyan-400'}`}>{isOptimal ? 'HYPERTROPHY RANGE ACTIVE' : 'ACCUMULATION PHASE'}</div>
                </div>
            );
        };

        // 4. MUSCLE HUD (Radar Chart)
        const MuscleHud = () => {
            const [selectedMuscle, setSelectedMuscle] = useState(MUSCLES_HUD[1]);
            const [hoveredMuscleId, setHoveredMuscleId] = useState(null);
            const [buildFactor, setBuildFactor] = useState(0);
            useEffect(() => { let start = 0; const animate = () => { start += 0.02; if (start >= 1) setBuildFactor(1); else { setBuildFactor(Math.pow(start, 0.5)); requestAnimationFrame(animate); } }; animate(); }, []);
            const size = 300; const center = size / 2; const radius = (size / 2) - 50; const angleStep = (Math.PI * 2) / MUSCLES_HUD.length;
            const getCoordinates = (index, value) => { const angle = index * angleStep - Math.PI / 2; const r = radius * value * buildFactor; return { x: center + Math.cos(angle) * r, y: center + Math.sin(angle) * r, angle }; };
            const polygonPoints = useMemo(() => MUSCLES_HUD.map((m, i) => { const { x, y } = getCoordinates(i, m.normalized); return `${x},${y}`; }).join(' '), [buildFactor]);
            const getWebPoints = (factor) => MUSCLES_HUD.map((_, i) => { const angle = i * angleStep - Math.PI / 2; const r = radius * factor; return `${center + Math.cos(angle) * r},${center + Math.sin(angle) * r}`; }).join(' ');

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="text-xl font-display font-black text-white tracking-widest uppercase flex items-center gap-2"><Cpu className="text-cyan-400" size={20} /> BIO-METRICS</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">VOLUME DISTRIBUTION ANALYSIS</p></div>
                        <div className="flex gap-2"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-gray-400 font-mono">{MUSCLES_HUD.length} ZONES</div></div>
                    </div>
                    <div className="relative flex-1 bg-[#020202] flex items-center justify-center p-6 group/chart">
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-cyan-900/10 via-transparent to-transparent opacity-60"></div>
                            <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)]"></div>
                            <div className="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/5 to-transparent h-[10px] w-full animate-scan pointer-events-none"></div>
                        </div>
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[400px] overflow-visible relative z-10">
                            <defs>
                                <linearGradient id="radarGradient" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#22d3ee" stopOpacity="0.6" /><stop offset="100%" stopColor="#8b5cf6" stopOpacity="0.1" /></linearGradient>
                                <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            {[0.25, 0.5, 0.75, 1].map((factor, i) => (<polygon key={`grid-${i}`} points={getWebPoints(factor)} fill="none" stroke={i === 3 ? "rgba(255,255,255,0.2)" : "rgba(255, 255, 255, 0.05)"} strokeWidth={i === 3 ? "1.5" : "1"} strokeDasharray={i !== 3 ? "4 4" : ""} />))}
                            {MUSCLES_HUD.map((_, i) => { const { x, y } = getCoordinates(i, 1); return (<line key={`axis-${i}`} x1={center} y1={center} x2={x} y2={y} stroke="rgba(255, 255, 255, 0.1)" strokeWidth="1" />); })}
                            <polygon points={polygonPoints} fill="url(#radarGradient)" stroke="#22d3ee" strokeWidth="3" filter="url(#glow)" className="drop-shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-300" strokeDasharray="1000" strokeDashoffset={1000 * (1 - buildFactor)} />
                            {MUSCLES_HUD.map((muscle, i) => {
                                const { x, y } = getCoordinates(i, muscle.normalized); const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                                return (
                                    <g key={`point-${i}`} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)} className="cursor-pointer">
                                        <circle cx={x} cy={y} r="20" fill="transparent" />
                                        <circle cx={x} cy={y} r={isHovered || isSelected ? 6 : 3} fill={muscle.type === 'primary' ? 'white' : '#94a3b8'} stroke={isSelected ? '#facc15' : '#22d3ee'} strokeWidth={isHovered || isSelected ? 3 : 2} className="transition-all duration-300" />
                                        {isSelected && (<circle cx={x} cy={y} r="12" fill="none" stroke="#facc15" strokeWidth="1" opacity="0.5"><animate attributeName="r" from="6" to="25" dur="1.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.8" to="0" dur="1.5s" repeatCount="indefinite" /></circle>)}
                                    </g>
                                );
                            })}
                        </svg>
                        {MUSCLES_HUD.map((muscle, i) => {
                            const angle = i * angleStep - Math.PI / 2; const labelRadius = radius + 35; const lx = center + Math.cos(angle) * labelRadius; const ly = center + Math.sin(angle) * labelRadius;
                            const leftPct = (lx / size) * 100; const topPct = (ly / size) * 100; const isPrimary = muscle.type === 'primary'; const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                            return (
                                <div key={`label-${i}`} className={`absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 z-50 flex flex-col items-center group/label cursor-pointer`} style={{ left: `${leftPct}%`, top: `${topPct}%` }} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)}>
                                    <div className={`flex items-center gap-1.5 px-2 py-1 rounded border backdrop-blur-md transition-all duration-300 ${isSelected ? 'bg-yellow-500/10 border-yellow-500 text-yellow-400 scale-110 shadow-[0_0_15px_rgba(234,179,8,0.4)]' : isHovered ? 'bg-cyan-500/10 border-cyan-400 text-white scale-105' : isPrimary ? 'bg-black/80 border-white/20 text-gray-200' : 'bg-black/60 border-transparent text-gray-500 hover:text-gray-300'}`}>
                                        {isPrimary && <Zap size={10} className={isSelected ? 'text-yellow-400' : 'text-cyan-400'} fill={isSelected ? "currentColor" : "none"}/>}
                                        <span className="text-[10px] md:text-xs font-black tracking-wider whitespace-nowrap">{muscle.name}</span>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-3 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><Activity size={12} /> INTENSITÉ</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.intensity > 8 ? 'text-red-500' : 'text-white'}`}>{selectedMuscle.intensity}<span className="text-sm text-gray-600">/10</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center bg-white/5 relative overflow-hidden group"><div className="absolute inset-0 bg-cyan-500/5 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div><div className="text-xs text-cyan-400 font-black uppercase tracking-[0.2em] mb-1 relative z-10">{selectedMuscle.name}</div><div className="text-xl font-display font-black text-white relative z-10">{selectedMuscle.volume.toLocaleString()} <span className="text-sm font-sans text-gray-500 font-medium">KG</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><RefreshCw size={12} /> RECOVERY</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.recovery < 50 ? 'text-orange-500' : 'text-emerald-500'}`}>{selectedMuscle.recovery}%</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. INTENSITY ZONES
        const IntensityZones = () => {
            const [active, setActive] = useState(false);
            const [selectedZone, setSelectedZone] = useState(null);
            useEffect(() => { const timer = setTimeout(() => setActive(true), 200); return () => clearTimeout(timer); }, []);
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group min-h-[400px]">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Battery className="text-cyan-400 -rotate-90" size={20} /> POWER DIST.</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">CAPACITEURS D'INTENSITÉ</p></div>
                        <div className="flex gap-2"><div className="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_10px_#22c55e]"></div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex flex-col justify-center gap-6 relative">
                        <div className="absolute right-0 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-white/10 to-transparent"></div>
                        {ZONES.map((zone) => {
                            const isSelected = selectedZone === zone.id;
                            return (
                                <div key={zone.id} className="relative group/bar cursor-pointer" onMouseEnter={() => setSelectedZone(zone.id)} onMouseLeave={() => setSelectedZone(null)}>
                                    <div className="flex justify-between items-end mb-2">
                                        <div className="flex items-center gap-2"><div className={`w-1.5 h-1.5 rounded-sm ${zone.color} ${zone.shadow} shadow-[0_0_8px_currentColor]`}></div><span className={`text-[10px] font-black uppercase tracking-widest transition-colors ${isSelected ? 'text-white' : 'text-gray-500'}`}>{zone.label}</span></div>
                                        <span className="text-[10px] font-mono text-gray-400">{zone.range}</span>
                                    </div>
                                    <div className="h-10 w-full bg-[#080808] border border-white/5 rounded flex p-1 relative overflow-hidden">
                                        <div className="absolute inset-0 bg-[linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:10px_100%]"></div>
                                        <div className={`h-full rounded-sm transition-all duration-1000 ease-out relative overflow-hidden flex items-center ${zone.color}`} style={{ width: active ? `${zone.percent}%` : '0%' }}>
                                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full -translate-x-full animate-[shimmer_2s_infinite]"></div>
                                            <div className="absolute inset-0 w-full h-full bg-[repeating-linear-gradient(90deg,transparent,transparent_4px,rgba(0,0,0,0.8)_4px,rgba(0,0,0,0.8)_5px)]"></div>
                                        </div>
                                        <div className="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2"><span className={`text-xl font-display font-black z-10 drop-shadow-md ${isSelected ? 'text-white' : 'text-gray-600'}`}>{zone.percent}%</span></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 h-16 relative">
                        <div className="absolute inset-0 flex items-center justify-between px-6">
                            {selectedZone ? (<><div className="flex flex-col animate-slideIn"><span className="text-[9px] text-gray-500 uppercase font-bold">Volume Sets</span><span className="text-xl font-display font-bold text-white">{ZONES.find(z => z.id === selectedZone)?.sets} <span className="text-sm text-gray-600">SÉRIES</span></span></div><div className="flex items-center gap-1 text-cyan-400 animate-pulse"><Activity size={14} /><span className="text-[9px] font-bold">ANALYZING</span></div></>) : (<div className="w-full flex justify-center items-center text-[10px] text-gray-600 font-mono tracking-widest animate-pulse">// SYSTEM READY //</div>)}
                        </div>
                    </div>
                </div>
            );
        };

        // 6. MUSCLE WORKLOAD (Turbine)
        const MuscleWorkload = () => {
            const [hoveredId, setHoveredId] = useState(null);
            const [buildFactor, setBuildFactor] = useState(0);
            useEffect(() => { let frame = 0; const animate = () => { frame += 0.015; if (frame >= 1) setBuildFactor(1); else { setBuildFactor(1 - Math.pow(1 - frame, 3)); requestAnimationFrame(animate); } }; animate(); }, []);
            const size = 300; const cx = size / 2; const cy = size / 2; const innerRadius = 40; const maxRadius = (size / 2) - 20; const availableDepth = maxRadius - innerRadius; const maxVol = Math.max(...MUSCLES_TURBINE.map(m => m.volume));
            const totalAngle = 360; const sectorAngle = (totalAngle / MUSCLES_TURBINE.length); const bladeWidth = sectorAngle - 4;
            const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => { const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0; return { x: centerX + (radius * Math.cos(angleInRadians)), y: centerY + (radius * Math.sin(angleInRadians)) }; };
            const describeBlade = (startAngle, endAngle, innerR, outerR) => {
                const start = polarToCartesian(cx, cy, outerR, endAngle); const end = polarToCartesian(cx, cy, outerR, startAngle);
                const startInner = polarToCartesian(cx, cy, innerR, endAngle); const endInner = polarToCartesian(cx, cy, innerR, startAngle);
                return ["M", startInner.x, startInner.y, "L", endInner.x, endInner.y, "L", end.x, end.y, "A", outerR, outerR, 0, 0, 0, start.x, start.y, "Z"].join(" ");
            };
            const activeMuscle = useMemo(() => MUSCLES_TURBINE.find(m => m.id === hoveredId) || MUSCLES_TURBINE.reduce((prev, current) => (prev.volume > current.volume) ? prev : current), [hoveredId]);
            
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Fan className="text-cyan-400 animate-spin-slow" size={20} /> KINETIC LOAD</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">DISTRIBUTION DE PUISSANCE</p></div>
                        <div className="flex gap-1"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-cyan-400 font-mono font-bold animate-pulse">LIVE</div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] relative flex items-center justify-center p-4 overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/20 via-black to-black pointer-events-none"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] h-[90%] border border-white/5 rounded-full opacity-30"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[60%] h-[60%] border border-white/5 rounded-full opacity-20 border-dashed animate-spin-reverse-slow"></div>
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[380px] overflow-visible relative z-10">
                            <defs>
                                {MUSCLES_TURBINE.map(m => (<linearGradient key={m.id} id={`grad-${m.id}`} x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor={m.color} stopOpacity="0.4" /><stop offset="100%" stopColor={m.color} stopOpacity="1" /></linearGradient>))}
                                <filter id="glow-blade"><feGaussianBlur stdDeviation="4" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            <g className={`origin-center transition-all duration-700 ${hoveredId ? '' : 'animate-spin-slow'}`} style={{ transformBox: 'fill-box' }}>
                                {MUSCLES_TURBINE.map((muscle, i) => {
                                    const startAngle = i * sectorAngle; const endAngle = startAngle + bladeWidth; const normalizedVol = muscle.volume / maxVol; const targetRadius = innerRadius + (availableDepth * normalizedVol); const currentRadius = innerRadius + ((targetRadius - innerRadius) * buildFactor); const isHovered = hoveredId === muscle.id;
                                    return (
                                        <g key={muscle.id} onMouseEnter={() => setHoveredId(muscle.id)} onMouseLeave={() => setHoveredId(null)} className="cursor-pointer transition-opacity duration-300" style={{ opacity: hoveredId && !isHovered ? 0.3 : 1 }}>
                                            <path d={describeBlade(startAngle, endAngle, innerRadius + 5, currentRadius)} fill={`url(#grad-${muscle.id})`} stroke="white" strokeWidth={isHovered ? 2 : 0} filter={isHovered ? "url(#glow-blade)" : undefined} className="transition-all duration-300 ease-out" style={{ transform: isHovered ? 'scale(1.05)' : 'scale(1)', transformOrigin: 'center', }} />
                                            {buildFactor > 0.8 && (<path d={describeBlade(startAngle + bladeWidth/2 - 0.5, startAngle + bladeWidth/2 + 0.5, innerRadius + 10, currentRadius - 10)} fill="rgba(255,255,255,0.3)" />)}
                                        </g>
                                    );
                                })}
                            </g>
                            <g>
                                <circle cx={cx} cy={cy} r={innerRadius - 2} fill="#050505" stroke="#333" strokeWidth="2" />
                                <circle cx={cx} cy={cy} r={innerRadius - 8} fill="none" stroke={activeMuscle.color} strokeWidth="2" strokeDasharray="4 2" className="animate-spin-slow origin-center" style={{ transformBox: 'fill-box' }}/>
                                <foreignObject x={cx - innerRadius} y={cy - innerRadius} width={innerRadius * 2} height={innerRadius * 2}>
                                    <div className="w-full h-full flex flex-col items-center justify-center text-center"><div className="text-[8px] font-mono text-gray-500 mb-0.5 tracking-tighter">TARGET</div><div className="text-[10px] font-black text-white leading-none uppercase tracking-wide truncate w-full px-1">{activeMuscle.name.substring(0, 4)}</div></div>
                                </foreignObject>
                            </g>
                        </svg>
                        <div className="absolute bottom-4 left-0 w-full px-6 flex justify-between items-end pointer-events-none">
                            <div className="flex flex-col"><span className="text-[9px] text-gray-500 font-mono mb-1">SELECTED ZONE</span><span className="text-2xl font-display font-black text-white leading-none drop-shadow-md">{activeMuscle.name}</span></div>
                            <div className="flex flex-col items-end"><span className="text-[9px] text-gray-500 font-mono mb-1">VOLUME LOAD</span><div className="flex items-baseline gap-1"><span className="text-2xl font-display font-black leading-none" style={{ color: activeMuscle.color }}>{(activeMuscle.volume / 1000).toFixed(1)}</span><span className="text-xs font-bold text-gray-400">k</span></div></div>
                        </div>
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 p-1">
                        <div className="flex justify-center gap-4 py-3 flex-wrap">
                            {MUSCLES_TURBINE.slice(0, 4).map(m => (<div key={m.id} className="flex items-center gap-1.5 opacity-70 hover:opacity-100 transition-opacity cursor-default"><div className="w-2 h-2 rounded-full shadow-[0_0_5px_currentColor]" style={{ backgroundColor: m.color }}></div><span className="text-[9px] font-bold text-gray-300 uppercase tracking-wide">{m.name}</span></div>))}
                            <div className="flex items-center gap-1.5 opacity-50"><span className="text-[9px] font-bold text-gray-500">+2 OTHERS</span></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [loading, setLoading] = useState(true);
            const [bootStep, setBootStep] = useState(0);
            
            // --- DATA INTEGRATION ---
            // Load initial data or fallback to defaults
            const [score, setScore] = useState(84);
            const [sessions, setSessions] = useState(4);
            const [maxSessions, setMaxSessions] = useState(5);
            const [sets, setSets] = useState(45);
            const [maxSets, setMaxSets] = useState(60);
            const [volume, setVolume] = useState(18500);

            // Listen for data from Vanilla JS app via LocalStorage
            useEffect(() => {
                const checkData = () => {
                    const rawData = localStorage.getItem('NEONFIT_DATA');
                    if (rawData) {
                        try {
                            const data = JSON.parse(rawData);
                            setScore(data.score || 84);
                            setSessions(data.sessions || 4);
                            setSets(data.sets || 45);
                            setVolume(data.volume || 18500);
                        } catch (e) { console.error('Data parse error', e); }
                    }
                };
                
                checkData();
                window.addEventListener('storage', checkData); // Listen for updates
                return () => window.removeEventListener('storage', checkData);
            }, []);

            // Boot Sequence
            useEffect(() => {
                if (!loading) return;
                const timeouts = [
                    setTimeout(() => setBootStep(1), 500),
                    setTimeout(() => setBootStep(2), 1200),
                    setTimeout(() => setBootStep(3), 2000),
                    setTimeout(() => setLoading(false), 2800),
                ];
                return () => timeouts.forEach(clearTimeout);
            }, [loading]);

            if (loading) {
                return (
                    <div className="fixed inset-0 bg-[#020202] text-cyan-500 font-mono z-50 flex flex-col items-center justify-center p-8 select-none">
                        <div className="w-full max-w-[300px] flex flex-col gap-4">
                            <div className="flex justify-between items-center border-b border-cyan-900/50 pb-2 mb-4">
                                <span className="text-xs font-bold tracking-[0.2em] animate-pulse">NEON.FIT V2.5</span>
                                <Power size={14} className="animate-spin-slow"/>
                            </div>
                            <div className="space-y-1 text-[10px] uppercase tracking-wider text-cyan-700">
                                <div className={bootStep >= 0 ? 'text-cyan-400' : ''}>[ SYSTEM_BOOT ] ... OK</div>
                                <div className={bootStep >= 1 ? 'text-cyan-400' : ''}>[ MEMORY_CHECK ] ... 64TB OK</div>
                                <div className={bootStep >= 2 ? 'text-cyan-400' : ''}>[ LOADING_USER_DATA ] ... OK</div>
                                <div className={bootStep >= 3 ? 'text-cyan-400' : ''}>[ ESTABLISHING_LINK ] ... SECURE</div>
                            </div>
                            <div className="h-1 w-full bg-cyan-900/30 mt-8 relative overflow-hidden"><div className="absolute inset-y-0 left-0 bg-cyan-400 animate-[slideIn_2.5s_ease-out_forwards]"></div></div>
                            <div className="mt-2 text-center text-xs text-cyan-600 animate-pulse">{bootStep === 3 ? 'ACCESS GRANTED' : 'INITIALIZING...'}</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#010101] text-white font-sans overflow-x-hidden relative selection:bg-cyan-500/30 pb-20">
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-fuchsia-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 [mask-image:linear-gradient(to_bottom,transparent,black_80%)]"></div>
                    </div>
                    
                    <header className="sticky top-0 left-0 w-full z-40 bg-[#010101]/80 backdrop-blur-lg border-b border-white/5 transition-all duration-300">
                        <div className="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
                            <div><h1 className="font-display font-black text-xl tracking-tighter text-white flex items-center gap-1"><Fingerprint size={18} className="text-cyan-400" />NEON<span className="text-cyan-400">.FIT</span></h1></div>
                            <button onClick={() => window.location.reload()} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:bg-white/10 transition-all active:scale-95"><RotateCcw size={14} /></button>
                        </div>
                    </header>

                    <main className="relative z-10 w-full max-w-md mx-auto px-4 py-6 flex flex-col gap-6">
                        <div className="animate-slideIn" style={{ animationDelay: '0.1s' }}><NeonTracker score={score} sessions={{ current: sessions, max: maxSessions }} sets={{ current: sets, max: maxSets }} status={score > 80 ? 'consistent' : 'warning'} /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.2s' }}><WeeklyProgress /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.3s' }}><VolumeGauge volume={volume} maxVolume={25000} stats={{ sets: sets, tut: 2450, sessions: sessions }} /></div>
                        <div className="grid gap-6">
                            <div className="animate-slideIn" style={{ animationDelay: '0.4s' }}><MuscleWorkload /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.5s' }}><IntensityZones /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.6s' }}><MuscleHud /></div>
                        </div>
                    </main>

                    <footer className="fixed bottom-0 left-0 w-full bg-[#050505]/90 backdrop-blur border-t border-white/5 py-4 z-40">
                        <div className="max-w-md mx-auto flex justify-center text-[10px] text-gray-600 font-mono tracking-widest uppercase">// END OF STREAM //</div>
                    </footer>
                </div>
            );
        };

        // RENDER
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
