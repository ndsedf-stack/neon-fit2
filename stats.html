<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NeonFit - Statistics Hub</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="cloud-sync-supabase.js"></script>
    <script src="scramble-effect.js"></script>
    <script src="starfield.js"></script>
    
    <!-- 2. FONTS (Orbitron for HUD, Inter for UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- 3. CONFIGURATION TAILWIND -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              neon: { cyan: '#06b6d4', magenta: '#d946ef', lime: '#84cc16' }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              display: ['Orbitron', 'sans-serif'],
            },
            animation: {
              'spin-slow': 'spin 10s linear infinite',
              'spin-reverse-slow': 'spin 15s linear infinite reverse',
              'slideIn': 'slideIn 0.5s ease-out forwards',
              'shimmer': 'shimmer 2s infinite',
              'scan': 'scan 4s ease-in-out infinite',
            },
            keyframes: {
              slideIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              shimmer: {
                '0%': { transform: 'translateX(-100%)' },
                '100%': { transform: 'translateX(100%)' },
              },
              scan: {
                '0%, 100%': { transform: 'translateY(-100%)', opacity: '0' },
                '50%': { opacity: '0.3' }
              }
            }
          }
        }
      }
    </script>

    <!-- 4. IMPORT MAP (React & Lucide depuis le navigateur) -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0"
      }
    }
    </script>
    
    <!-- 5. BABEL (Pour compiler le JSX dans le navigateur) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 6. STATS DATA MODULE -->
    <script src="stats-data.js"></script>

    <!-- 7. DEMO DATA GENERATOR (4 weeks simulation) -->
    <script>
    (function() {
        const DEMO_STORAGE_KEY = 'neon_fit_workout_history';
        const existingData = localStorage.getItem(DEMO_STORAGE_KEY);
        
        // Only generate demo data if no real data exists
        if (!existingData || JSON.parse(existingData).length === 0) {
            console.log('[NEON FIT] Generating 4 weeks demo data...');
            
            const exercises = [
                // Week 1-4 exercises based on program-data
                // DIMANCHE: DOS + JAMBES + BRAS
                { name: "Trap Bar Deadlift", muscle: "dos", baseWeight: 75 },
                { name: "Goblet Squat", muscle: "jambes", baseWeight: 25 },
                { name: "Leg Press", muscle: "jambes", baseWeight: 110 },
                { name: "Lat Pulldown", muscle: "dos", baseWeight: 60 },
                { name: "Seated Row", muscle: "dos", baseWeight: 55 },
                { name: "Incline Curl", muscle: "biceps", baseWeight: 10 },
                { name: "Triceps Pushdown", muscle: "triceps", baseWeight: 25 },
                
                // MARDI: PECTORAUX + ÉPAULES
                { name: "Incline Dumbbell Press", muscle: "pectoraux", baseWeight: 28 },
                { name: "Machine Chest Press", muscle: "pectoraux", baseWeight: 50 },
                { name: "Cable Fly", muscle: "pectoraux", baseWeight: 15 },
                { name: "Shoulder Press", muscle: "épaules", baseWeight: 20 },
                { name: "Lateral Raise", muscle: "épaules", baseWeight: 8 },
                { name: "Rear Delt Fly", muscle: "épaules", baseWeight: 10 },
                
                // VENDREDI: FULL BODY
                { name: "Romanian Deadlift", muscle: "jambes", baseWeight: 60 },
                { name: "Bulgarian Split Squat", muscle: "jambes", baseWeight: 12 },
                { name: "Pull-ups", muscle: "dos", baseWeight: 0 },
                { name: "Dips", muscle: "pectoraux", baseWeight: 0 },
                { name: "Face Pull", muscle: "épaules", baseWeight: 20 }
            ];
            
            const demoHistory = [];
            const days = ['dimanche', 'mardi', 'vendredi'];
            
            for (let week = 1; week <= 4; week++) {
                days.forEach((day, dayIndex) => {
                    // Select exercises for this day
                    const dayExercises = day === 'dimanche' 
                        ? exercises.slice(0, 7)
                        : day === 'mardi' 
                            ? exercises.slice(7, 13)
                            : exercises.slice(13);
                    
                    dayExercises.forEach(ex => {
                        const setsCount = Math.floor(Math.random() * 2) + 3; // 3-4 sets
                        for (let set = 1; set <= setsCount; set++) {
                            const reps = Math.floor(Math.random() * 5) + 8; // 8-12 reps
                            const weight = ex.baseWeight + (week * 2.5) + (Math.random() * 5 - 2.5);
                            
                            demoHistory.push({
                                exercise: ex.name,
                                muscle: ex.muscle,
                                week: week,
                                day: day,
                                set: set,
                                reps: reps,
                                weight: Math.round(weight * 2) / 2, // Round to 0.5
                                targetReps: reps,
                                completedAt: new Date(Date.now() - ((4 - week) * 7 + (2 - dayIndex) * 2) * 24 * 60 * 60 * 1000).toISOString()
                            });
                        }
                    });
                });
            }
            
            localStorage.setItem(DEMO_STORAGE_KEY, JSON.stringify(demoHistory));
            localStorage.setItem('hybrid_xp', '4500');
            localStorage.setItem('hybrid_current_week', '4');
            localStorage.setItem('hybrid_streak', '12');
            
            console.log('[NEON FIT] Demo data generated:', demoHistory.length, 'sets');
        }
    })();
    </script>

    <style>
        body { 
            background: #010101; 
            color: #fff; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-overflow-scrolling: touch;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
    </style>
</head>
<body>
    <canvas id="starfield-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;"></canvas>
    <div id="root"></div>

    <!-- APPLICATION LOGIC -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Activity, Heart, Zap, Flame, Trophy, Calendar, Settings, User, 
            Menu, X, Play, Pause, ChevronRight, Target, Bot, Plus, Check,
            MessageSquare, Trash2, Download, AlertCircle, TrendingUp, TrendingDown,
            Layers, Clock, Battery, Fan, Disc, Dumbbell, Maximize2, RefreshCw, Cpu,
            RotateCcw, Power, Fingerprint, Hexagon, Crosshair, Scale, ScanLine
        } from 'lucide-react';

        // --- REAL DATA FROM STATSDATA ---
        const getZones = () => window.StatsData ? window.StatsData.getZonesData() : [
            { id: 'force', label: 'FORCE', range: '1-5 RM', percent: 0, sets: 0, color: 'bg-amber-500', shadow: 'shadow-amber-500/50' },
            { id: 'hyper', label: 'HYPERTROPHIE', range: '6-12 RM', percent: 0, sets: 0, color: 'bg-violet-500', shadow: 'shadow-violet-500/50' },
            { id: 'endu', label: 'ENDURANCE', range: '15+ RM', percent: 0, sets: 0, color: 'bg-cyan-500', shadow: 'shadow-cyan-500/50' },
        ];

        const getMusclesTurbine = () => {
            if (!window.StatsData) return [
                { id: 'm1', name: 'DOS', volume: 0, color: '#3b82f6' },
                { id: 'm2', name: 'PECTORAUX', volume: 0, color: '#22d3ee' },
                { id: 'm3', name: 'JAMBES', volume: 0, color: '#8b5cf6' },
                { id: 'm4', name: 'ÉPAULES', volume: 0, color: '#d946ef' },
                { id: 'm5', name: 'BRAS', volume: 0, color: '#f43f5e' },
                { id: 'm6', name: 'ABDOS', volume: 0, color: '#10b981' },
            ];
            const data = window.StatsData.getMusclesData();
            if (data.length === 0) return [
                { id: 'm1', name: 'DOS', volume: 0, color: '#3b82f6' },
                { id: 'm2', name: 'PECTORAUX', volume: 0, color: '#22d3ee' },
                { id: 'm3', name: 'JAMBES', volume: 0, color: '#8b5cf6' },
                { id: 'm4', name: 'ÉPAULES', volume: 0, color: '#d946ef' },
                { id: 'm5', name: 'BRAS', volume: 0, color: '#f43f5e' },
                { id: 'm6', name: 'ABDOS', volume: 0, color: '#10b981' },
            ];
            return data;
        };

        const getMusclesHUD = () => {
            if (!window.StatsData) return [
                { id: '1', name: 'PECS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '2', name: 'DOS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '3', name: 'JAMB', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
            ];
            const data = window.StatsData.getMusclesHUD();
            if (data.length === 0) return [
                { id: '1', name: 'PECS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '2', name: 'DOS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '3', name: 'JAMB', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
            ];
            return data;
        };

        const getWeeksData = () => {
            if (!window.StatsData) return [
                { id: 'w1', label: 'S1', volume: 0, intensity: 0, status: 'current', x: 60, y: 38 },
            ];
            return window.StatsData.getWeeksData();
        };

        // --- COMPONENTS ---

        // 1. NEON TRACKER V7 (Fighter HUD with Particles)
        const NeonTracker = ({ score, sessions, sets, status }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const [showInfo, setShowInfo] = useState(false);
            
            const animState = useRef({
                sessions: 0,
                sets: 0,
                score: 0,
                rotation: 0,
                pulse: 0,
            });

            const particles = useRef([]);

            // Stats Grid Data
            const statsGrid = [
                { label: 'HRV', value: '72ms', icon: Zap, color: 'cyan' },
                { label: 'KCAL', value: '3420', icon: Flame, color: 'orange' },
                { label: 'FOCUS', value: '94%', icon: Target, color: 'purple' },
                { label: 'LOAD', value: '68%', icon: TrendingUp, color: 'green' },
                { label: 'RANK', value: '#12', icon: Trophy, color: 'yellow' },
                { label: 'RECO', value: '88%', icon: Heart, color: 'blue' },
            ];

            // Initialize particles
            useEffect(() => {
                if (particles.current.length === 0) {
                    for(let i = 0; i < 40; i++) {
                        particles.current.push({
                            x: 0, y: 0,
                            r: Math.random() * 1.5,
                            speed: 0.005 + Math.random() * 0.01,
                            angle: Math.random() * Math.PI * 2,
                            dist: 0.4 + Math.random() * 0.5,
                        });
                    }
                }
            }, []);

            // Canvas render loop
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d', { alpha: true });
                if (!ctx) return;

                let animationId;

                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1;
                    const rect = containerRef.current.getBoundingClientRect();
                    const size = rect.width;

                    canvas.width = size * dpr;
                    canvas.height = size * dpr;
                    canvas.style.width = `${size}px`;
                    canvas.style.height = `${size}px`;
                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    ctx.scale(dpr, dpr);
                };

                window.addEventListener('resize', handleResize);
                setTimeout(handleResize, 0);

                const toRad = (deg) => (deg * Math.PI) / 180;

                const draw = () => {
                    if (!canvas) return;
                    
                    // Animation Physics
                    const lerp = (start, end, factor) => start + (end - start) * factor;
                    animState.current.sessions = lerp(animState.current.sessions, sessions.current / sessions.max, 0.05);
                    animState.current.sets = lerp(animState.current.sets, sets.current / sets.max, 0.05);
                    animState.current.score = lerp(animState.current.score, score / 100, 0.04);
                    
                    animState.current.rotation += 0.002;
                    animState.current.pulse = (Math.sin(Date.now() / 500) + 1) * 0.5;

                    const size = canvas.width / (window.devicePixelRatio || 1);
                    const cx = size / 2;
                    const cy = size / 2;
                    const r = size * 0.40;

                    ctx.clearRect(0, 0, size, size);
                    ctx.globalCompositeOperation = 'screen';

                    // 1. BACKGROUND GRID (Fighter Jet Style - Rotating ellipses)
                    ctx.save();
                    ctx.strokeStyle = 'rgba(217, 70, 239, 0.1)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for(let i = 0; i < 5; i++) {
                        const rot = (i * Math.PI/2.5) + animState.current.rotation;
                        ctx.ellipse(cx, cy, r*1.1, r*0.6, rot, 0, Math.PI * 2);
                    }
                    ctx.stroke();
                    ctx.restore();

                    // 2. RINGS (Fighter HUD Style with Gradients)
                    const drawFighterRing = (radius, width, progress, hueStart, hueEnd) => {
                        const startAngle = toRad(145);
                        const totalAngle = toRad(250);
                        const endAngle = startAngle + (totalAngle * progress);

                        ctx.save();
                        ctx.lineCap = 'round';
                        
                        // Gradient
                        const gradient = ctx.createLinearGradient(cx - radius, cy, cx + radius, cy);
                        gradient.addColorStop(0, `hsl(${hueStart}, 100%, 50%)`);
                        gradient.addColorStop(1, `hsl(${hueEnd}, 100%, 60%)`);

                        // Track background
                        ctx.beginPath();
                        ctx.arc(cx, cy, radius, startAngle, startAngle + totalAngle);
                        ctx.lineWidth = width;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                        ctx.stroke();
                        
                        // Glowing Stroke
                        ctx.shadowBlur = 20;
                        ctx.shadowColor = `hsl(${hueEnd}, 100%, 50%)`;
                        ctx.beginPath();
                        ctx.arc(cx, cy, radius, startAngle, endAngle);
                        ctx.lineWidth = width;
                        ctx.strokeStyle = gradient;
                        ctx.stroke();
                        
                        // Inner White Core (Tube effect)
                        ctx.shadowBlur = 5;
                        ctx.lineWidth = width * 0.3;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.stroke();

                        ctx.restore();
                    };

                    // Outer Ring (Deep Indigo/Violet) - FREQ
                    drawFighterRing(r * 1.0, size * 0.035, animState.current.sessions, 240, 260);
                    // Middle Ring (Hot Pink/Fuchsia) - VOL
                    drawFighterRing(r * 0.85, size * 0.035, animState.current.sets, 310, 340);
                    // Inner Ring (Gold/Amber) - Score
                    drawFighterRing(r * 0.70, size * 0.035, animState.current.score, 30, 50);

                    // 3. PARTICLES (Floating orbital dust)
                    ctx.save();
                    particles.current.forEach(p => {
                        p.angle += p.speed;
                        const xRadius = r * 0.8 * p.dist;
                        const yRadius = r * 0.8 * p.dist;
                        
                        const px = cx + Math.cos(p.angle) * xRadius;
                        const py = cy + Math.sin(p.angle) * yRadius;
                        
                        const scale = 0.5 + (Math.sin(p.angle * 2) + 1) * 0.5;
                        ctx.beginPath();
                        ctx.arc(px, py, p.r * scale, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 255, 255, ${scale * 0.8})`;
                        ctx.fill();
                    });
                    ctx.restore();

                    animationId = requestAnimationFrame(draw);
                };

                draw();
                return () => {
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(animationId);
                };
            }, [sessions, sets, score]);

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden shadow-2xl transition-all hover:border-white/20 group">
                    
                    {/* PART 1: VISUALIZER (FIGHTER HUD) */}
                    <div className="relative h-[440px] w-full bg-gradient-to-b from-[#050505] to-[#020202] border-b border-white/10">
                        
                        {/* Header Overlay */}
                        <div className="absolute top-0 left-0 w-full p-5 flex justify-between items-center z-20">
                            <div className="flex items-center gap-2">
                                <Crosshair className="text-cyan-400 animate-spin-slow" size={20} />
                                <h2 className="font-display font-bold text-white tracking-[0.2em] uppercase text-lg">FIGHTER.HUD</h2>
                            </div>
                            
                            {/* INFO BUTTON */}
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => setShowInfo(!showInfo)}
                                    className="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-cyan-400 hover:bg-white/10 transition-colors"
                                >
                                    {showInfo ? <X size={14} /> : <AlertCircle size={14} />}
                                </button>
                                <div className="px-3 py-1 border border-green-500/50 bg-green-500/10 text-green-400 text-[10px] font-black tracking-widest rounded uppercase animate-pulse flex items-center">
                                    READY
                                </div>
                            </div>
                        </div>
                        <div className="absolute top-12 left-5 z-20 flex items-center gap-2">
                            <div className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></div>
                            <span className="text-[10px] text-cyan-400 font-mono font-bold tracking-widest">LIVE TELEMETRY</span>
                        </div>

                        {/* Canvas Container */}
                        <div className="absolute inset-0 flex items-center justify-center pt-12" ref={containerRef}>
                            <canvas ref={canvasRef} className="w-full h-full relative z-10" style={{ mixBlendMode: 'screen' }} />
                        </div>

                        {/* Center Data (TARGET LOCKED) */}
                        <div className="absolute inset-0 flex items-center justify-center z-20 pointer-events-none pt-12">
                            <div className="flex flex-col items-center justify-center mt-4">
                                <div className="text-[10px] text-white font-black tracking-[0.4em] mb-1 uppercase drop-shadow-[0_0_5px_rgba(255,255,255,0.8)] animate-pulse">
                                    TARGET LOCKED
                                </div>
                                {/* BIG NUMBER (Gold/Yellow Gradient) */}
                                <div className="text-8xl font-display font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-100 to-yellow-500 drop-shadow-[0_0_25px_rgba(234,179,8,0.5)] tracking-tighter leading-none">
                                    {Math.round(score)}
                                </div>
                                <div className="h-1 w-16 bg-cyan-500 rounded-full mt-4 shadow-[0_0_10px_#06b6d4]"></div>
                            </div>
                        </div>

                        {/* Floating Badges */}
                        {/* Left Badge - FREQ (Deep Indigo/Violet) */}
                        <div className="absolute top-[55%] left-4 -translate-y-1/2 z-30">
                            <div className="bg-[#0f0a1a] border border-indigo-500/40 p-3 rounded-xl shadow-[0_0_20px_rgba(99,102,241,0.2)] flex flex-col items-center w-20 backdrop-blur-sm">
                                <div className="text-[9px] font-bold text-indigo-400 mb-1 flex items-center gap-1"><RefreshCw size={10}/> FREQ</div>
                                <div className="text-2xl font-display font-bold text-white leading-none">
                                    {sessions.current}<span className="text-[10px] text-gray-500 font-mono">/{sessions.max}</span>
                                </div>
                            </div>
                        </div>
                        {/* Right Badge - VOL (Hot Pink/Fuchsia) */}
                        <div className="absolute top-[55%] right-4 -translate-y-1/2 z-30">
                            <div className="bg-[#1a0b1a] border border-fuchsia-500/40 p-3 rounded-xl shadow-[0_0_20px_rgba(217,70,239,0.2)] flex flex-col items-center w-20 backdrop-blur-sm">
                                <div className="text-[9px] font-bold text-fuchsia-400 mb-1 flex items-center gap-1"><Layers size={10}/> VOL</div>
                                <div className="text-2xl font-display font-bold text-white leading-none">
                                    {sets.current}<span className="text-[10px] text-gray-500 font-mono">/{sets.max}</span>
                                </div>
                            </div>
                        </div>

                        {/* INFO OVERLAY (Shows on button click) */}
                        {showInfo && (
                            <div className="absolute inset-0 z-40 bg-black/80 backdrop-blur-md flex flex-col justify-center items-center p-8 text-center">
                                {/* Close button */}
                                <button 
                                    onClick={() => setShowInfo(false)}
                                    className="absolute top-5 right-5 w-10 h-10 rounded-full bg-white/10 border border-white/20 flex items-center justify-center text-white hover:bg-white/20 transition-colors"
                                >
                                    <X size={20} />
                                </button>
                                <h3 className="text-xl font-display font-bold text-white mb-6 tracking-widest border-b border-white/20 pb-2">LEGEND</h3>
                                
                                <div className="space-y-6 w-full">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.5)] flex items-center justify-center">
                                            <RefreshCw size={20} className="text-indigo-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-indigo-400 font-bold text-sm tracking-wider">FREQUENCY</div>
                                            <div className="text-[10px] text-gray-400">Séances / Objectif</div>
                                        </div>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-fuchsia-500 shadow-[0_0_15px_rgba(217,70,239,0.5)] flex items-center justify-center">
                                            <Layers size={20} className="text-fuchsia-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-fuchsia-400 font-bold text-sm tracking-wider">VOLUME</div>
                                            <div className="text-[10px] text-gray-400">Séries / Capacité</div>
                                        </div>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.5)] flex items-center justify-center">
                                            <Target size={20} className="text-yellow-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-yellow-400 font-bold text-sm tracking-wider">INTENSITY</div>
                                            <div className="text-[10px] text-gray-400">Score Global</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* PART 2: DATA GRID */}
                    <div className="bg-[#080808] p-5 border-t border-white/5 relative z-10">
                        {/* Grid 3x2 */}
                        <div className="grid grid-cols-3 gap-3 mb-6">
                            {statsGrid.map((stat, i) => (
                                <GridCard key={i} stat={stat} />
                            ))}
                        </div>

                        {/* XP BAR */}
                        <div className="relative pt-1">
                            <div className="flex justify-between items-end mb-2">
                                <span className="text-xs font-bold text-cyan-400 tracking-widest uppercase">XP LEVEL 24</span>
                                <span className="text-[10px] font-mono text-gray-500">1850 / 2500</span>
                            </div>
                            <div className="h-2 w-full bg-[#1a1a1a] rounded-full overflow-hidden border border-white/5">
                                <div className="h-full bg-gradient-to-r from-cyan-500 via-blue-600 to-purple-600 w-[75%] shadow-[0_0_15px_rgba(6,182,212,0.6)]"></div>
                            </div>
                        </div>
                    </div>

                </div>
            );
        };

        // Grid Card Component
        const GridCard = ({ stat }) => {
            const styles = {
                cyan:   { border: 'border-cyan-500/40', text: 'text-cyan-400', shadow: 'shadow-[0_0_15px_rgba(6,182,212,0.1)]' },
                orange: { border: 'border-orange-500/40', text: 'text-orange-400', shadow: 'shadow-[0_0_15px_rgba(249,115,22,0.1)]' },
                purple: { border: 'border-purple-500/40', text: 'text-purple-400', shadow: 'shadow-[0_0_15px_rgba(168,85,247,0.1)]' },
                green:  { border: 'border-green-500/40', text: 'text-green-400', shadow: 'shadow-[0_0_15px_rgba(34,197,94,0.1)]' },
                yellow: { border: 'border-yellow-500/40', text: 'text-yellow-400', shadow: 'shadow-[0_0_15px_rgba(234,179,8,0.1)]' },
                blue:   { border: 'border-blue-500/40', text: 'text-blue-400', shadow: 'shadow-[0_0_15px_rgba(59,130,246,0.1)]' },
            };
            
            const s = styles[stat.color];
            const IconComp = stat.icon;

            return (
                <div className={`flex flex-col items-center justify-center p-3 rounded-xl border bg-[#0a0a0a] transition-all hover:-translate-y-1 ${s.border} ${s.shadow}`}>
                    <div className={`mb-2 ${s.text} opacity-90`}><IconComp size={16} /></div>
                    <div className="text-xl font-display font-bold text-white leading-none mb-1">{stat.value}</div>
                    <div className={`text-[9px] font-black uppercase tracking-widest opacity-60 ${s.text}`}>{stat.label}</div>
                </div>
            );
        };

        const MiniStat = ({ icon, label, value, color }) => (
            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default h-24">
                <div className="text-gray-500 mb-1 opacity-80">{icon}</div>
                <div className="text-lg font-display font-bold text-white leading-none mb-1">{value}</div>
                <div className={`text-[9px] font-black uppercase tracking-widest ${color}`}>{label}</div>
            </div>
        );

        // 2. WEEKLY PROGRESS (Path Visualization)
        const WeeklyProgress = ({ weeksData = [] }) => {
            const [hoveredWeek, setHoveredWeek] = useState(null);
            const [animReady, setAnimReady] = useState(false);
            useEffect(() => { setTimeout(() => setAnimReady(true), 100); }, []);
            const WEEKS = weeksData.length > 0 ? weeksData : getWeeksData();
            const points = WEEKS.map(w => `${w.x},${w.y}`);
            const pathData = `M 50,50 L ${points.join(' L ')}`;
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 z-10 flex justify-between items-center">
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2"><TrendingUp className="text-cyan-400" size={20} /> PROGRESSION</h2>
                            <p className="text-[10px] text-gray-400 font-mono font-bold mt-1">HEBDOMADAIRE</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-cyan-500/20 text-[10px] font-black uppercase tracking-wider bg-cyan-500/5 text-cyan-400">CYCLE 1</div>
                    </div>
                    <div className="relative bg-[#020202] flex items-center justify-center p-6 h-[400px]">
                        <div className="absolute inset-0 opacity-20" style={{ backgroundImage: 'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255, 255, 255, 0.05) 1px, rgba(255, 255, 255, 0.05) 2px)' }}></div>
                        <div className="absolute inset-0 pointer-events-none">
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-[80%] bg-cyan-500/5 blur-[80px] rounded-full"></div>
                            {[25, 45, 65, 85].map((size, i) => (
                                <div key={i} className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border" style={{ width: `${size}%`, height: `${size}%`, borderColor: i === 3 ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.03)' }}></div>
                            ))}
                        </div>
                        <svg className="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stopColor="#06b6d4" stopOpacity="0.3" /><stop offset="30%" stopColor="#22d3ee" stopOpacity="0.8" /><stop offset="70%" stopColor="#22d3ee" stopOpacity="0.8" /><stop offset="100%" stopColor="#06b6d4" stopOpacity="0.3" />
                                </linearGradient>
                                <filter id="strongGlowLine"><feGaussianBlur stdDeviation="1.0" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            <path d={pathData} fill="none" stroke="rgba(255, 255, 255, 0.05)" strokeWidth="1.5" />
                            <path d={pathData} fill="none" stroke="url(#lineGrad)" strokeWidth="2.5" filter="url(#strongGlowLine)" strokeDasharray="200" strokeDashoffset={animReady ? "0" : "200"} className="transition-all duration-[2000ms] ease-out drop-shadow-[0_0_8px_rgba(34,211,238,0.3)]" strokeLinecap="round" strokeLinejoin="round" />
                        </svg>
                        <div className="absolute inset-0 z-20 w-full h-full">
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center w-24 h-24 rounded-full bg-black border-[2px] border-white/10 shadow-[0_0_30px_rgba(0,0,0,0.5)] z-10">
                                <div className="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-1">SCORE</div>
                                <div className="text-4xl font-black text-white leading-none">35</div>
                                <div className="text-[8px] text-cyan-500 font-mono mt-1 font-bold">/ 100</div>
                            </div>
                            {WEEKS.map((week) => {
                                const isHovered = hoveredWeek === week.id;
                                const isCurrent = week.status === 'current';
                                let translateClass = '';
                                if (week.x > 50 && week.y < 50) translateClass = 'translate-x-2 -translate-y-full';
                                else if (week.x > 50 && week.y >= 50) translateClass = 'translate-x-2 translate-y-2';
                                else if (week.x <= 50 && week.y >= 50) translateClass = '-translate-x-full translate-y-2';
                                else translateClass = '-translate-x-full -translate-y-full';
                                const badgeBorder = isCurrent ? 'border-red-500/50' : 'border-white/10';
                                const badgeBg = isCurrent ? 'bg-black/90' : 'bg-black/80';
                                const badgeText = isCurrent ? 'text-red-400' : 'text-cyan-400';
                                const dotColor = isCurrent ? 'bg-red-500' : 'bg-cyan-400';
                                const glowColor = isCurrent ? 'rgba(239, 68, 68, 0.6)' : 'rgba(34, 211, 238, 0.2)';
                                return (
                                    <div key={week.id} className="absolute" style={{ left: `${week.x}%`, top: `${week.y}%` }} onMouseEnter={() => setHoveredWeek(week.id)} onMouseLeave={() => setHoveredWeek(null)}>
                                        <div className="absolute -translate-x-1/2 -translate-y-1/2 group/node cursor-pointer">
                                            <div className={`w-3 h-3 rounded-full ${dotColor} relative z-10 transition-all duration-300 group-hover/node:scale-150`} style={{boxShadow: isCurrent ? `0 0 15px ${glowColor}, 0 0 30px ${glowColor}` : `0 0 5px ${glowColor}`}}></div>
                                            {isCurrent && (<><div className="absolute inset-0 -m-1 rounded-full bg-red-500/50 animate-pulse"></div></>)}
                                        </div>
                                        <div className={`absolute ${translateClass} transition-all duration-300 z-30 pointer-events-none ${isHovered ? 'scale-110' : 'scale-100'}`}>
                                            <div className={`backdrop-blur-md border px-3 py-2 rounded-xl flex flex-col min-w-[80px] ${badgeBg} ${badgeBorder} ${isCurrent ? 'shadow-lg' : 'shadow-none'}`}>
                                                <div className="flex justify-between items-center mb-1.5"><span className={`text-[9px] font-black uppercase px-1.5 py-0.5 rounded ${isCurrent ? 'bg-red-500 text-white' : 'bg-white/5 text-gray-400 border border-white/5'}`}>{week.label}</span></div>
                                                <div className="text-lg font-black text-white leading-none mb-1">{(week.volume / 1000).toFixed(1)}k</div>
                                                <div className={`text-[9px] font-mono font-bold ${badgeText}`}>{week.intensity}% INT</div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    <div className="relative bg-[#080808] border-t border-white/10">
                        <div className="relative grid grid-cols-4 divide-x divide-white/10">
                            {WEEKS.map((week, i) => {
                                const isHovered = hoveredWeek === week.id; const isCurrent = week.status === 'current';
                                return (
                                    <div key={i} className={`p-3 py-4 flex flex-col items-center justify-center transition-all cursor-pointer ${isHovered ? 'bg-white/5 scale-105' : 'hover:bg-white/5'} ${isCurrent ? 'bg-gradient-to-t from-red-500/10 to-transparent' : ''}`} onMouseEnter={() => setHoveredWeek(week.id)} onMouseLeave={() => setHoveredWeek(null)}>
                                        <div className="text-[9px] font-black text-gray-500 uppercase tracking-wider mb-1.5">SEM {i + 1}</div>
                                        <div className="text-lg font-black text-white leading-none mb-1">{(week.volume / 1000).toFixed(1)}k</div>
                                        <div className={`text-[8px] font-mono font-bold ${isCurrent ? 'text-red-400' : 'text-cyan-400'}`}>{week.intensity}% INT</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. ACTIVITY CHART (7 jours)
        const getDailyActivityData = () => window.StatsData ? window.StatsData.getDailyActivity() : [
            { day: 'Lun', volume: 0, sets: 0, active: false },
            { day: 'Mar', volume: 0, sets: 0, active: false },
            { day: 'Mer', volume: 0, sets: 0, active: false },
            { day: 'Jeu', volume: 0, sets: 0, active: false },
            { day: 'Ven', volume: 0, sets: 0, active: false },
            { day: 'Sam', volume: 0, sets: 0, active: false },
            { day: 'Dim', volume: 0, sets: 0, active: false }
        ];

        const ActivityChart = () => {
            const [data, setData] = useState(getDailyActivityData());
            const [hoveredDay, setHoveredDay] = useState(null);
            
            useEffect(() => {
                const refresh = () => setData(getDailyActivityData());
                refresh();
                const interval = setInterval(refresh, 5000);
                return () => clearInterval(interval);
            }, []);

            const maxVolume = Math.max(...data.map(d => d.volume), 1);
            const totalVolume = data.reduce((s, d) => s + d.volume, 0);
            const activeDays = data.filter(d => d.active).length;

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group min-h-[350px]">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div>
                            <h3 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase">
                                <Activity size={18} className="text-cyan-400" />
                                ACTIVITÉ 7J
                            </h3>
                            <p className="text-[10px] text-gray-400 font-mono font-bold mt-1">VOLUME QUOTIDIEN</p>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border border-cyan-500/50 text-cyan-500 bg-cyan-500/10">
                                {activeDays}/7 JOURS
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 bg-[#020202] p-6 relative">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none"></div>
                        
                        <svg className="w-full h-40 overflow-visible" viewBox="0 0 280 100" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="activityGrad" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stopColor="#22d3ee" stopOpacity="0.6"/>
                                    <stop offset="100%" stopColor="#22d3ee" stopOpacity="0"/>
                                </linearGradient>
                                <filter id="barGlow">
                                    <feGaussianBlur stdDeviation="2" result="blur"/>
                                    <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                </filter>
                            </defs>
                            
                            {[0.25, 0.5, 0.75, 1].map((pct, i) => (
                                <line key={i} x1="0" y1={100 - pct * 80} x2="280" y2={100 - pct * 80} stroke="rgba(255,255,255,0.05)" strokeDasharray="4 4"/>
                            ))}

                            {data.map((d, i) => {
                                const barWidth = 25;
                                const gap = (280 - barWidth * 7) / 8;
                                const x = gap + i * (barWidth + gap);
                                const barHeight = maxVolume > 0 ? (d.volume / maxVolume) * 70 : 0;
                                const y = 90 - barHeight;
                                const isHovered = hoveredDay === i;
                                
                                return (
                                    <g key={i} 
                                       onMouseEnter={() => setHoveredDay(i)} 
                                       onMouseLeave={() => setHoveredDay(null)}
                                       className="cursor-pointer">
                                        <rect x={x} y={y} width={barWidth} height={barHeight} rx="3"
                                              fill={d.active ? "url(#activityGrad)" : "rgba(255,255,255,0.05)"}
                                              filter={d.active && isHovered ? "url(#barGlow)" : ""}
                                              className="transition-all duration-300"
                                              style={{ opacity: isHovered ? 1 : 0.8 }}/>
                                        {d.active && (
                                            <rect x={x} y={y} width={barWidth} height="2" rx="1"
                                                  fill="#22d3ee" className="drop-shadow-[0_0_6px_rgba(34,211,238,0.8)]"/>
                                        )}
                                        <text x={x + barWidth/2} y="98" textAnchor="middle" 
                                              className={`text-[8px] font-bold ${d.active ? 'fill-cyan-400' : 'fill-gray-600'}`}>
                                            {d.day}
                                        </text>
                                        {isHovered && d.volume > 0 && (
                                            <g>
                                                <rect x={x - 10} y={y - 22} width={barWidth + 20} height="18" rx="4" fill="#000" stroke="#22d3ee" strokeWidth="0.5"/>
                                                <text x={x + barWidth/2} y={y - 10} textAnchor="middle" className="text-[8px] font-bold fill-white">
                                                    {(d.volume/1000).toFixed(1)}k
                                                </text>
                                            </g>
                                        )}
                                    </g>
                                );
                            })}
                        </svg>
                    </div>

                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-2 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center">
                                <span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1">VOLUME 7J</span>
                                <span className="text-2xl font-display font-black text-white">{(totalVolume/1000).toFixed(1)}<span className="text-sm text-cyan-500">t</span></span>
                            </div>
                            <div className="p-4 flex flex-col items-center">
                                <span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1">SETS TOTAL</span>
                                <span className="text-2xl font-display font-black text-white">{data.reduce((s,d) => s + d.sets, 0)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. VOLUME GAUGE
        const VolumeGauge = ({ volume, maxVolume = 25000, optimalMin = 15000, optimalMax = 22000, stats }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const currentValRef = useRef(0);
            const targetValRef = useRef(volume);
            useEffect(() => { targetValRef.current = volume; }, [volume]);
            useEffect(() => {
                const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d', { alpha: true }); if (!ctx) return;
                let animationId;
                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1; 
                    const rect = containerRef.current.getBoundingClientRect(); 
                    const size = Math.min(rect.width - 48, rect.height - 48, 350);
                    canvas.width = size * dpr; canvas.height = size * dpr; 
                    canvas.style.width = `${size}px`; canvas.style.height = `${size}px`; 
                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    ctx.scale(dpr, dpr);
                };
                window.addEventListener('resize', handleResize); setTimeout(handleResize, 100);
                const toRad = (deg) => (deg * Math.PI) / 180;
                const createCarbonPattern = () => {
                    const pCanvas = document.createElement('canvas'); pCanvas.width = 8; pCanvas.height = 8; const pCtx = pCanvas.getContext('2d');
                    if (pCtx) { pCtx.fillStyle = '#050505'; pCtx.fillRect(0, 0, 8, 8); pCtx.fillStyle = '#161616'; pCtx.beginPath(); pCtx.moveTo(0, 8); pCtx.lineTo(8, 0); pCtx.lineTo(8, 8); pCtx.fill(); }
                    return ctx.createPattern(pCanvas, 'repeat');
                };
                const draw = () => {
                    if (!canvas || !containerRef.current) return;
                    const diff = targetValRef.current - currentValRef.current;
                    if (Math.abs(diff) < 0.1) currentValRef.current = targetValRef.current; else currentValRef.current += diff * 0.08;
                    const size = canvas.width / (window.devicePixelRatio || 1); const cx = size / 2; const cy = size / 2; const r = size * 0.45;
                    const percent = Math.min(1, Math.max(0, currentValRef.current / maxVolume));
                    let themeColor = '#22d3ee';
                    const isOptimal = currentValRef.current >= optimalMin && currentValRef.current <= optimalMax;
                    const isOver = currentValRef.current > optimalMax;
                    if (isOptimal) themeColor = '#fbbf24'; else if (isOver) themeColor = '#ef4444';
                    
                    ctx.clearRect(0, 0, size, size);
                    ctx.save(); ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 30; ctx.shadowOffsetY = 10; ctx.beginPath(); ctx.arc(cx, cy, r * 1.05, 0, Math.PI * 2);
                    const bezelGrad = ctx.createLinearGradient(0, 0, size, size); bezelGrad.addColorStop(0, '#334155'); bezelGrad.addColorStop(0.5, '#0f172a'); bezelGrad.addColorStop(1, '#1e293b');
                    ctx.fillStyle = bezelGrad; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2); const pattern = createCarbonPattern(); if (pattern) ctx.fillStyle = pattern; ctx.fill();
                    const vignette = ctx.createRadialGradient(cx, cy, r * 0.6, cx, cy, r); vignette.addColorStop(0, 'rgba(0,0,0,0)'); vignette.addColorStop(1, 'rgba(0,0,0,0.9)'); ctx.fillStyle = vignette; ctx.fill(); ctx.restore();
                    
                    const startAng = toRad(135); const totalAng = toRad(270);
                    ctx.save();
                    const optStartPct = optimalMin / maxVolume; const optEndPct = optimalMax / maxVolume;
                    const optStartAng = startAng + (totalAng * optStartPct); const optEndAng = startAng + (totalAng * optEndPct);
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.85, optStartAng, optEndAng); ctx.lineWidth = r * 0.08; ctx.strokeStyle = 'rgba(251, 191, 36, 0.15)'; ctx.stroke();
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.92, optStartAng, optEndAng); ctx.lineWidth = 2; ctx.strokeStyle = '#fbbf24'; ctx.stroke(); ctx.restore();

                    ctx.save();
                    const tickCount = 50;
                    for (let i = 0; i <= tickCount; i++) {
                        const t = i / tickCount; const angle = startAng + (totalAng * t); const isMajor = i % 10 === 0; const isLit = t <= percent;
                        const outerRad = r * 0.82; const innerRad = outerRad - (isMajor ? r * 0.08 : r * 0.04);
                        const x1 = cx + Math.cos(angle) * innerRad; const y1 = cy + Math.sin(angle) * innerRad;
                        const x2 = cx + Math.cos(angle) * outerRad; const y2 = cy + Math.sin(angle) * outerRad;
                        ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
                        if (isLit) { ctx.strokeStyle = isMajor ? themeColor : 'rgba(255,255,255,0.5)'; ctx.lineWidth = isMajor ? 3 : 1; ctx.shadowColor = themeColor; ctx.shadowBlur = 10; } 
                        else { ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.shadowBlur = 0; }
                        ctx.stroke();
                        if (isMajor) {
                            const textRad = r * 0.65; const tx = cx + Math.cos(angle) * textRad; const ty = cy + Math.sin(angle) * textRad;
                            ctx.font = `bold ${Math.max(10, size * 0.04)}px "Orbitron", sans-serif`; ctx.fillStyle = isLit ? '#fff' : '#475569'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(`${Math.round((t * maxVolume) / 1000)}k`, tx, ty);
                        }
                    }
                    ctx.restore();

                    // LCD
                    ctx.save(); const lcdY = cy + r * 0.4; const lcdW = r * 0.6; const lcdH = r * 0.25;
                    ctx.fillStyle = '#000'; ctx.beginPath(); ctx.roundRect(cx - lcdW/2, lcdY - lcdH/2, lcdW, lcdH, 4); ctx.fill(); ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.stroke();
                    ctx.font = `bold ${size * 0.08}px "Orbitron", monospace`; ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.shadowColor = themeColor; ctx.shadowBlur = 15;
                    ctx.fillText(`${Math.round(currentValRef.current).toLocaleString()}`, cx, lcdY);
                    ctx.font = `bold ${size * 0.03}px "Inter", sans-serif`; ctx.fillStyle = themeColor; ctx.shadowBlur = 0; ctx.fillText("TOTAL LOAD (KG)", cx, lcdY + size * 0.06); ctx.restore();

                    // Needle
                    ctx.save(); const needleAngle = startAng + (totalAng * percent); const needleLen = r * 0.85;
                    ctx.translate(cx, cy); ctx.rotate(needleAngle); ctx.shadowColor = themeColor; ctx.shadowBlur = 20;
                    ctx.beginPath(); ctx.moveTo(0, -4); ctx.lineTo(needleLen, 0); ctx.lineTo(0, 4); ctx.lineTo(-15, 0); ctx.fillStyle = '#fff'; ctx.fill();
                    ctx.beginPath(); ctx.moveTo(needleLen * 0.7, -2); ctx.lineTo(needleLen, 0); ctx.lineTo(needleLen * 0.7, 2); ctx.fillStyle = themeColor; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, 6, 0, Math.PI * 2); ctx.fillStyle = '#cbd5e1'; ctx.fill(); ctx.beginPath(); ctx.arc(cx, cy, 2, 0, Math.PI * 2); ctx.fillStyle = '#0f172a'; ctx.fill(); ctx.restore();

                    animationId = requestAnimationFrame(draw);
                };
                draw();
                return () => { window.removeEventListener('resize', handleResize); cancelAnimationFrame(animationId); };
            }, [maxVolume, optimalMin, optimalMax]);

            const isOptimal = volume >= optimalMin && volume <= optimalMax;
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h3 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase"><TrendingUp size={18} className="text-cyan-400" />Volume Load</h3><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">WEEKLY ACCUMULATION</p></div>
                        <div className={`px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border ${isOptimal ? 'border-amber-500/50 text-amber-500 bg-amber-500/10' : 'border-cyan-500/50 text-cyan-500 bg-cyan-500/10'}`}>{isOptimal ? 'OPTIMAL ZONE' : 'BUILDING'}</div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex justify-center items-center relative" ref={containerRef}>
                        <div className="absolute inset-0 bg-cyan-500/5 blur-3xl rounded-full transform scale-75 pointer-events-none"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] opacity-50 [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)] pointer-events-none"></div>
                        <canvas ref={canvasRef} className="relative z-10 w-full aspect-square max-w-[350px]" />
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-2 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Layers size={12} /> Total Sets</span><span className="text-2xl font-display font-black text-white">{stats.sets}</span></div>
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Clock size={12} /> TUT (MIN)</span><span className="text-2xl font-display font-black text-white">{Math.floor(stats.tut / 60)}<span className="text-sm text-gray-500">:{String(stats.tut % 60).padStart(2, '0')}</span></span></div>
                        </div>
                    </div>
                    <div className={`py-1 text-center text-[8px] font-mono font-bold uppercase tracking-[0.2em] transition-colors duration-500 ${isOptimal ? 'bg-amber-500/20 text-amber-400' : 'bg-cyan-900/20 text-cyan-400'}`}>{isOptimal ? 'HYPERTROPHY RANGE ACTIVE' : 'ACCUMULATION PHASE'}</div>
                </div>
            );
        };

        // 4. MUSCLE HUD (Radar Chart)
        const MuscleHud = ({ musclesData }) => {
            const MUSCLES = musclesData && musclesData.length > 0 ? musclesData : getMusclesHUD();
            const [selectedMuscle, setSelectedMuscle] = useState(MUSCLES[0] || { id: '1', name: 'N/A', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 });
            const [hoveredMuscleId, setHoveredMuscleId] = useState(null);
            const [buildFactor, setBuildFactor] = useState(0);
            useEffect(() => { let start = 0; const animate = () => { start += 0.02; if (start >= 1) setBuildFactor(1); else { setBuildFactor(Math.pow(start, 0.5)); requestAnimationFrame(animate); } }; animate(); }, []);
            const size = 300; const center = size / 2; const radius = (size / 2) - 50; const angleStep = MUSCLES.length > 0 ? (Math.PI * 2) / MUSCLES.length : Math.PI * 2;
            const getCoordinates = (index, value) => { const angle = index * angleStep - Math.PI / 2; const r = radius * value * buildFactor; return { x: center + Math.cos(angle) * r, y: center + Math.sin(angle) * r, angle }; };
            const polygonPoints = useMemo(() => MUSCLES.map((m, i) => { const { x, y } = getCoordinates(i, m.normalized || 0); return `${x},${y}`; }).join(' '), [buildFactor, MUSCLES]);
            const getWebPoints = (factor) => MUSCLES.map((_, i) => { const angle = i * angleStep - Math.PI / 2; const r = radius * factor; return `${center + Math.cos(angle) * r},${center + Math.sin(angle) * r}`; }).join(' ');

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="text-xl font-display font-black text-white tracking-widest uppercase flex items-center gap-2"><Cpu className="text-cyan-400" size={20} /> BIO-METRICS</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">VOLUME DISTRIBUTION ANALYSIS</p></div>
                        <div className="flex gap-2"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-gray-400 font-mono">{MUSCLES.length} ZONES</div></div>
                    </div>
                    <div className="relative flex-1 bg-[#020202] flex items-center justify-center p-6 group/chart">
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-cyan-900/10 via-transparent to-transparent opacity-60"></div>
                            <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)]"></div>
                            <div className="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/5 to-transparent h-[10px] w-full animate-scan pointer-events-none"></div>
                        </div>
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[400px] overflow-visible relative z-10">
                            <defs>
                                <linearGradient id="radarGradient" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#22d3ee" stopOpacity="0.6" /><stop offset="100%" stopColor="#8b5cf6" stopOpacity="0.1" /></linearGradient>
                                <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            {[0.25, 0.5, 0.75, 1].map((factor, i) => (<polygon key={`grid-${i}`} points={getWebPoints(factor)} fill="none" stroke={i === 3 ? "rgba(255,255,255,0.2)" : "rgba(255, 255, 255, 0.05)"} strokeWidth={i === 3 ? "1.5" : "1"} strokeDasharray={i !== 3 ? "4 4" : ""} />))}
                            {MUSCLES.map((_, i) => { const { x, y } = getCoordinates(i, 1); return (<line key={`axis-${i}`} x1={center} y1={center} x2={x} y2={y} stroke="rgba(255, 255, 255, 0.1)" strokeWidth="1" />); })}
                            <polygon points={polygonPoints} fill="url(#radarGradient)" stroke="#22d3ee" strokeWidth="3" filter="url(#glow)" className="drop-shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-300" strokeDasharray="1000" strokeDashoffset={1000 * (1 - buildFactor)} />
                            {MUSCLES.map((muscle, i) => {
                                const { x, y } = getCoordinates(i, muscle.normalized); const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                                return (
                                    <g key={`point-${i}`} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)} className="cursor-pointer">
                                        <circle cx={x} cy={y} r="20" fill="transparent" />
                                        <circle cx={x} cy={y} r={isHovered || isSelected ? 6 : 3} fill={muscle.type === 'primary' ? 'white' : '#94a3b8'} stroke={isSelected ? '#facc15' : '#22d3ee'} strokeWidth={isHovered || isSelected ? 3 : 2} className="transition-all duration-300" />
                                        {isSelected && (<circle cx={x} cy={y} r="12" fill="none" stroke="#facc15" strokeWidth="1" opacity="0.5"><animate attributeName="r" from="6" to="25" dur="1.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.8" to="0" dur="1.5s" repeatCount="indefinite" /></circle>)}
                                    </g>
                                );
                            })}
                        </svg>
                        {MUSCLES.map((muscle, i) => {
                            const angle = i * angleStep - Math.PI / 2; const labelRadius = radius + 35; const lx = center + Math.cos(angle) * labelRadius; const ly = center + Math.sin(angle) * labelRadius;
                            const leftPct = (lx / size) * 100; const topPct = (ly / size) * 100; const isPrimary = muscle.type === 'primary'; const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                            return (
                                <div key={`label-${i}`} className={`absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 z-50 flex flex-col items-center group/label cursor-pointer`} style={{ left: `${leftPct}%`, top: `${topPct}%` }} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)}>
                                    <div className={`flex items-center gap-1.5 px-2 py-1 rounded border backdrop-blur-md transition-all duration-300 ${isSelected ? 'bg-yellow-500/10 border-yellow-500 text-yellow-400 scale-110 shadow-[0_0_15px_rgba(234,179,8,0.4)]' : isHovered ? 'bg-cyan-500/10 border-cyan-400 text-white scale-105' : isPrimary ? 'bg-black/80 border-white/20 text-gray-200' : 'bg-black/60 border-transparent text-gray-500 hover:text-gray-300'}`}>
                                        {isPrimary && <Zap size={10} className={isSelected ? 'text-yellow-400' : 'text-cyan-400'} fill={isSelected ? "currentColor" : "none"}/>}
                                        <span className="text-[10px] md:text-xs font-black tracking-wider whitespace-nowrap">{muscle.name}</span>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-3 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><Activity size={12} /> INTENSITÉ</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.intensity > 8 ? 'text-red-500' : 'text-white'}`}>{selectedMuscle.intensity}<span className="text-sm text-gray-600">/10</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center bg-white/5 relative overflow-hidden group"><div className="absolute inset-0 bg-cyan-500/5 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div><div className="text-xs text-cyan-400 font-black uppercase tracking-[0.2em] mb-1 relative z-10">{selectedMuscle.name}</div><div className="text-xl font-display font-black text-white relative z-10">{selectedMuscle.volume.toLocaleString()} <span className="text-sm font-sans text-gray-500 font-medium">KG</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><RefreshCw size={12} /> RECOVERY</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.recovery < 50 ? 'text-orange-500' : 'text-emerald-500'}`}>{selectedMuscle.recovery}%</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. INTENSITY ZONES
        const IntensityZones = ({ zonesData }) => {
            const ZONES = zonesData && zonesData.length > 0 ? zonesData : getZones();
            const [active, setActive] = useState(false);
            const [selectedZone, setSelectedZone] = useState(null);
            useEffect(() => { const timer = setTimeout(() => setActive(true), 200); return () => clearTimeout(timer); }, []);
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group min-h-[400px]">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Battery className="text-cyan-400 -rotate-90" size={20} /> POWER DIST.</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">CAPACITEURS D'INTENSITÉ</p></div>
                        <div className="flex gap-2"><div className="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_10px_#22c55e]"></div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex flex-col justify-center gap-6 relative">
                        <div className="absolute right-0 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-white/10 to-transparent"></div>
                        {ZONES.map((zone) => {
                            const isSelected = selectedZone === zone.id;
                            return (
                                <div key={zone.id} className="relative group/bar cursor-pointer" onMouseEnter={() => setSelectedZone(zone.id)} onMouseLeave={() => setSelectedZone(null)}>
                                    <div className="flex justify-between items-end mb-2">
                                        <div className="flex items-center gap-2"><div className={`w-1.5 h-1.5 rounded-sm ${zone.color} ${zone.shadow} shadow-[0_0_8px_currentColor]`}></div><span className={`text-[10px] font-black uppercase tracking-widest transition-colors ${isSelected ? 'text-white' : 'text-gray-500'}`}>{zone.label}</span></div>
                                        <span className="text-[10px] font-mono text-gray-400">{zone.range}</span>
                                    </div>
                                    <div className="h-10 w-full bg-[#080808] border border-white/5 rounded flex p-1 relative overflow-hidden">
                                        <div className="absolute inset-0 bg-[linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:10px_100%]"></div>
                                        <div className={`h-full rounded-sm transition-all duration-1000 ease-out relative overflow-hidden flex items-center ${zone.color}`} style={{ width: active ? `${zone.percent}%` : '0%' }}>
                                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full -translate-x-full animate-[shimmer_2s_infinite]"></div>
                                            <div className="absolute inset-0 w-full h-full bg-[repeating-linear-gradient(90deg,transparent,transparent_4px,rgba(0,0,0,0.8)_4px,rgba(0,0,0,0.8)_5px)]"></div>
                                        </div>
                                        <div className="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2"><span className={`text-xl font-display font-black z-10 drop-shadow-md ${isSelected ? 'text-white' : 'text-gray-600'}`}>{zone.percent}%</span></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 h-16 relative">
                        <div className="absolute inset-0 flex items-center justify-between px-6">
                            {selectedZone ? (<><div className="flex flex-col animate-slideIn"><span className="text-[9px] text-gray-500 uppercase font-bold">Volume Sets</span><span className="text-xl font-display font-bold text-white">{ZONES.find(z => z.id === selectedZone)?.sets || 0} <span className="text-sm text-gray-600">SÉRIES</span></span></div><div className="flex items-center gap-1 text-cyan-400 animate-pulse"><Activity size={14} /><span className="text-[9px] font-bold">ANALYZING</span></div></>) : (<div className="w-full flex justify-center items-center text-[10px] text-gray-600 font-mono tracking-widest animate-pulse">// SYSTEM READY //</div>)}
                        </div>
                    </div>
                </div>
            );
        };

        // 6. MUSCLE WORKLOAD (Turbine)
        const MuscleWorkload = ({ musclesTurbineData }) => {
            const MUSCLES_T = musclesTurbineData && musclesTurbineData.length > 0 ? musclesTurbineData : getMusclesTurbine();
            const [hoveredId, setHoveredId] = useState(null);
            const [buildFactor, setBuildFactor] = useState(0);
            useEffect(() => { let frame = 0; const animate = () => { frame += 0.015; if (frame >= 1) setBuildFactor(1); else { setBuildFactor(1 - Math.pow(1 - frame, 3)); requestAnimationFrame(animate); } }; animate(); }, []);
            const size = 300; const cx = size / 2; const cy = size / 2; const innerRadius = 40; const maxRadius = (size / 2) - 20; const availableDepth = maxRadius - innerRadius; const maxVol = Math.max(...MUSCLES_T.map(m => m.volume), 1);
            const totalAngle = 360; const sectorAngle = MUSCLES_T.length > 0 ? (totalAngle / MUSCLES_T.length) : 60; const bladeWidth = sectorAngle - 4;
            const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => { const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0; return { x: centerX + (radius * Math.cos(angleInRadians)), y: centerY + (radius * Math.sin(angleInRadians)) }; };
            const describeBlade = (startAngle, endAngle, innerR, outerR) => {
                const start = polarToCartesian(cx, cy, outerR, endAngle); const end = polarToCartesian(cx, cy, outerR, startAngle);
                const startInner = polarToCartesian(cx, cy, innerR, endAngle); const endInner = polarToCartesian(cx, cy, innerR, startAngle);
                return ["M", startInner.x, startInner.y, "L", endInner.x, endInner.y, "L", end.x, end.y, "A", outerR, outerR, 0, 0, 0, start.x, start.y, "Z"].join(" ");
            };
            const activeMuscle = useMemo(() => MUSCLES_T.find(m => m.id === hoveredId) || (MUSCLES_T.length > 0 ? MUSCLES_T.reduce((prev, current) => (prev.volume > current.volume) ? prev : current) : { id: 'none', name: 'N/A', volume: 0, color: '#666' }), [hoveredId, MUSCLES_T]);
            
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Fan className="text-cyan-400 animate-spin-slow" size={20} /> KINETIC LOAD</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">DISTRIBUTION DE PUISSANCE</p></div>
                        <div className="flex gap-1"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-cyan-400 font-mono font-bold animate-pulse">LIVE</div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] relative flex items-center justify-center p-4 overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/20 via-black to-black pointer-events-none"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] h-[90%] border border-white/5 rounded-full opacity-30"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[60%] h-[60%] border border-white/5 rounded-full opacity-20 border-dashed animate-spin-reverse-slow"></div>
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[380px] overflow-visible relative z-10">
                            <defs>
                                {MUSCLES_T.map(m => (<linearGradient key={m.id} id={`grad-${m.id}`} x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor={m.color} stopOpacity="0.4" /><stop offset="100%" stopColor={m.color} stopOpacity="1" /></linearGradient>))}
                                <filter id="glow-blade"><feGaussianBlur stdDeviation="4" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            <g className={`origin-center transition-all duration-700 ${hoveredId ? '' : 'animate-spin-slow'}`} style={{ transformBox: 'fill-box' }}>
                                {MUSCLES_T.map((muscle, i) => {
                                    const startAngle = i * sectorAngle; const endAngle = startAngle + bladeWidth; const normalizedVol = muscle.volume / maxVol; const targetRadius = innerRadius + (availableDepth * normalizedVol); const currentRadius = innerRadius + ((targetRadius - innerRadius) * buildFactor); const isHovered = hoveredId === muscle.id;
                                    return (
                                        <g key={muscle.id} onMouseEnter={() => setHoveredId(muscle.id)} onMouseLeave={() => setHoveredId(null)} className="cursor-pointer transition-opacity duration-300" style={{ opacity: hoveredId && !isHovered ? 0.3 : 1 }}>
                                            <path d={describeBlade(startAngle, endAngle, innerRadius + 5, currentRadius)} fill={`url(#grad-${muscle.id})`} stroke="white" strokeWidth={isHovered ? 2 : 0} filter={isHovered ? "url(#glow-blade)" : undefined} className="transition-all duration-300 ease-out" style={{ transform: isHovered ? 'scale(1.05)' : 'scale(1)', transformOrigin: 'center', }} />
                                            {buildFactor > 0.8 && (<path d={describeBlade(startAngle + bladeWidth/2 - 0.5, startAngle + bladeWidth/2 + 0.5, innerRadius + 10, currentRadius - 10)} fill="rgba(255,255,255,0.3)" />)}
                                        </g>
                                    );
                                })}
                            </g>
                            <g>
                                <circle cx={cx} cy={cy} r={innerRadius - 2} fill="#050505" stroke="#333" strokeWidth="2" />
                                <circle cx={cx} cy={cy} r={innerRadius - 8} fill="none" stroke={activeMuscle.color} strokeWidth="2" strokeDasharray="4 2" className="animate-spin-slow origin-center" style={{ transformBox: 'fill-box' }}/>
                                <foreignObject x={cx - innerRadius} y={cy - innerRadius} width={innerRadius * 2} height={innerRadius * 2}>
                                    <div className="w-full h-full flex flex-col items-center justify-center text-center"><div className="text-[8px] font-mono text-gray-500 mb-0.5 tracking-tighter">TARGET</div><div className="text-[10px] font-black text-white leading-none uppercase tracking-wide truncate w-full px-1">{activeMuscle.name.substring(0, 4)}</div></div>
                                </foreignObject>
                            </g>
                        </svg>
                        <div className="absolute bottom-4 left-0 w-full px-6 flex justify-between items-end pointer-events-none">
                            <div className="flex flex-col"><span className="text-[9px] text-gray-500 font-mono mb-1">SELECTED ZONE</span><span className="text-2xl font-display font-black text-white leading-none drop-shadow-md">{activeMuscle.name}</span></div>
                            <div className="flex flex-col items-end"><span className="text-[9px] text-gray-500 font-mono mb-1">VOLUME LOAD</span><div className="flex items-baseline gap-1"><span className="text-2xl font-display font-black leading-none" style={{ color: activeMuscle.color }}>{(activeMuscle.volume / 1000).toFixed(1)}</span><span className="text-xs font-bold text-gray-400">k</span></div></div>
                        </div>
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 p-1">
                        <div className="flex justify-center gap-4 py-3 flex-wrap">
                            {MUSCLES_T.slice(0, 4).map(m => (<div key={m.id} className="flex items-center gap-1.5 opacity-70 hover:opacity-100 transition-opacity cursor-default"><div className="w-2 h-2 rounded-full shadow-[0_0_5px_currentColor]" style={{ backgroundColor: m.color }}></div><span className="text-[9px] font-bold text-gray-300 uppercase tracking-wide">{m.name}</span></div>))}
                            <div className="flex items-center gap-1.5 opacity-50"><span className="text-[9px] font-bold text-gray-500">+2 OTHERS</span></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 7. BIO SCANNER (DNA Helix + Body Composition) - CONNECTED TO STATSDATA
        const BioScanner = () => {
            const canvasRef = useRef(null);
            
            const bodyData = window.StatsData ? window.StatsData.getBodyComposition() : {
                currentWeight: 74.5, startWeight: 80.2, goalWeight: 70.0, bodyFat: 14.2, height: 178
            };
            
            const { currentWeight, startWeight, goalWeight, bodyFat, height } = bodyData;
            const progress = ((startWeight - currentWeight) / (startWeight - goalWeight)) * 100;
            const bmi = (currentWeight / ((height / 100) ** 2)).toFixed(1);
            const leanMass = (currentWeight * (1 - bodyFat / 100)).toFixed(1);
            const fatMass = (currentWeight * (bodyFat / 100)).toFixed(1);
            
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                let time = 0;
                let animId;

                const render = () => {
                    const w = canvas.width = canvas.clientWidth * 2;
                    const h = canvas.height = canvas.clientHeight * 2;
                    ctx.scale(2, 2);
                    ctx.clearRect(0, 0, w, h);
                    time += 0.02;

                    const strands = 2;
                    const amplitude = 25;
                    const period = 80;
                    const particlesPerStrand = 18;
                    const cw = canvas.clientWidth;
                    const ch = canvas.clientHeight;

                    for (let s = 0; s < strands; s++) {
                        const offset = s * Math.PI;
                        for (let i = 0; i < particlesPerStrand; i++) {
                            const y = (i / particlesPerStrand) * ch;
                            const x = cw / 2 + Math.sin((y / period) + time + offset) * amplitude;
                            
                            ctx.beginPath();
                            ctx.arc(x, y, 4, 0, Math.PI * 2);
                            ctx.fillStyle = s === 0 ? '#06b6d4' : '#d946ef';
                            ctx.shadowBlur = 8;
                            ctx.shadowColor = s === 0 ? '#06b6d4' : '#d946ef';
                            ctx.fill();
                            ctx.shadowBlur = 0;
                            
                            if (s === 0) {
                                const x2 = cw / 2 + Math.sin((y / period) + time + Math.PI) * amplitude;
                                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                                ctx.lineWidth = 1;
                                ctx.beginPath();
                                ctx.moveTo(x, y);
                                ctx.lineTo(x2, y);
                                ctx.stroke();
                            }
                        }
                    }

                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    animId = requestAnimationFrame(render);
                };
                
                render();
                return () => cancelAnimationFrame(animId);
            }, []);

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[420px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-cyan-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Scale className="text-cyan-500" size={18} />
                                BIO.SCANNER
                            </h2>
                            <p className="text-[10px] text-cyan-500/60 font-mono font-bold mt-1">COMPOSITION ANALYSIS</p>
                        </div>
                        <div className="px-2 py-1 bg-emerald-500/10 border border-emerald-500/30 rounded text-[10px] text-emerald-400 font-mono font-bold">
                            ATHLETE
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] relative flex flex-col items-center justify-center p-6">
                        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-purple-900/10 via-transparent to-transparent pointer-events-none"></div>
                        
                        <div className="flex w-full items-center justify-between relative z-10">
                            <div className="text-right flex-1">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1 tracking-wider">Current Mass</div>
                                <div className="text-4xl font-display font-black text-white leading-none">
                                    {currentWeight}<span className="text-lg text-gray-600 ml-1">kg</span>
                                </div>
                                <div className="text-xs text-emerald-400 flex items-center justify-end gap-1 mt-2">
                                    <TrendingDown size={12}/> -{(startWeight - currentWeight).toFixed(1)}kg
                                </div>
                            </div>

                            <div className="w-24 h-52 relative mx-4 flex-shrink-0">
                                <canvas ref={canvasRef} className="w-full h-full" style={{ imageRendering: 'crisp-edges' }} />
                            </div>

                            <div className="text-left flex-1">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1 tracking-wider">Adipose Tissue</div>
                                <div className="text-4xl font-display font-black text-white leading-none">
                                    {bodyFat}<span className="text-lg text-gray-600 ml-1">%</span>
                                </div>
                                <div className="text-xs text-cyan-400 mt-2 font-bold uppercase tracking-wide">
                                    Athlete Zone
                                </div>
                            </div>
                        </div>

                        <div className="w-full mt-8 relative z-10">
                            <div className="flex justify-between text-[9px] font-mono text-gray-500 mb-2">
                                <span>START: {startWeight}kg</span>
                                <span className="text-cyan-400 font-bold">{progress.toFixed(0)}%</span>
                                <span>GOAL: {goalWeight}kg</span>
                            </div>
                            <div className="h-2 bg-gray-800/50 rounded-full overflow-hidden relative border border-white/5">
                                <div 
                                    className="absolute inset-y-0 left-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-fuchsia-500 rounded-full transition-all duration-1000"
                                    style={{ width: `${Math.min(progress, 100)}%` }}
                                ></div>
                                <div 
                                    className="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-[0_0_10px_white,0_0_20px_rgba(255,255,255,0.5)] border-2 border-cyan-400 transition-all duration-1000"
                                    style={{ left: `calc(${Math.min(progress, 100)}% - 6px)` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-[#080808] border-t border-white/10 px-6 py-4">
                        <div className="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">BMI</div>
                                <div className="text-lg font-display font-bold text-white">{bmi}</div>
                            </div>
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">Lean Mass</div>
                                <div className="text-lg font-display font-bold text-cyan-400">{leanMass}<span className="text-xs text-gray-500">kg</span></div>
                            </div>
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">Fat Mass</div>
                                <div className="text-lg font-display font-bold text-purple-400">{fatMass}<span className="text-xs text-gray-500">kg</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 8. BIO SYNTHETICS (Morphological Scanner with Hex Body) - CONNECTED TO STATSDATA
        const BioSynthetics = () => {
            const morphData = window.StatsData ? window.StatsData.getMorphologyData() : null;
            
            const MUSCLE_DATA = morphData ? [
                { id: 'chest', label: 'PECTORALIS', score: morphData.muscles.find(m => m.label === 'PECTORAUX')?.score || 50, symmetry: 52, type: 'push', sets: morphData.muscles.find(m => m.label === 'PECTORAUX')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'PECTORAUX')?.volume || 0 },
                { id: 'back', label: 'DORSALS', score: morphData.muscles.find(m => m.label === 'DOS')?.score || 50, symmetry: 48, type: 'pull', sets: morphData.muscles.find(m => m.label === 'DOS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'DOS')?.volume || 0 },
                { id: 'shoulders', label: 'DELTOIDS', score: morphData.muscles.find(m => m.label === 'ÉPAULES')?.score || 50, symmetry: 50, type: 'push', sets: morphData.muscles.find(m => m.label === 'ÉPAULES')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'ÉPAULES')?.volume || 0 },
                { id: 'arms', label: 'BRACHII', score: morphData.muscles.find(m => m.label === 'BRAS')?.score || 50, symmetry: 45, type: 'pull', sets: morphData.muscles.find(m => m.label === 'BRAS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'BRAS')?.volume || 0 },
                { id: 'legs', label: 'QUADRICEPS', score: morphData.muscles.find(m => m.label === 'JAMBES')?.score || 50, symmetry: 50, type: 'legs', sets: morphData.muscles.find(m => m.label === 'JAMBES')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'JAMBES')?.volume || 0 },
                { id: 'core', label: 'ABDOMINALS', score: morphData.muscles.find(m => m.label === 'ABDOS')?.score || 20, symmetry: 50, type: 'pull', sets: morphData.muscles.find(m => m.label === 'ABDOS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'ABDOS')?.volume || 0 },
            ] : [
                { id: 'chest', label: 'PECTORALIS', score: 50, symmetry: 52, type: 'push', sets: 0, volume: 0 },
                { id: 'back', label: 'DORSALS', score: 50, symmetry: 48, type: 'pull', sets: 0, volume: 0 },
                { id: 'shoulders', label: 'DELTOIDS', score: 50, symmetry: 50, type: 'push', sets: 0, volume: 0 },
                { id: 'arms', label: 'BRACHII', score: 50, symmetry: 45, type: 'pull', sets: 0, volume: 0 },
                { id: 'legs', label: 'QUADRICEPS', score: 50, symmetry: 50, type: 'legs', sets: 0, volume: 0 },
                { id: 'core', label: 'ABDOMINALS', score: 20, symmetry: 50, type: 'pull', sets: 0, volume: 0 },
            ];
            
            const distribution = morphData?.distribution || { push: 33, pull: 34, legs: 33 };

            const [selectedZone, setSelectedZone] = useState(MUSCLE_DATA[0]);

            const getTypeColor = (type) => {
                if (type === 'push') return '#ef4444';
                if (type === 'pull') return '#3b82f6';
                return '#eab308';
            };

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[600px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-blue-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <User className="text-blue-500" size={18} />
                                BIO.SYNTHETICS
                            </h2>
                            <p className="text-[10px] text-blue-500/60 font-mono font-bold mt-1 flex items-center gap-1">
                                <ScanLine size={10} className="animate-spin-slow"/>
                                MORPHOLOGICAL SCAN
                            </p>
                        </div>
                        <div className="px-2 py-1 rounded border border-blue-500/30 text-[10px] font-black uppercase tracking-wider bg-blue-500/10 text-blue-400">
                            SYMMETRY: 92%
                        </div>
                    </div>

                    <div className="relative bg-[#010101] flex-1 p-4 flex flex-col items-center justify-center overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.05)_1px,transparent_1px)] bg-[size:40px_40px]"></div>

                        <div className="relative w-[300px] h-[400px]">
                            <div className="absolute left-0 right-0 h-[2px] bg-blue-400 shadow-[0_0_15px_#3b82f6] z-30 pointer-events-none animate-scan opacity-80"></div>
                            <div className="absolute left-0 right-0 h-[20px] bg-gradient-to-b from-blue-500/20 to-transparent z-30 pointer-events-none animate-scan"></div>

                            <svg viewBox="0 0 200 300" className="w-full h-full drop-shadow-2xl">
                                <defs>
                                    <filter id="glowBody">
                                        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                        <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                    </filter>
                                </defs>

                                <path d="M 100 20 L 115 30 L 115 50 L 100 60 L 85 50 L 85 30 Z" fill="#111" stroke="#333" strokeWidth="1" />
                                
                                <g onClick={() => setSelectedZone(MUSCLE_DATA[0])} className="cursor-pointer">
                                    <path d="M 100 65 L 130 65 L 125 95 L 100 105 L 75 95 L 70 65 Z" 
                                        fill={selectedZone.id === 'chest' ? '#ef4444' : '#1a0505'} 
                                        stroke="#ef4444" 
                                        strokeWidth={selectedZone.id === 'chest' ? 2 : 1}
                                        className="transition-colors duration-300"
                                        opacity={selectedZone.id === 'chest' ? 1 : 0.6}
                                    />
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[5])} className="cursor-pointer">
                                    <path d="M 100 105 L 120 100 L 120 130 L 100 140 L 80 130 L 80 100 Z" 
                                        fill={selectedZone.id === 'core' ? '#3b82f6' : '#050a1a'} 
                                        stroke="#3b82f6" 
                                        strokeWidth={selectedZone.id === 'core' ? 2 : 1}
                                        opacity={selectedZone.id === 'core' ? 1 : 0.6}
                                    />
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[2])} className="cursor-pointer">
                                    <circle cx="65" cy="70" r="12" fill={selectedZone.id === 'shoulders' ? '#ef4444' : '#111'} stroke="#ef4444" opacity="0.8"/>
                                    <circle cx="135" cy="70" r="12" fill={selectedZone.id === 'shoulders' ? '#ef4444' : '#111'} stroke="#ef4444" opacity="0.8"/>
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[3])} className="cursor-pointer">
                                    <rect x="50" y="85" width="15" height="40" rx="5" fill={selectedZone.id === 'arms' ? '#3b82f6' : '#111'} stroke="#3b82f6"/>
                                    <rect x="135" y="85" width="15" height="40" rx="5" fill={selectedZone.id === 'arms' ? '#3b82f6' : '#111'} stroke="#3b82f6"/>
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[4])} className="cursor-pointer">
                                    <path d="M 100 140 L 130 150 L 125 220 L 105 230 L 100 180 Z" fill={selectedZone.id === 'legs' ? '#eab308' : '#1a1a05'} stroke="#eab308"/>
                                    <path d="M 100 140 L 100 180 L 95 230 L 75 220 L 70 150 Z" fill={selectedZone.id === 'legs' ? '#eab308' : '#1a1a05'} stroke="#eab308"/>
                                </g>
                            </svg>

                            <div className="absolute top-10 left-0">
                                <div className="flex items-center gap-1 text-[9px] text-red-500 font-bold bg-red-900/20 px-2 py-0.5 rounded border border-red-500/30">
                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></span> PUSH {distribution.push}%
                                </div>
                            </div>
                            <div className="absolute top-20 right-0">
                                <div className="flex items-center gap-1 text-[9px] text-blue-500 font-bold bg-blue-900/20 px-2 py-0.5 rounded border border-blue-500/30">
                                    <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span> PULL {distribution.pull}%
                                </div>
                            </div>
                            <div className="absolute bottom-20 left-0">
                                <div className="flex items-center gap-1 text-[9px] text-yellow-500 font-bold bg-yellow-900/20 px-2 py-0.5 rounded border border-yellow-500/30">
                                    <span className="w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"></span> LEGS {distribution.legs}%
                                </div>
                            </div>
                        </div>

                        <div className="w-full bg-[#080808] border border-white/10 rounded-xl p-3 mb-2 relative overflow-hidden">
                            <div className="flex justify-between text-[9px] font-mono text-gray-500 mb-1">
                                <span>LEFT SIDE</span>
                                <span className="text-white font-bold">LATERAL BALANCE</span>
                                <span>RIGHT SIDE</span>
                            </div>
                            <div className="h-2 bg-gray-800 rounded-full relative">
                                <div className="absolute top-0 bottom-0 left-1/2 w-0.5 bg-white z-10"></div>
                                <div 
                                    className="absolute top-0 bottom-0 bg-blue-500 rounded-full transition-all duration-500"
                                    style={{ 
                                        left: selectedZone.symmetry > 50 ? '50%' : `${selectedZone.symmetry}%`, 
                                        right: selectedZone.symmetry > 50 ? `${100 - selectedZone.symmetry}%` : '50%',
                                        backgroundColor: selectedZone.symmetry === 50 ? '#10b981' : Math.abs(50 - selectedZone.symmetry) > 5 ? '#ef4444' : '#3b82f6'
                                    }}
                                ></div>
                            </div>
                            <div className="flex justify-between text-[8px] font-mono text-gray-600 mt-1">
                                <span>{(100 - selectedZone.symmetry)}%</span>
                                <span className={Math.abs(50 - selectedZone.symmetry) > 5 ? "text-red-500" : "text-green-500"}>
                                    {Math.abs(50 - selectedZone.symmetry) < 2 ? 'PERFECT' : 'IMBALANCE DETECTED'}
                                </span>
                                <span>{selectedZone.symmetry}%</span>
                            </div>
                        </div>
                    </div>

                    <div className="bg-[#080808] border-t border-white/10 p-5">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-white/5 rounded-lg border border-white/10 flex items-center justify-center">
                                    <Layers size={18} style={{color: getTypeColor(selectedZone.type)}} />
                                </div>
                                <div>
                                    <h3 className="text-white font-display font-bold text-lg leading-none">{selectedZone.label}</h3>
                                    <p className="text-[10px] text-gray-500 font-mono uppercase mt-1">
                                        Type: <span style={{color: getTypeColor(selectedZone.type)}}>{selectedZone.type.toUpperCase()}</span>
                                    </p>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-black text-white">{selectedZone.score}<span className="text-sm text-gray-600">%</span></div>
                                <div className="text-[8px] text-gray-500 font-black uppercase tracking-widest">Activation</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-2">
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">SETS</div>
                                <div className="text-sm font-bold text-white">{selectedZone.sets || 0}</div>
                            </div>
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">VOL</div>
                                <div className="text-sm font-bold text-white">{selectedZone.volume ? (selectedZone.volume / 1000).toFixed(1) + 'k' : '0'}</div>
                            </div>
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">FREQ</div>
                                <div className="text-sm font-bold text-white">{Math.ceil(selectedZone.sets / 4) || 0}x</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 9. CHALLENGE SYSTEM (Special Ops / Bounties) - CONNECTED TO STATSDATA
        const ChallengeSystem = () => {
            const challenges = window.StatsData ? window.StatsData.getChallengesData() : [
                { id: 1, title: 'IRON CLAD', desc: 'Soulever 100T en un mois', progress: 0, target: 100, reward: 'Titan Badge', color: 'cyan' },
                { id: 2, title: 'VELOCITY', desc: 'Maintenir densité >500kg/min pour 3 séances', progress: 0, target: 3, reward: 'Speed Demon', color: 'orange' },
                { id: 3, title: 'WIDOWMAKER', desc: 'Série de 20 reps au Squat', progress: 0, target: 1, reward: 'Legs of Steel', color: 'red' },
            ];

            const colors = {
                cyan: { text: 'text-cyan-400', bg: 'bg-cyan-500', border: 'border-cyan-500/30' },
                orange: { text: 'text-orange-400', bg: 'bg-orange-500', border: 'border-orange-500/30' },
                red: { text: 'text-red-400', bg: 'bg-red-500', border: 'border-red-500/30' },
                purple: { text: 'text-purple-400', bg: 'bg-purple-500', border: 'border-purple-500/30' }
            };

            const completedCount = challenges.filter(c => (c.progress / c.target) >= 1).length;

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[500px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-yellow-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Crosshair className="text-yellow-500" size={18} />
                                SPECIAL OPS
                            </h2>
                            <p className="text-[10px] text-yellow-600 font-mono font-bold mt-1">ACTIVE BOUNTIES</p>
                        </div>
                        <div className="flex -space-x-2">
                            {completedCount > 0 && (
                                <div className="w-6 h-6 rounded-full bg-emerald-500 border-2 border-black flex items-center justify-center text-[10px] font-bold text-black">{completedCount}</div>
                            )}
                            <div className="w-6 h-6 rounded-full bg-yellow-500 border-2 border-black flex items-center justify-center text-[10px] font-bold text-black">{challenges.length}</div>
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] p-6 flex flex-col gap-4">
                        {challenges.map(challenge => {
                            const pct = Math.min((challenge.progress / challenge.target) * 100, 100);
                            const isDone = pct >= 100;
                            const c = colors[challenge.color] || colors.cyan;

                            return (
                                <div key={challenge.id} className={`bg-[#0a0a0a] border rounded-xl p-4 relative overflow-hidden group hover:bg-[#111] transition-colors ${c.border}`}>
                                    <Target className="absolute -right-4 -bottom-4 text-white/5 group-hover:scale-110 transition-transform duration-500" size={80} />
                                    
                                    <div className="flex justify-between items-start mb-2 relative z-10">
                                        <div>
                                            <div className={`text-[9px] font-black uppercase tracking-widest mb-1 ${c.text}`}>OPERATION</div>
                                            <h3 className="text-white font-display font-bold text-xl">{challenge.title}</h3>
                                        </div>
                                        <div className={`p-1.5 rounded border ${isDone ? 'bg-emerald-500/20 border-emerald-500/50' : 'bg-white/5 border-white/10'}`}>
                                            {isDone ? <Check size={14} className="text-emerald-400"/> : <Target size={14} className="text-gray-500"/>}
                                        </div>
                                    </div>
                                    
                                    <p className="text-xs text-gray-400 font-mono mb-4 relative z-10">{challenge.desc}</p>
                                    
                                    <div className="relative z-10">
                                        <div className="flex justify-between text-[9px] font-bold text-gray-500 mb-1">
                                            <span>PROGRESS</span>
                                            <span className={isDone ? 'text-emerald-400' : ''}>{challenge.progress} / {challenge.target}</span>
                                        </div>
                                        <div className="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden">
                                            <div className={`h-full ${isDone ? 'bg-emerald-500' : c.bg} transition-all duration-1000`} style={{width: `${pct}%`}}></div>
                                        </div>
                                    </div>

                                    <div className="mt-3 flex items-center gap-2 text-[9px] text-gray-300 font-bold bg-white/5 w-fit px-2 py-1 rounded relative z-10 border border-white/5">
                                        <Trophy size={10} className="text-yellow-400"/>
                                        REWARD: {challenge.reward}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [loading, setLoading] = useState(true);
            const [bootStep, setBootStep] = useState(0);
            const [importMessage, setImportMessage] = useState(null);
            
            // --- DATA INTEGRATION FROM STATSDATA ---
            const [summary, setSummary] = useState({ score: 0, sessions: 0, maxSessions: 5, sets: 0, maxSets: 60, volume: 0, xp: 0 });
            const [zones, setZones] = useState(getZones());
            const [musclesTurbine, setMusclesTurbine] = useState(getMusclesTurbine());
            const [musclesHUD, setMusclesHUD] = useState(getMusclesHUD());
            const [weeksData, setWeeksData] = useState(getWeeksData());

            const refreshData = () => {
                if (window.StatsData) {
                    const s = window.StatsData.getSummary();
                    setSummary(s);
                    setZones(getZones());
                    setMusclesTurbine(getMusclesTurbine());
                    setMusclesHUD(getMusclesHUD());
                    setWeeksData(getWeeksData());
                }
            };

            useEffect(() => {
                refreshData();
                window.addEventListener('storage', refreshData);
                const interval = setInterval(refreshData, 5000);
                return () => {
                    window.removeEventListener('storage', refreshData);
                    clearInterval(interval);
                };
            }, []);

            const handleExport = () => {
                if (window.StatsData) {
                    window.StatsData.downloadBackup();
                    setImportMessage({ type: 'success', text: 'Backup téléchargé!' });
                    setTimeout(() => setImportMessage(null), 3000);
                }
            };

            const handleImport = () => {
                if (window.StatsData) {
                    window.StatsData.triggerImport((result) => {
                        setImportMessage({ type: result.success ? 'success' : 'error', text: result.message });
                        if (result.success) refreshData();
                        setTimeout(() => setImportMessage(null), 3000);
                    });
                }
            };

            // Boot Sequence
            useEffect(() => {
                if (!loading) return;
                const timeouts = [
                    setTimeout(() => setBootStep(1), 500),
                    setTimeout(() => setBootStep(2), 1200),
                    setTimeout(() => setBootStep(3), 2000),
                    setTimeout(() => setLoading(false), 2800),
                ];
                return () => timeouts.forEach(clearTimeout);
            }, [loading]);
            
            // Scramble Effect on title after loading
            useEffect(() => {
                if (loading) return;
                if (window.ScrambleEffect) {
                    const title = document.querySelector('h1.font-display');
                    const footer = document.querySelector('footer .font-mono');
                    if (title) window.ScrambleEffect.scramble(title, { delay: 100, speed: 25 });
                    if (footer) window.ScrambleEffect.scramble(footer, { delay: 300, speed: 20 });
                }
            }, [loading]);

            if (loading) {
                return (
                    <div className="fixed inset-0 bg-[#020202] text-cyan-500 font-mono z-50 flex flex-col items-center justify-center p-8 select-none">
                        <div className="w-full max-w-[300px] flex flex-col gap-4">
                            <div className="flex justify-between items-center border-b border-cyan-900/50 pb-2 mb-4">
                                <span className="text-xs font-bold tracking-[0.2em] animate-pulse">NEON.FIT V2.5</span>
                                <Power size={14} className="animate-spin-slow"/>
                            </div>
                            <div className="space-y-1 text-[10px] uppercase tracking-wider text-cyan-700">
                                <div className={bootStep >= 0 ? 'text-cyan-400' : ''}>[ SYSTEM_BOOT ] ... OK</div>
                                <div className={bootStep >= 1 ? 'text-cyan-400' : ''}>[ MEMORY_CHECK ] ... 64TB OK</div>
                                <div className={bootStep >= 2 ? 'text-cyan-400' : ''}>[ LOADING_USER_DATA ] ... OK</div>
                                <div className={bootStep >= 3 ? 'text-cyan-400' : ''}>[ ESTABLISHING_LINK ] ... SECURE</div>
                            </div>
                            <div className="h-1 w-full bg-cyan-900/30 mt-8 relative overflow-hidden"><div className="absolute inset-y-0 left-0 bg-cyan-400 animate-[slideIn_2.5s_ease-out_forwards]"></div></div>
                            <div className="mt-2 text-center text-xs text-cyan-600 animate-pulse">{bootStep === 3 ? 'ACCESS GRANTED' : 'INITIALIZING...'}</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#010101] text-white font-sans overflow-x-hidden relative selection:bg-cyan-500/30 pb-20">
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-fuchsia-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 [mask-image:linear-gradient(to_bottom,transparent,black_80%)]"></div>
                    </div>
                    
                    <header className="sticky top-0 left-0 w-full z-40 bg-[#010101]/80 backdrop-blur-lg border-b border-white/5 transition-all duration-300">
                        <div className="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
                            <div><h1 className="font-display font-black text-xl tracking-tighter text-white flex items-center gap-1"><Fingerprint size={18} className="text-cyan-400" />NEON<span className="text-cyan-400">.FIT</span></h1></div>
                            <div className="flex gap-2">
                                <button onClick={handleExport} className="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/20 transition-all active:scale-95" title="Exporter backup"><Download size={14} /></button>
                                <button onClick={handleImport} className="w-8 h-8 flex items-center justify-center rounded-full bg-blue-500/10 border border-blue-500/30 text-blue-400 hover:bg-blue-500/20 transition-all active:scale-95" title="Importer backup"><Plus size={14} /></button>
                                <button onClick={refreshData} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:bg-white/10 transition-all active:scale-95"><RotateCcw size={14} /></button>
                            </div>
                        </div>
                        {importMessage && (
                            <div className={`mx-4 mb-2 px-4 py-2 rounded-lg text-sm font-medium ${importMessage.type === 'success' ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' : 'bg-red-500/20 text-red-400 border border-red-500/30'}`}>
                                {importMessage.text}
                            </div>
                        )}
                    </header>

                    <main className="relative z-10 w-full max-w-md mx-auto px-4 py-6 flex flex-col gap-6">
                        <div className="animate-slideIn" style={{ animationDelay: '0.1s' }}><NeonTracker score={summary.score} sessions={{ current: summary.sessions, max: summary.maxSessions }} sets={{ current: summary.sets, max: summary.maxSets }} status={summary.score > 80 ? 'consistent' : 'warning'} /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.2s' }}><ActivityChart /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.3s' }}><WeeklyProgress weeksData={weeksData} /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.4s' }}><VolumeGauge volume={summary.volume} maxVolume={25000} stats={{ sets: summary.sets, tut: 2450, sessions: summary.sessions }} /></div>
                        <div className="grid gap-6">
                            <div className="animate-slideIn" style={{ animationDelay: '0.4s' }}><MuscleWorkload musclesTurbineData={musclesTurbine} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.5s' }}><IntensityZones zonesData={zones} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.6s' }}><MuscleHud musclesData={musclesHUD} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.7s' }}><BioScanner /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.8s' }}><BioSynthetics /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.9s' }}><ChallengeSystem /></div>
                        </div>
                    </main>

                    <footer className="fixed bottom-0 left-0 w-full bg-[#050505]/90 backdrop-blur border-t border-white/5 py-4 z-40">
                        <div className="max-w-md mx-auto flex justify-center text-[10px] text-gray-600 font-mono tracking-widest uppercase">// END OF STREAM //</div>
                    </footer>
                </div>
            );
        };

        // RENDER
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
