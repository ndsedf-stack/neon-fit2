<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NeonFit - Statistics Hub</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="cloud-sync-supabase.js"></script>
    <script src="scramble-effect.js"></script>
    <script src="starfield.js"></script>
    
    <!-- 2. FONTS (Orbitron for HUD, Inter for UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- 3. CONFIGURATION TAILWIND -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              neon: { cyan: '#06b6d4', magenta: '#d946ef', lime: '#84cc16' }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              display: ['Orbitron', 'sans-serif'],
            },
            animation: {
              'spin-slow': 'spin 10s linear infinite',
              'spin-reverse-slow': 'spin 15s linear infinite reverse',
              'slideIn': 'slideIn 0.5s ease-out forwards',
              'shimmer': 'shimmer 2s infinite',
              'scan': 'scan 4s ease-in-out infinite',
            },
            keyframes: {
              slideIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              shimmer: {
                '0%': { transform: 'translateX(-100%)' },
                '100%': { transform: 'translateX(100%)' },
              },
              scan: {
                '0%, 100%': { transform: 'translateY(-100%)', opacity: '0' },
                '50%': { opacity: '0.3' }
              }
            }
          }
        }
      }
    </script>

    <!-- 4. IMPORT MAP (React & Lucide depuis le navigateur) -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0"
      }
    }
    </script>
    
    <!-- 5. BABEL (Pour compiler le JSX dans le navigateur) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 6. STATS DATA MODULE -->
    <script src="stats-data.js"></script>

    <!-- 7. DEMO DATA GENERATOR (HYBRID MASTER 51 - 2 weeks) -->
    <script>
    (function() {
        const DEMO_STORAGE_KEY = 'neon_fit_workout_history';
        const existingData = localStorage.getItem(DEMO_STORAGE_KEY);
        
        // Only generate demo data if no real data exists
        if (!existingData || JSON.parse(existingData).length === 0) {
            console.log('[NEON FIT] Generating HYBRID MASTER 51 demo data (2 weeks)...');
            
            // DIMANCHE: DOS + JAMBES LOURDES + BRAS (31 séries = 5+4+4+4+4+4+4+2)
            const dimancheExercises = [
                { name: "Trap Bar Deadlift", muscle: ["dos", "jambes", "fessiers"], sets: 5, reps: 7, baseWeight: 75 },
                { name: "Goblet Squat", muscle: ["quadriceps", "fessiers"], sets: 4, reps: 10, baseWeight: 25 },
                { name: "Leg Press", muscle: ["quadriceps", "fessiers"], sets: 4, reps: 10, baseWeight: 110 },
                { name: "Lat Pulldown (prise large)", muscle: ["dos"], sets: 4, reps: 10, baseWeight: 60 },
                { name: "Landmine Press", muscle: ["pectoraux", "épaules"], sets: 4, reps: 10, baseWeight: 35 },
                { name: "Rowing Machine (prise large)", muscle: ["dos"], sets: 4, reps: 10, baseWeight: 50 },
                { name: "Incline Curl", muscle: ["biceps"], sets: 4, reps: 12, baseWeight: 12 },
                { name: "Cable Pushdown", muscle: ["triceps"], sets: 2, reps: 12, baseWeight: 20 }
            ];
            
            // MARDI: PECS + ÉPAULES + TRICEPS (35 séries)
            const mardiExercises = [
                { name: "Dumbbell Press", muscle: ["pectoraux"], sets: 5, reps: 10, baseWeight: 22 },
                { name: "Cable Fly", muscle: ["pectoraux"], sets: 4, reps: 12, baseWeight: 10 },
                { name: "Leg Press léger", muscle: ["quadriceps"], sets: 3, reps: 15, baseWeight: 80 },
                { name: "Extension Triceps Corde", muscle: ["triceps"], sets: 5, reps: 12, baseWeight: 20 },
                { name: "Lateral Raises", muscle: ["épaules"], sets: 5, reps: 15, baseWeight: 8 },
                { name: "Face Pull", muscle: ["épaules", "dos"], sets: 5, reps: 15, baseWeight: 20 },
                { name: "Rowing Machine (prise serrée)", muscle: ["dos"], sets: 4, reps: 12, baseWeight: 50 },
                { name: "Overhead Extension", muscle: ["triceps"], sets: 4, reps: 12, baseWeight: 15 }
            ];
            
            // VENDREDI: DOS + JAMBES LÉGÈRES + BRAS + ÉPAULES (33 séries)
            const vendrediExercises = [
                { name: "Landmine Row", muscle: ["dos"], sets: 5, reps: 10, baseWeight: 55 },
                { name: "Leg Curl", muscle: ["ischios"], sets: 5, reps: 12, baseWeight: 40 },
                { name: "Leg Extension", muscle: ["quadriceps"], sets: 4, reps: 15, baseWeight: 35 },
                { name: "Cable Fly", muscle: ["pectoraux"], sets: 4, reps: 15, baseWeight: 10 },
                { name: "Dumbbell Fly", muscle: ["pectoraux"], sets: 4, reps: 12, baseWeight: 10 },
                { name: "EZ Bar Curl", muscle: ["biceps"], sets: 5, reps: 12, baseWeight: 25 },
                { name: "Overhead Extension", muscle: ["triceps"], sets: 3, reps: 12, baseWeight: 15 },
                { name: "Lateral Raises", muscle: ["épaules"], sets: 3, reps: 15, baseWeight: 8 }
            ];
            
            const demoHistory = [];
            const allDays = [
                { key: 'dimanche', exercises: dimancheExercises },
                { key: 'mardi', exercises: mardiExercises },
                { key: 'vendredi', exercises: vendrediExercises }
            ];
            
            // Generate 2 weeks of realistic data
            for (let week = 1; week <= 2; week++) {
                allDays.forEach((dayData, dayIndex) => {
                    dayData.exercises.forEach(ex => {
                        for (let set = 1; set <= ex.sets; set++) {
                            const reps = ex.reps + Math.floor(Math.random() * 3) - 1;
                            const weight = ex.baseWeight + ((week - 1) * 2.5) + (Math.random() * 2 - 1);
                            
                            demoHistory.push({
                                exercise: ex.name,
                                muscle: ex.muscle,
                                week: week,
                                day: dayData.key,
                                set: set,
                                reps: Math.max(1, reps),
                                weight: Math.round(weight * 2) / 2,
                                targetReps: ex.reps,
                                completedAt: new Date(Date.now() - ((2 - week) * 7 + (2 - dayIndex) * 2) * 24 * 60 * 60 * 1000).toISOString()
                            });
                        }
                    });
                });
            }
            
            localStorage.setItem(DEMO_STORAGE_KEY, JSON.stringify(demoHistory));
            localStorage.setItem('hybrid_xp', '2200');
            localStorage.setItem('hybrid_current_week', '2');
            localStorage.setItem('hybrid_streak', '6');
            
            console.log('[NEON FIT] Demo data generated:', demoHistory.length, 'sets (target: ~198 for 2 weeks)');
        }
    })();
    </script>

    <style>
        body { 
            background: #010101; 
            color: #fff; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-overflow-scrolling: touch;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
    </style>
</head>
<body>
    <canvas id="starfield-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;"></canvas>
    <div id="root"></div>

    <!-- APPLICATION LOGIC -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Activity, Heart, Zap, Flame, Trophy, Calendar, Settings, User, 
            Menu, X, Play, Pause, ChevronRight, ChevronLeft, Target, Bot, Plus, Check,
            MessageSquare, Trash2, Download, AlertCircle, TrendingUp, TrendingDown,
            Layers, Clock, Battery, Fan, Disc, Dumbbell, Maximize2, RefreshCw, Cpu,
            RotateCcw, Power, Fingerprint, Hexagon, Crosshair, Scale, ScanLine,
            Brain, Shield, AlertTriangle, Scan, ShieldCheck, ScanFace, Camera, History,
            Loader2, Sparkles, Award, QrCode, Star, Droplets, Sword, Moon, Sun,
            Share2, Hourglass, Waves, Flag, MapPin
        } from 'lucide-react';

        // --- REAL DATA FROM STATSDATA ---
        const getZones = () => window.StatsData ? window.StatsData.getZonesData() : [
            { id: 'force', label: 'FORCE', range: '1-5 RM', percent: 0, sets: 0, color: 'bg-amber-500', shadow: 'shadow-amber-500/50' },
            { id: 'hyper', label: 'HYPERTROPHIE', range: '6-12 RM', percent: 0, sets: 0, color: 'bg-violet-500', shadow: 'shadow-violet-500/50' },
            { id: 'endu', label: 'ENDURANCE', range: '15+ RM', percent: 0, sets: 0, color: 'bg-cyan-500', shadow: 'shadow-cyan-500/50' },
        ];

        const getMusclesTurbine = () => {
            if (!window.StatsData) return [
                { id: 'm1', name: 'DOS', volume: 0, color: '#3b82f6' },
                { id: 'm2', name: 'PECTORAUX', volume: 0, color: '#22d3ee' },
                { id: 'm3', name: 'JAMBES', volume: 0, color: '#8b5cf6' },
                { id: 'm4', name: 'ÉPAULES', volume: 0, color: '#d946ef' },
                { id: 'm5', name: 'BRAS', volume: 0, color: '#f43f5e' },
                { id: 'm6', name: 'ABDOS', volume: 0, color: '#10b981' },
            ];
            const data = window.StatsData.getMusclesData();
            if (data.length === 0) return [
                { id: 'm1', name: 'DOS', volume: 0, color: '#3b82f6' },
                { id: 'm2', name: 'PECTORAUX', volume: 0, color: '#22d3ee' },
                { id: 'm3', name: 'JAMBES', volume: 0, color: '#8b5cf6' },
                { id: 'm4', name: 'ÉPAULES', volume: 0, color: '#d946ef' },
                { id: 'm5', name: 'BRAS', volume: 0, color: '#f43f5e' },
                { id: 'm6', name: 'ABDOS', volume: 0, color: '#10b981' },
            ];
            return data;
        };

        const getMusclesHUD = () => {
            if (!window.StatsData) return [
                { id: '1', name: 'PECS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '2', name: 'DOS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '3', name: 'JAMB', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
            ];
            const data = window.StatsData.getMusclesHUD();
            if (data.length === 0) return [
                { id: '1', name: 'PECS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '2', name: 'DOS', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
                { id: '3', name: 'JAMB', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 },
            ];
            return data;
        };

        const getWeeksData = () => {
            if (!window.StatsData) return [
                { id: 'w1', label: 'S1', volume: 0, intensity: 0, status: 'current', x: 60, y: 38 },
            ];
            return window.StatsData.getWeeksData();
        };

        // --- COMPONENTS ---

        // CIRCULAR PROGRESS (Reusable Component)
        const CircularProgress = ({
            size = 200,
            radius = 80,
            strokeWidth = 8,
            progress = 0,
            max = 100,
            colorStart = '#22d3ee',
            colorEnd = '#d946ef',
            variant = 'solid',
            trackColor = 'rgba(255,255,255,0.05)',
            glow = false,
            rotate = false,
            counterClockwise = false,
            cut = 0,
            rotationOffset = 0,
        }) => {
            const normalizedRadius = radius - strokeWidth / 2;
            const fullCircumference = normalizedRadius * 2 * Math.PI;
            const visibleCircumference = fullCircumference * ((360 - cut) / 360);
            
            const [offset, setOffset] = useState(visibleCircumference);
            const id = useMemo(() => `cprog-${Math.random().toString(36).substr(2,9)}`, []);
            const gradientId = `grad-${id}`;
            const percentage = Math.min(100, Math.max(0, (progress / max) * 100));

            useEffect(() => {
                const strokeLength = (percentage / 100) * visibleCircumference;
                const progressOffset = visibleCircumference - strokeLength;
                setOffset(progressOffset);
            }, [percentage, visibleCircumference]);

            const dashCount = variant === 'dots' ? 40 : 60;
            const dashLength = visibleCircumference / dashCount;
            const dashGap = variant === 'dots' ? dashLength * 2 : 3;
            const cutLength = fullCircumference - visibleCircumference;
            
            const trackDashArray = variant === 'dashed' || variant === 'dots'
                ? `${dashLength - dashGap} ${dashGap}`
                : `${visibleCircumference} ${cutLength}`;
            const progressDashArray = variant === 'dashed' || variant === 'dots'
                ? `${dashLength - dashGap} ${dashGap}`
                : `${visibleCircumference} ${cutLength}`;

            return (
                <div 
                    className={`absolute inset-0 flex items-center justify-center pointer-events-none ${rotate ? (counterClockwise ? 'animate-spin-reverse-slow' : 'animate-spin-slow') : ''}`}
                    style={{ transform: rotate ? undefined : `rotate(${rotationOffset}deg)` }}
                >
                    <svg width={size} height={size} className="overflow-visible" style={{ width: size, height: size, transform: 'rotate(-90deg)' }}>
                        <defs>
                            <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor={colorStart} />
                                <stop offset="100%" stopColor={colorEnd} />
                            </linearGradient>
                            <filter id={`glow-${id}`} x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <circle cx={size/2} cy={size/2} r={normalizedRadius} stroke={trackColor} strokeWidth={strokeWidth} fill="none" strokeLinecap="round" strokeDasharray={trackDashArray} className="opacity-100 transition-all duration-1000" />
                        <circle cx={size/2} cy={size/2} r={normalizedRadius} stroke={`url(#${gradientId})`} strokeWidth={strokeWidth} fill="none" strokeLinecap="round" strokeDasharray={progressDashArray} strokeDashoffset={offset} style={{ transition: 'stroke-dashoffset 1.5s cubic-bezier(0.2, 0.8, 0.2, 1)', filter: glow ? `url(#glow-${id})` : undefined }} />
                        {variant === 'solid' && cut === 0 && (
                            <circle cx={size/2} cy={size/2} r={normalizedRadius} stroke="white" strokeWidth={1} fill="none" strokeDasharray={fullCircumference} strokeDashoffset={offset} className="opacity-50 mix-blend-overlay blur-[0.5px]" style={{ transition: 'stroke-dashoffset 1.5s cubic-bezier(0.2, 0.8, 0.2, 1)' }} />
                        )}
                    </svg>
                </div>
            );
        };

        // COMMAND CENTER (Readiness Check)
        const CommandCenter = () => {
            const [isHovered, setIsHovered] = useState(false);
            
            // Get real data from StatsData
            const getSystemStatus = () => {
                if (!window.StatsData) return { neural: 'optimal', structural: 'optimal', metabolic: 'optimal' };
                const summary = window.StatsData.getSummary();
                const muscleData = window.StatsData.getMusclesHUD();
                
                // Neural: Based on session frequency
                const freqScore = (summary.sessions / summary.maxSessions) * 100;
                const neural = freqScore >= 60 ? 'optimal' : freqScore >= 30 ? 'warning' : 'critical';
                
                // Structural: Based on recovery (inverse of recent intensity)
                const avgRecovery = muscleData.length > 0 
                    ? muscleData.reduce((sum, m) => sum + (m.recovery || 100), 0) / muscleData.length 
                    : 100;
                const structural = avgRecovery >= 70 ? 'optimal' : avgRecovery >= 40 ? 'warning' : 'critical';
                
                // Metabolic: Based on volume reached
                const volScore = (summary.volume / 25000) * 100;
                const metabolic = volScore >= 50 ? 'optimal' : volScore >= 20 ? 'warning' : 'critical';
                
                return { neural, structural, metabolic };
            };
            
            const statusData = getSystemStatus();
            
            const systems = [
                { label: 'NEURAL', status: statusData.neural, icon: Brain, color: 'text-fuchsia-500' },
                { label: 'STRUCTURAL', status: statusData.structural, icon: Shield, color: 'text-yellow-500' },
                { label: 'METABOLIC', status: statusData.metabolic, icon: Zap, color: 'text-orange-500' },
            ];

            const criticalCount = systems.filter(s => s.status === 'critical').length;
            const isGo = criticalCount === 0;
            
            // Last sync time
            const getLastSync = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                if (history.length === 0) return 'No data';
                const lastEntry = history[history.length - 1];
                const lastDate = new Date(lastEntry.completedAt || lastEntry.date);
                const diff = Date.now() - lastDate.getTime();
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                return 'Just now';
            };

            const handleStart = () => {
                if (isGo) {
                    window.location.href = 'briefing.html';
                }
            };

            return (
                <div className="relative w-full max-w-md bg-[#050505] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[400px] shadow-2xl">
                    
                    {/* HEADER */}
                    <div className="bg-[#0a0a0a] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Power className="text-green-500" size={18} />
                                COMMAND.CENTER
                            </h2>
                            <p className="text-[10px] text-green-500/60 font-mono font-bold mt-1">READINESS CHECK</p>
                        </div>
                        <div className={`px-2 py-1 rounded border text-[10px] font-black uppercase tracking-wider ${isGo ? 'bg-green-900/20 border-green-500/30 text-green-400' : 'bg-red-900/20 border-red-500/30 text-red-400'}`}>
                            {isGo ? 'SYSTEM GO' : 'HOLD'}
                        </div>
                    </div>

                    {/* BODY */}
                    <div className="flex-1 bg-[#020202] p-6 flex flex-col items-center justify-center">
                        
                        {/* Status Grid */}
                        <div className="w-full grid grid-cols-3 gap-3 mb-8">
                            {systems.map((sys, i) => (
                                <div key={i} className="bg-[#0a0a0a] border border-white/5 rounded-lg p-3 flex flex-col items-center text-center">
                                    <sys.icon size={18} className={`${sys.color} mb-2`} />
                                    <div className="text-[9px] font-bold text-gray-500 uppercase tracking-wider mb-1">{sys.label}</div>
                                    <div className={`text-[10px] font-mono font-bold uppercase ${sys.status === 'optimal' ? 'text-green-400' : sys.status === 'warning' ? 'text-yellow-400' : 'text-red-400'}`}>
                                        {sys.status}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* THE BIG BUTTON */}
                        <div 
                            className="relative group cursor-pointer"
                            onMouseEnter={() => setIsHovered(true)}
                            onMouseLeave={() => setIsHovered(false)}
                            onClick={handleStart}
                        >
                            {/* Outer Ring */}
                            <div className={`absolute inset-[-10px] rounded-full border-2 border-dashed transition-all duration-500 ${isHovered ? 'border-green-500 rotate-180 scale-110' : 'border-gray-700'}`}></div>
                            
                            {/* The Button */}
                            <div className={`
                                w-32 h-32 rounded-full flex flex-col items-center justify-center transition-all duration-300 shadow-2xl
                                ${isGo 
                                    ? 'bg-gradient-to-br from-green-600 to-green-900 shadow-[0_0_50px_rgba(34,197,94,0.4)] border-4 border-green-400' 
                                    : 'bg-gray-800 border-4 border-gray-600 grayscale'}
                                ${isHovered && isGo ? 'scale-105 brightness-110' : ''}
                            `}>
                                <span className="text-3xl font-black text-white tracking-tighter drop-shadow-md">{isGo ? 'START' : 'WAIT'}</span>
                                <span className="text-[9px] font-mono text-green-200 font-bold uppercase mt-1">SESSION</span>
                            </div>
                        </div>

                    </div>

                    {/* FOOTER */}
                    <div className="bg-[#0a0a0a] p-4 border-t border-white/10 text-center">
                        <p className="text-[9px] text-gray-500 font-mono uppercase">
                            Last Sync: {getLastSync()} • {isGo ? 'All systems nominal' : 'Check warnings'}
                        </p>
                    </div>

                </div>
            );
        };

        // CONSISTENCY LOG (Temporal Frequency Spectrum)
        const ConsistencyLog = () => {
            // Get real workout history for the last 14 days
            const getHistoryData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const now = new Date();
                const days = [];
                
                for (let i = 13; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // Find sessions for this day
                    const daySessions = history.filter(h => {
                        const sessionDate = new Date(h.completedAt || h.date).toISOString().split('T')[0];
                        return sessionDate === dateStr;
                    });
                    
                    // Calculate intensity based on volume
                    const totalVolume = daySessions.reduce((sum, s) => {
                        const sets = s.sets || [];
                        return sum + sets.reduce((v, set) => v + (set.weight || 0) * (set.reps || 0), 0);
                    }, 0);
                    
                    const intensity = daySessions.length > 0 ? Math.min(1, totalVolume / 5000) : 0;
                    days.push({ date: dateStr, intensity, sessions: daySessions.length });
                }
                return days;
            };
            
            const historyData = getHistoryData();
            
            // Calculate streak
            const getStreak = () => {
                let streak = 0;
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                if (history.length === 0) return 0;
                
                const now = new Date();
                for (let i = 0; i < 365; i++) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const hasSession = history.some(h => {
                        const sessionDate = new Date(h.completedAt || h.date).toISOString().split('T')[0];
                        return sessionDate === dateStr;
                    });
                    
                    if (hasSession || i === 0) {
                        if (hasSession) streak++;
                    } else {
                        break;
                    }
                }
                return streak;
            };
            
            // Calculate stats
            const activeDays = historyData.filter(d => d.intensity > 0).length;
            const consistency = Math.round((activeDays / 14) * 100);
            const frequency = (activeDays / 2).toFixed(1);
            const totalSessions = window.StatsData ? window.StatsData.getSummary().sessions : 0;
            const streak = getStreak();

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[400px] shadow-2xl">
                    
                    {/* HEADER */}
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-green-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Calendar className="text-green-500" size={18} />
                                TEMPORAL.LOG
                            </h2>
                            <p className="text-[10px] text-green-500/60 font-mono font-bold mt-1">FREQUENCY SPECTRUM</p>
                        </div>
                        <div className="flex items-center gap-1 px-3 py-1 rounded bg-green-900/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider animate-pulse">
                            <Flame size={12} className="fill-current"/> {streak} DAY STREAK
                        </div>
                    </div>

                    {/* BODY: WAVEFORM */}
                    <div className="flex-1 bg-[#010101] p-6 flex flex-col justify-center">
                        
                        <div className="flex items-end justify-between h-[150px] gap-2">
                            {historyData.map((day, i) => (
                                <div key={i} className="flex-1 flex flex-col justify-end group cursor-pointer">
                                    <div 
                                        className={`w-full rounded-t-sm transition-all duration-500 hover:bg-white ${day.intensity > 0 ? 'bg-green-500 shadow-[0_0_15px_#22c55e]' : 'bg-[#111]'}`}
                                        style={{ height: day.intensity > 0 ? `${Math.max(10, day.intensity * 100)}%` : '4px' }}
                                    ></div>
                                    <div className="text-[8px] text-gray-600 text-center mt-2 font-mono opacity-0 group-hover:opacity-100">
                                        D{i+1}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="mt-6 flex justify-between text-xs font-bold text-white bg-[#0a0a0a] p-3 rounded-xl border border-white/5">
                            <div className="text-center">
                                <div className="text-[8px] text-gray-500 uppercase mb-1">Consist.</div>
                                {consistency}%
                            </div>
                            <div className="text-center">
                                <div className="text-[8px] text-gray-500 uppercase mb-1">Freq</div>
                                {frequency}/wk
                            </div>
                            <div className="text-center">
                                <div className="text-[8px] text-gray-500 uppercase mb-1">Total</div>
                                {totalSessions}
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        // HYBRID CORE (Energy Systems - WITH PISTON ANIMATIONS)
        const HybridCore = () => {
            useEffect(() => {
                if (!document.getElementById('hybrid-core-animations')) {
                    const style = document.createElement('style');
                    style.id = 'hybrid-core-animations';
                    style.textContent = `
                        @keyframes piston-pump-1 {
                            0%, 100% { transform: translateY(0px); }
                            50% { transform: translateY(-25px); }
                        }
                        @keyframes piston-pump-2 {
                            0%, 100% { transform: translateY(-25px); }
                            50% { transform: translateY(0px); }
                        }
                        @keyframes gear-rotate {
                            from { transform: rotate(0deg); }
                            to { transform: rotate(360deg); }
                        }
                        @keyframes gear-rotate-reverse {
                            from { transform: rotate(360deg); }
                            to { transform: rotate(0deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            const getEnergyRatio = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                if (history.length === 0) return { strength: 65, cardio: 35 };
                let totalSets = 0;
                let strengthSets = 0;
                history.forEach(workout => {
                    const sets = workout.sets || [];
                    sets.forEach(set => {
                        totalSets++;
                        const reps = set.reps || 10;
                        if (reps <= 5) strengthSets += 1;
                        else if (reps <= 12) strengthSets += 0.7;
                        else strengthSets += 0.3;
                    });
                });
                if (totalSets === 0) return { strength: 65, cardio: 35 };
                const strengthPct = Math.round((strengthSets / totalSets) * 100);
                return { strength: strengthPct, cardio: 100 - strengthPct };
            };
            
            const { strength: strengthPct, cardio: cardioPct } = getEnergyRatio();

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[450px] shadow-2xl">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-orange-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Zap className="text-orange-500" size={18} />
                                HYBRID.ENGINE
                            </h2>
                            <p className="text-[10px] text-orange-500/60 font-mono font-bold mt-1">ENERGY SYSTEMS</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-orange-500/30 text-[10px] font-black uppercase bg-orange-500/10 text-orange-400">
                            V8 DUAL CORE
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] p-6 flex flex-col justify-center overflow-hidden relative">
                        
                        {/* Rotating Gears - Multiple layers */}
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div className="w-[280px] h-[280px] border-[15px] border-dashed border-orange-500/10 rounded-full" style={{animation: 'gear-rotate 20s linear infinite'}}></div>
                            <div className="absolute w-[220px] h-[220px] border-[10px] border-dotted border-cyan-500/10 rounded-full" style={{animation: 'gear-rotate-reverse 15s linear infinite'}}></div>
                            <div className="absolute w-[160px] h-[160px] border-[8px] border-dashed border-white/5 rounded-full" style={{animation: 'gear-rotate 10s linear infinite'}}></div>
                        </div>

                        <div className="flex items-end justify-center gap-8 h-[240px] mb-6 relative z-10">
                            
                            {/* Piston 1: Strength (Orange) - ANIMATED */}
                            <div className="flex-1 flex flex-col justify-end relative group h-full max-w-[100px]">
                                <div className="relative z-10 flex flex-col items-center mb-2" style={{animation: 'piston-pump-1 1s ease-in-out infinite'}}>
                                    <div className="w-16 h-16 rounded-lg bg-[#1a0a00] border-2 border-orange-500 flex flex-col items-center justify-center shadow-[0_0_20px_rgba(249,115,22,0.3)]">
                                        <Dumbbell className="text-orange-500 mb-1" size={20}/>
                                        <span className="text-lg font-black text-white">{strengthPct}%</span>
                                    </div>
                                    <div className="w-4 h-8 bg-gradient-to-b from-orange-500 to-orange-700 rounded-b"></div>
                                </div>
                                <div className="w-full bg-[#1a0a00] rounded-lg border border-orange-500/50 h-[120px] relative overflow-hidden">
                                    <div className="absolute bottom-0 w-full bg-gradient-to-t from-orange-600/40 to-transparent transition-all duration-500" style={{height: `${strengthPct}%`}}>
                                        <div className="absolute inset-0 bg-orange-500/20 animate-pulse"></div>
                                    </div>
                                </div>
                                <span className="text-[9px] font-bold text-orange-500 uppercase tracking-wider text-center mt-2">ANAEROBIC</span>
                            </div>

                            {/* Piston 2: Cardio (Cyan) - ANIMATED (opposite phase) */}
                            <div className="flex-1 flex flex-col justify-end relative group h-full max-w-[100px]">
                                <div className="relative z-10 flex flex-col items-center mb-2" style={{animation: 'piston-pump-2 1s ease-in-out infinite'}}>
                                    <div className="w-16 h-16 rounded-lg bg-[#001a1a] border-2 border-cyan-500 flex flex-col items-center justify-center shadow-[0_0_20px_rgba(6,182,212,0.3)]">
                                        <Heart className="text-cyan-500 mb-1" size={20}/>
                                        <span className="text-lg font-black text-white">{cardioPct}%</span>
                                    </div>
                                    <div className="w-4 h-8 bg-gradient-to-b from-cyan-500 to-cyan-700 rounded-b"></div>
                                </div>
                                <div className="w-full bg-[#001a1a] rounded-lg border border-cyan-500/50 h-[120px] relative overflow-hidden">
                                    <div className="absolute bottom-0 w-full bg-gradient-to-t from-cyan-600/40 to-transparent transition-all duration-500" style={{height: `${cardioPct}%`}}>
                                        <div className="absolute inset-0 bg-cyan-500/20 animate-pulse"></div>
                                    </div>
                                </div>
                                <span className="text-[9px] font-bold text-cyan-500 uppercase tracking-wider text-center mt-2">AEROBIC</span>
                            </div>

                        </div>

                        {/* Balance Bar */}
                        <div className="relative h-8 bg-[#0a0a0a] rounded-lg border border-white/5 flex items-center px-2 z-10">
                            <div className="absolute left-1/2 top-0 bottom-0 w-px bg-gray-700"></div>
                            <div className="absolute top-1 bottom-1 w-2 bg-white rounded shadow-[0_0_15px_white] transition-all duration-1000" style={{left: `calc(${strengthPct}% - 4px)`}}></div>
                            <span className="text-[9px] font-mono text-orange-500 z-10 ml-2 font-bold">POWER</span>
                            <div className="flex-1"></div>
                            <span className="text-[9px] font-mono text-cyan-500 z-10 mr-2 font-bold">ENDURANCE</span>
                        </div>

                    </div>
                </div>
            );
        };

        // INJURY MAP (Bio Armor - Structural Integrity)
        const InjuryMap = () => {
            const [selected, setSelected] = useState(null);
            
            // Get body zones status from real muscle data
            const getBodyZones = () => {
                const muscleData = window.StatsData ? window.StatsData.getMusclesHUD() : [];
                
                const getZoneStatus = (muscleNames) => {
                    const relevantMuscles = muscleData.filter(m => 
                        muscleNames.some(name => m.name.toUpperCase().includes(name))
                    );
                    if (relevantMuscles.length === 0) return 'optimal';
                    
                    const avgIntensity = relevantMuscles.reduce((sum, m) => sum + (m.intensity || 0), 0) / relevantMuscles.length;
                    const avgRecovery = relevantMuscles.reduce((sum, m) => sum + (m.recovery || 100), 0) / relevantMuscles.length;
                    
                    if (avgRecovery < 40 || avgIntensity > 80) return 'risk';
                    if (avgRecovery < 70 || avgIntensity > 60) return 'strain';
                    return 'optimal';
                };
                
                return [
                    { id: 'chest', label: 'PECTORAL PLATE', status: getZoneStatus(['PECS', 'PECTORAUX']) },
                    { id: 'abs', label: 'CORE REACTOR', status: getZoneStatus(['ABDOS', 'CORE']) },
                    { id: 'shoulders', label: 'DELT GUARDS', status: getZoneStatus(['ÉPAULES', 'DELTS']) },
                    { id: 'arms', label: 'ARM SERVOS', status: getZoneStatus(['BRAS', 'BICEPS', 'TRICEPS']) },
                    { id: 'legs', label: 'LEG PISTONS', status: getZoneStatus(['JAMBES', 'JAMB', 'LEGS']) },
                    { id: 'back', label: 'DORSAL ARRAY', status: getZoneStatus(['DOS', 'BACK']) },
                ];
            };
            
            const bodyZones = getBodyZones();
            const selectedZone = selected || bodyZones[0];
            
            const getStatusColor = (status) => {
                if (status === 'risk') return '#ef4444';
                if (status === 'strain') return '#eab308';
                return '#22c55e';
            };

            // Overall integrity
            const riskCount = bodyZones.filter(z => z.status === 'risk').length;
            const strainCount = bodyZones.filter(z => z.status === 'strain').length;
            const integrity = Math.round(((bodyZones.length - riskCount * 2 - strainCount) / bodyZones.length) * 100);

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[500px] shadow-2xl">
                    
                    {/* HEADER */}
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-red-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Scan className="text-red-500" size={18} />
                                BIO.ARMOR
                            </h2>
                            <p className="text-[10px] text-red-500/60 font-mono font-bold mt-1">STRUCTURAL INTEGRITY</p>
                        </div>
                        <div className="flex items-center gap-1 px-2 py-1 rounded border border-red-500/30 text-[10px] font-black uppercase bg-red-500/10 text-red-400">
                            <Activity size={10} className="fill-current animate-pulse"/> {integrity}%
                        </div>
                    </div>

                    {/* BODY: ZONE LIST */}
                    <div className="flex-1 bg-[#010101] p-6 flex flex-col">
                        
                        {/* Zone Grid */}
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {bodyZones.map((zone) => (
                                <div 
                                    key={zone.id}
                                    onClick={() => setSelected(zone)}
                                    className={`p-4 rounded-xl border cursor-pointer transition-all duration-300 ${
                                        selectedZone.id === zone.id 
                                            ? 'bg-white/5 border-white/20 scale-105' 
                                            : 'bg-[#0a0a0a] border-white/5 hover:border-white/10'
                                    }`}
                                >
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-[10px] font-bold text-gray-400 uppercase">{zone.label}</span>
                                        {zone.status === 'risk' ? (
                                            <AlertTriangle size={12} className="text-red-500"/>
                                        ) : zone.status === 'strain' ? (
                                            <AlertTriangle size={12} className="text-yellow-500"/>
                                        ) : (
                                            <ShieldCheck size={12} className="text-green-500"/>
                                        )}
                                    </div>
                                    <div className="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden">
                                        <div 
                                            className={`h-full transition-all duration-500 ${
                                                zone.status === 'risk' ? 'bg-red-500' : 
                                                zone.status === 'strain' ? 'bg-yellow-500' : 'bg-green-500'
                                            }`} 
                                            style={{width: zone.status === 'optimal' ? '100%' : zone.status === 'strain' ? '60%' : '30%'}}
                                        ></div>
                                    </div>
                                    <div className="mt-2 text-right text-[8px] font-mono uppercase" style={{color: getStatusColor(zone.status)}}>
                                        {zone.status}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        {/* Status Legend */}
                        <div className="flex justify-center gap-4 text-[9px] font-mono">
                            <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-green-500"></div> OPTIMAL</div>
                            <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-yellow-500"></div> STRAIN</div>
                            <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-red-500"></div> RISK</div>
                        </div>

                    </div>
                </div>
            );
        };

        // MORPHO TIMELINE (Evolution Tracker - Before/After)
        const MorphoTimeline = () => {
            const [scanPos, setScanPos] = useState(50);
            const [isDragging, setIsDragging] = useState(false);
            
            // Get weight history from localStorage
            const getWeightData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const xp = parseInt(localStorage.getItem('hybrid_xp') || '0');
                
                // Calculate estimated metrics based on volume history
                const totalVolume = history.reduce((sum, w) => {
                    const sets = w.sets || [];
                    return sum + sets.reduce((v, s) => v + (s.weight || 0) * (s.reps || 0), 0);
                }, 0);
                
                // Simulated progress based on total volume (1kg per 50000kg volume)
                const massGain = Math.min(5, (totalVolume / 50000) * 1).toFixed(1);
                const fatLoss = Math.min(3, (totalVolume / 100000) * 1).toFixed(1);
                
                return {
                    currentMass: (72 + parseFloat(massGain)).toFixed(1),
                    massChange: `+${massGain}`,
                    currentBF: (16 - parseFloat(fatLoss)).toFixed(1),
                    bfChange: `-${fatLoss}`,
                    snapCount: Math.min(50, Math.floor(history.length / 2))
                };
            };
            
            const data = getWeightData();
            
            // Get current month
            const currentMonth = new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' }).toUpperCase();

            const handleDrag = (e) => {
                if (!isDragging) return;
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const pct = Math.max(10, Math.min(90, (x / rect.width) * 100));
                setScanPos(pct);
            };

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[500px] shadow-2xl">
                    
                    {/* HEADER */}
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-indigo-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <ScanFace className="text-indigo-500" size={18} />
                                MORPHO.TIME
                            </h2>
                            <p className="text-[10px] text-indigo-500/60 font-mono font-bold mt-1">EVOLUTION TRACKER</p>
                        </div>
                        <div className="flex items-center gap-2">
                            <button className="w-8 h-8 rounded border border-white/10 flex items-center justify-center hover:bg-white/5 transition-colors">
                                <ChevronLeft size={14} className="text-gray-400"/>
                            </button>
                            <span className="text-[10px] font-mono font-bold text-white">{currentMonth}</span>
                            <button className="w-8 h-8 rounded border border-white/10 flex items-center justify-center hover:bg-white/5 transition-colors">
                                <ChevronRight size={14} className="text-gray-400"/>
                            </button>
                        </div>
                    </div>

                    {/* BODY: THE SCANNER */}
                    <div 
                        className="flex-1 bg-[#010101] relative flex flex-col items-center justify-center overflow-hidden cursor-ew-resize"
                        onMouseDown={() => setIsDragging(true)}
                        onMouseUp={() => setIsDragging(false)}
                        onMouseLeave={() => setIsDragging(false)}
                        onMouseMove={handleDrag}
                    >
                        
                        {/* Silhouettes container */}
                        <div className="relative w-[250px] h-[300px] mt-4 select-none">
                            {/* "BEFORE" Wireframe Layer */}
                            <div className="absolute inset-0 opacity-30">
                                <svg viewBox="0 0 100 200" className="w-full h-full drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">
                                    <path d="M 30,40 Q 20,50 25,80 Q 20,120 30,180 L 70,180 Q 80,120 75,80 Q 80,50 70,40 Q 50,30 30,40" fill="none" stroke="#555" strokeWidth="1" strokeDasharray="2 2" />
                                    <circle cx="50" cy="25" r="12" fill="none" stroke="#555" strokeWidth="1" strokeDasharray="2 2" />
                                </svg>
                            </div>

                            {/* "AFTER" Hologram Layer (Masked by Slider) */}
                            <div className="absolute inset-0 overflow-hidden" style={{width: `${scanPos}%`}}>
                                <svg viewBox="0 0 100 200" className="w-[250px] h-[300px]">
                                    <defs>
                                        <filter id="glowMorph">
                                            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                            <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                        </filter>
                                    </defs>
                                    <path d="M 28,40 Q 15,50 22,80 Q 15,120 28,180 L 72,180 Q 85,120 78,80 Q 85,50 72,40 Q 50,28 28,40" fill="rgba(99, 102, 241, 0.2)" stroke="#6366f1" strokeWidth="2" filter="url(#glowMorph)" />
                                    <circle cx="50" cy="25" r="12" fill="rgba(99, 102, 241, 0.2)" stroke="#6366f1" strokeWidth="2" filter="url(#glowMorph)" />
                                    
                                    {/* Muscle Highlights */}
                                    <path d="M 30,50 Q 50,55 70,50" fill="none" stroke="#818cf8" strokeWidth="1" opacity="0.6" />
                                    <path d="M 40,50 L 40,80" fill="none" stroke="#818cf8" strokeWidth="1" opacity="0.4" />
                                    <path d="M 60,50 L 60,80" fill="none" stroke="#818cf8" strokeWidth="1" opacity="0.4" />
                                </svg>
                            </div>

                            {/* The Scanner Bar */}
                            <div 
                                className="absolute top-0 bottom-0 w-1 bg-white z-20 shadow-[0_0_20px_white] pointer-events-none"
                                style={{left: `${scanPos}%`}}
                            >
                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-indigo-500 rounded-full border-2 border-white flex items-center justify-center shadow-lg">
                                    <div className="w-1 h-3 border-l border-r border-white/50"></div>
                                </div>
                            </div>
                        </div>

                        {/* Metrics Overlay */}
                        <div className="absolute bottom-8 left-6">
                            <div className="text-[8px] font-mono text-gray-500 uppercase mb-1">Mass</div>
                            <div className="text-xl font-bold text-white">{data.currentMass}kg</div>
                            <div className="text-[9px] text-green-400">{data.massChange}kg</div>
                        </div>
                        <div className="absolute bottom-8 right-6 text-right">
                            <div className="text-[8px] font-mono text-gray-500 uppercase mb-1">Body Fat</div>
                            <div className="text-xl font-bold text-white">{data.currentBF}%</div>
                            <div className="text-[9px] text-green-400">{data.bfChange}%</div>
                        </div>

                    </div>

                    {/* FOOTER */}
                    <div className="bg-[#080808] border-t border-white/10 p-4 flex justify-between items-center">
                        <div className="flex items-center gap-2 text-[9px] text-gray-400 font-mono">
                            <History size={12}/> {data.snapCount} SNAPS RECORDED
                        </div>
                        <button className="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold uppercase rounded-lg transition-colors shadow-[0_0_15px_rgba(79,70,229,0.4)]">
                            <Camera size={14}/> ADD SCAN
                        </button>
                    </div>

                </div>
            );
        };

        // NEON BUTTON (Reusable Component)
        const NeonButton = ({ children, variant = 'primary', isLoading = false, className = '', ...props }) => {
            const baseStyles = "relative inline-flex items-center justify-center px-6 py-3 overflow-hidden font-mono font-bold text-white transition-all duration-300 rounded-lg group focus:outline-none focus:ring";
            const variants = {
                primary: "bg-cyan-600 hover:bg-cyan-500 focus:ring-cyan-400 shadow-[0_0_20px_rgba(8,145,178,0.5)] hover:shadow-[0_0_30px_rgba(8,145,178,0.7)]",
                secondary: "bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-slate-600"
            };
            return (
                <button className={`${baseStyles} ${variants[variant]} ${isLoading ? 'opacity-80 cursor-not-allowed' : ''} ${className}`} disabled={isLoading} {...props}>
                    <span className="flex items-center gap-2 relative z-10">
                        {isLoading ? <Loader2 className="animate-spin h-5 w-5" /> : <Sparkles className="h-5 w-5" />}
                        {children}
                    </span>
                    {variant === 'primary' && !isLoading && (
                        <span className="absolute inset-0 w-full h-full -mt-1 rounded-lg opacity-30 bg-gradient-to-b from-transparent via-transparent to-black"></span>
                    )}
                </button>
            );
        };

        // NUTRITION FUEL (Metabolic Supply Chain) - WITH BUBBLE ANIMATIONS
        const NutritionFuel = () => {
            useEffect(() => {
                if (!document.getElementById('nutrition-fuel-animations')) {
                    const style = document.createElement('style');
                    style.id = 'nutrition-fuel-animations';
                    style.textContent = `
                        @keyframes bubble-rise {
                            0% { bottom: -10px; opacity: 0; transform: scale(0.5); }
                            50% { opacity: 1; }
                            100% { bottom: 100%; opacity: 0; transform: scale(1.2); }
                        }
                        @keyframes surface-wave {
                            0%, 100% { transform: translateY(0px); }
                            50% { transform: translateY(-3px); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            const getNutritionData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const totalVolume = history.reduce((sum, w) => {
                    const sets = w.sets || [];
                    return sum + sets.reduce((v, s) => v + (s.weight || 0) * (s.reps || 0), 0);
                }, 0);
                const bonus = Math.min(40, Math.floor(totalVolume / 10000));
                return {
                    p: { current: 140 + bonus, target: 180, color: 'bg-cyan-500', label: 'PROTEIN' },
                    c: { current: 200 + bonus, target: 280, color: 'bg-fuchsia-500', label: 'CARBS' },
                    f: { current: 60 + Math.floor(bonus/2), target: 80, color: 'bg-yellow-500', label: 'LIPIDS' },
                    totalKcal: 2400 + (bonus * 10),
                    targetKcal: 2800
                };
            };
            const data = getNutritionData();

            const Tank = ({ value, max, color, label }) => {
                const pct = Math.min(100, (value/max)*100);
                return (
                    <div className="flex-1 flex flex-col items-center group relative">
                        <div className="flex-1 w-full bg-[#080808] border-2 border-white/10 rounded-xl relative overflow-hidden flex flex-col justify-end p-1 shadow-inner backdrop-blur-sm">
                            <div className={`w-full rounded-sm transition-all duration-1000 ${color} opacity-80 relative z-10`} style={{height: `${pct}%`}}>
                                {/* BUBBLES - 6 animated bubbles rising */}
                                {Array.from({length: 6}).map((_, i) => (
                                    <div key={i} 
                                         className="absolute w-1.5 h-1.5 bg-white/60 rounded-full"
                                         style={{
                                             left: `${10 + Math.random()*80}%`,
                                             animation: `bubble-rise ${2+Math.random()}s infinite linear`,
                                             animationDelay: `${Math.random()}s`
                                         }}
                                    ></div>
                                ))}
                                {/* Surface Wave */}
                                <div className="absolute top-0 left-0 w-full h-2 bg-white/30" style={{animation: 'surface-wave 2s ease-in-out infinite'}}></div>
                            </div>
                            <div className="absolute top-0 left-0 w-[30%] h-full bg-gradient-to-r from-white/5 to-transparent pointer-events-none z-20"></div>
                            <div className="absolute top-0 right-0 w-[20%] h-full bg-gradient-to-l from-white/5 to-transparent pointer-events-none z-20"></div>
                        </div>
                        <div className="mt-3 text-center w-full bg-[#111] py-1 rounded border border-white/5">
                            <div className="text-lg font-black text-white leading-none">{value}g</div>
                            <div className="text-[8px] font-mono text-gray-500 font-bold uppercase mt-0.5 tracking-wider">{label}</div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[450px] shadow-2xl">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-yellow-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Flame className="text-orange-500" size={18} />
                                FUEL.INJECTION
                            </h2>
                            <p className="text-[10px] text-orange-500/60 font-mono font-bold mt-1">METABOLIC SUPPLY CHAIN</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-orange-500/30 bg-orange-900/20 text-[10px] font-mono text-orange-400 animate-pulse">
                            PUMPING
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] p-8 flex flex-col justify-center">
                        <div className="flex justify-center gap-6 h-[240px] mb-8">
                            <Tank value={data.p.current} max={data.p.target} color={data.p.color} label={data.p.label} />
                            <Tank value={data.c.current} max={data.c.target} color={data.c.color} label={data.c.label} />
                            <Tank value={data.f.current} max={data.f.target} color={data.f.color} label={data.f.label} />
                        </div>

                        <div className="bg-[#0a0a0a] border border-white/5 rounded-xl p-4 relative overflow-hidden shadow-inner">
                            <div className="flex justify-between items-end mb-2 relative z-10">
                                <div className="flex items-center gap-2">
                                    <Zap size={14} className="text-orange-400"/>
                                    <span className="text-xs font-bold text-white">TOTAL INTAKE</span>
                                </div>
                                <div className="text-right">
                                    <span className="text-xl font-black text-white">{data.totalKcal}</span>
                                    <span className="text-[10px] text-gray-500 ml-1">/ {data.targetKcal} kcal</span>
                                </div>
                            </div>
                            <div className="h-3 w-full bg-gray-800 rounded-full overflow-hidden relative z-10 border border-white/5">
                                <div className="h-full bg-gradient-to-r from-orange-600 to-yellow-400 shadow-[0_0_15px_#f97316] relative overflow-hidden transition-all duration-1000" style={{width: `${Math.min(100, (data.totalKcal/data.targetKcal)*100)}%`}}>
                                    <div className="absolute inset-0 bg-white/20 animate-[shimmer_1s_infinite]"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // PILOT PROFILE (Operator License Card)
        const PilotProfile = () => {
            // Get user data from localStorage
            const getUserData = () => {
                const xp = parseInt(localStorage.getItem('hybrid_xp') || '0');
                const streak = parseInt(localStorage.getItem('hybrid_streak') || '0');
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                
                // Calculate level based on XP
                const level = Math.floor(xp / 1000) + 1;
                const xpInLevel = xp % 1000;
                const xpToNextLevel = 1000;
                
                // Calculate total volume lifted
                const totalVolume = history.reduce((sum, w) => {
                    const sets = w.sets || [];
                    return sum + sets.reduce((v, s) => v + (s.weight || 0) * (s.reps || 0), 0);
                }, 0);
                
                // Score average from summary
                const score = window.StatsData ? window.StatsData.getSummary().score : 0;
                
                // Rank based on XP
                const ranks = ['RECRUIT', 'OPERATOR', 'SPECIALIST', 'COMMANDO', 'ELITE', 'LEGEND', 'TITAN'];
                const rankThresholds = [0, 1000, 5000, 15000, 35000, 75000, 150000];
                let rank = 'RECRUIT';
                for (let i = rankThresholds.length - 1; i >= 0; i--) {
                    if (xp >= rankThresholds[i]) { rank = ranks[i]; break; }
                }
                
                return { level, xpInLevel, xpToNextLevel, streak, score: Math.round(score), totalVolume, rank, xp };
            };
            
            const data = getUserData();

            return (
                <div className="relative w-full max-w-md bg-gradient-to-br from-[#0a0a0a] to-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[300px] shadow-2xl group">
                    <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent pointer-events-none group-hover:translate-x-full transition-transform duration-1000"></div>

                    <div className="px-6 py-5 border-b border-white/10 flex justify-between items-start relative z-10">
                        <div>
                            <div className="text-[10px] text-gray-500 font-mono uppercase tracking-widest mb-1">OPERATOR LICENSE</div>
                            <h2 className="font-display font-black text-2xl text-white tracking-wide">PILOT</h2>
                            <div className="flex items-center gap-2 mt-2">
                                <div className="bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 px-2 py-0.5 rounded text-[10px] font-bold uppercase flex items-center gap-1">
                                    <Star size={10} className="fill-current"/> {data.rank}
                                </div>
                                <div className="text-[10px] text-gray-500 font-mono">XP: {data.xp}</div>
                            </div>
                        </div>
                        <div className="w-12 h-12 bg-white/5 rounded border border-white/10 flex items-center justify-center">
                            <QrCode size={24} className="text-white opacity-50"/>
                        </div>
                    </div>

                    <div className="flex-1 p-6 relative z-10">
                        <div className="flex items-center gap-6 mb-6">
                            <div className="flex-1">
                                <div className="flex justify-between items-end mb-1">
                                    <span className="text-xs font-bold text-white">LEVEL {data.level}</span>
                                    <span className="text-[10px] font-mono text-cyan-400">{data.xpInLevel} / {data.xpToNextLevel} XP</span>
                                </div>
                                <div className="h-2 w-full bg-black rounded-full overflow-hidden border border-white/10">
                                    <div className="h-full bg-gradient-to-r from-cyan-500 to-blue-600 transition-all duration-1000" style={{width: `${(data.xpInLevel/data.xpToNextLevel)*100}%`}}></div>
                                </div>
                            </div>
                            <div className="text-center">
                                <div className="w-12 h-12 rounded-full border-2 border-yellow-500 flex items-center justify-center bg-yellow-900/10 shadow-[0_0_15px_rgba(234,179,8,0.3)]">
                                    <Trophy size={20} className="text-yellow-400 fill-current"/>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-3">
                            <div className="bg-[#111] p-3 rounded-xl border border-white/5 text-center">
                                <div className="text-2xl font-black text-white">{data.streak}</div>
                                <div className="text-[8px] text-gray-500 font-bold uppercase mt-1">Day Streak</div>
                            </div>
                            <div className="bg-[#111] p-3 rounded-xl border border-white/5 text-center">
                                <div className="text-2xl font-black text-white">{data.score}</div>
                                <div className="text-[8px] text-gray-500 font-bold uppercase mt-1">Score Avg</div>
                            </div>
                            <div className="bg-[#111] p-3 rounded-xl border border-white/5 text-center">
                                <div className="text-2xl font-black text-white">{(data.totalVolume/1000).toFixed(0)}k</div>
                                <div className="text-[8px] text-gray-500 font-bold uppercase mt-1">Kg Lifted</div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-[#050505] p-3 text-center border-t border-white/10">
                        <div className="text-[9px] font-mono text-gray-600 uppercase tracking-[0.3em]">NEON FITNESS SYNDICATE</div>
                    </div>
                </div>
            );
        };

        // POWER METRICS (Strength Arsenal)
        const PowerMetrics = () => {
            const [selectedLift, setSelectedLift] = useState(null);
            const [animate, setAnimate] = useState(false);

            const getLiftsData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const totalVolume = history.reduce((sum, w) => {
                    const sets = w.sets || [];
                    return sum + sets.reduce((v, s) => v + (s.weight || 0) * (s.reps || 0), 0);
                }, 0);
                const baseLevel = Math.min(95, 50 + Math.floor(totalVolume / 5000));
                return [
                    { name: 'BENCH PRESS', oneRM: 100 + Math.floor(totalVolume / 10000), trend: '+2.5', level: baseLevel },
                    { name: 'SQUAT', oneRM: 130 + Math.floor(totalVolume / 8000), trend: '+5', level: Math.min(95, baseLevel + 8) },
                    { name: 'DEADLIFT', oneRM: 160 + Math.floor(totalVolume / 6000), trend: '+5', level: Math.min(95, baseLevel + 12) },
                ];
            };

            const lifts = getLiftsData();
            const activeLift = selectedLift || lifts[0];

            useEffect(() => {
                setAnimate(false);
                const timer = setTimeout(() => setAnimate(true), 50);
                return () => clearTimeout(timer);
            }, [activeLift]);

            return (
                <div className="relative w-full max-w-md bg-[#0a0a0a] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[450px] shadow-2xl group">
                    <div className="bg-[#0f0f0f] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-yellow-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Sword className="text-yellow-500" size={18} />
                                POWER.ARSENAL
                            </h2>
                            <p className="text-[10px] text-yellow-600 font-mono font-bold mt-1">STRENGTH METRICS</p>
                        </div>
                        <div className="flex items-center gap-1 bg-yellow-900/20 px-2 py-1 rounded border border-yellow-500/30">
                            <Trophy size={10} className="text-yellow-400" />
                            <span className="text-[10px] font-bold text-yellow-400">ELITE</span>
                        </div>
                    </div>

                    <div className="flex-1 bg-[#050505] p-6 flex flex-col gap-6 relative">
                        <div className="flex gap-2 bg-[#111] p-1 rounded-lg border border-white/5">
                            {lifts.map(lift => (
                                <button key={lift.name} onClick={() => setSelectedLift(lift)}
                                    className={`flex-1 py-2 rounded text-[9px] font-bold uppercase transition-all tracking-wider ${activeLift.name === lift.name ? 'bg-yellow-500 text-black shadow-[0_0_10px_#eab308]' : 'text-gray-500 hover:text-white'}`}>
                                    {lift.name.split(' ')[0]}
                                </button>
                            ))}
                        </div>

                        <div className="text-center py-6 relative border border-white/5 rounded-2xl bg-[#0a0a0a] overflow-hidden">
                            <div className="absolute inset-0 opacity-10 bg-[radial-gradient(#eab308_1px,transparent_1px)] [background-size:10px_10px]"></div>
                            <div className="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">
                                <Target size={160} className="text-yellow-500 animate-[spin_60s_linear_infinite]"/>
                            </div>
                            <div className="relative z-10">
                                <div className="text-[10px] text-gray-500 font-mono tracking-[0.2em] mb-2 uppercase">Projected Max</div>
                                <div className="text-7xl font-black text-white tracking-tighter drop-shadow-xl flex justify-center items-baseline">
                                    {activeLift.oneRM}<span className="text-xl text-gray-600 ml-1">kg</span>
                                </div>
                                <div className="inline-flex items-center gap-2 mt-4 px-3 py-1 bg-green-900/20 rounded border border-green-500/20">
                                    <TrendingUp size={12} className="text-green-400"/>
                                    <span className="text-xs font-bold text-green-400">{activeLift.trend} kg</span>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-2">
                            <div className="flex justify-between text-[9px] font-mono text-gray-500 uppercase">
                                <span>Power Level</span>
                                <span className="text-yellow-500">{activeLift.level}%</span>
                            </div>
                            <div className="flex gap-1 h-6 bg-[#111] p-1 rounded border border-white/5">
                                {Array.from({length: 20}).map((_, i) => (
                                    <div key={i} className={`flex-1 rounded-sm transition-all duration-500 ${i < (activeLift.level / 5) && animate ? 'bg-yellow-500 shadow-[0_0_5px_#eab308]' : 'bg-[#222]'}`}
                                        style={{ transitionDelay: `${i * 20}ms`, opacity: i < (activeLift.level / 5) ? 1 : 0.2 }}></div>
                                ))}
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-[#111] p-3 rounded border border-white/5 flex justify-between items-center">
                                <span className="text-[9px] text-gray-500 font-bold uppercase">Sets/Wk</span>
                                <span className="text-white font-bold">12</span>
                            </div>
                            <div className="bg-[#111] p-3 rounded border border-white/5 flex justify-between items-center">
                                <span className="text-[9px] text-gray-500 font-bold uppercase">Frequency</span>
                                <span className="text-white font-bold">2x</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // SEASON TRACK (Campaign Trajectory)
        const SeasonTrack = () => {
            const getCurrentPhase = () => {
                const week = parseInt(localStorage.getItem('hybrid_current_week') || '1');
                if (week <= 5) return 0;
                if (week <= 11) return 1;
                if (week <= 17) return 2;
                return 3;
            };
            const currentPhase = getCurrentPhase();
            const week = parseInt(localStorage.getItem('hybrid_current_week') || '1');

            const phases = [
                { id: 1, label: 'HYPERTROPHY', color: 'text-cyan-400', bar: 'bg-cyan-500', status: currentPhase > 0 ? 'done' : currentPhase === 0 ? 'active' : 'locked' },
                { id: 2, label: 'STRENGTH', color: 'text-fuchsia-400', bar: 'bg-fuchsia-500', status: currentPhase > 1 ? 'done' : currentPhase === 1 ? 'active' : 'locked' },
                { id: 3, label: 'PEAKING', color: 'text-yellow-400', bar: 'bg-yellow-500', status: currentPhase > 2 ? 'done' : currentPhase === 2 ? 'active' : 'locked' },
                { id: 4, label: 'DELOAD', color: 'text-green-400', bar: 'bg-green-500', status: currentPhase === 3 ? 'active' : 'locked' },
            ];

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[400px] shadow-2xl">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Calendar className="text-white" size={18} />
                                CAMPAIGN
                            </h2>
                            <p className="text-[10px] text-gray-500 font-mono font-bold mt-1">SEASON 2024 TRAJECTORY</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-white/20 text-[10px] font-black uppercase bg-white/5 text-white">
                            WEEK {week}
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] relative overflow-hidden flex flex-col items-center justify-center p-8">
                        <div className="relative w-full h-[300px] flex flex-col items-center gap-4">
                            <div className="absolute left-[24px] top-4 bottom-4 w-[2px] bg-gray-800 z-0"></div>
                            <div className="absolute left-[24px] top-4 w-[2px] bg-gradient-to-b from-cyan-500 to-fuchsia-500 z-0 shadow-[0_0_10px_#d946ef] transition-all duration-1000" style={{height: `${(currentPhase + 1) * 25}%`}}></div>

                            {phases.map((phase, i) => {
                                const isActive = phase.status === 'active';
                                const isDone = phase.status === 'done';
                                return (
                                    <div key={phase.id} className={`w-full flex items-center gap-4 z-10 transition-all duration-500 ${isActive ? 'scale-105 translate-x-2' : 'opacity-60'}`}>
                                        <div className={`w-12 h-12 rounded-full border-2 flex items-center justify-center bg-[#0a0a0a] ${isActive ? 'border-white shadow-[0_0_20px_rgba(255,255,255,0.3)]' : isDone ? 'border-gray-600' : 'border-gray-800'}`}>
                                            <div className={`text-lg font-black ${isDone ? 'text-gray-500' : isActive ? phase.color : 'text-gray-800'}`}>
                                                {isDone ? '✓' : i + 1}
                                            </div>
                                        </div>
                                        <div className={`flex-1 border p-3 rounded-xl backdrop-blur-sm ${isActive ? 'border-white/30 bg-white/5' : 'border-white/5 bg-transparent'}`}>
                                            <div className="flex justify-between items-center">
                                                <span className={`text-xs font-black tracking-widest ${phase.color}`}>{phase.label}</span>
                                                {isActive && <span className="text-[8px] font-mono text-white bg-white/20 px-1 rounded animate-pulse">CURRENT</span>}
                                            </div>
                                            <div className="mt-2 h-1 w-full bg-gray-800 rounded-full overflow-hidden">
                                                {isActive && <div className={`h-full ${phase.bar} w-[65%]`}></div>}
                                                {isDone && <div className="h-full bg-gray-600 w-full"></div>}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // SLEEP CYCLE (Neural Recharge)
        const SleepCycle = () => {
            const getSleepData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const sessions = history.length;
                const quality = Math.min(95, 70 + Math.floor(sessions / 2));
                return { quality, hours: 7.5, wakeTime: "06:30", latency: 12 };
            };
            const data = getSleepData();

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[450px] shadow-2xl">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-indigo-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Moon className="text-indigo-500" size={18} />
                                NEURAL.RECHARGE
                            </h2>
                            <p className="text-[10px] text-indigo-500/60 font-mono font-bold mt-1">CIRCADIAN RHYTHM</p>
                        </div>
                        <div className="flex items-center gap-1 px-2 py-1 rounded border border-indigo-500/30 text-[10px] font-black uppercase bg-indigo-500/10 text-indigo-400">
                            <Battery size={10} className="fill-current"/> {data.quality}%
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] relative flex flex-col items-center justify-center p-6">
                        <div className="relative w-64 h-64">
                            <div className="absolute inset-0 rounded-full border border-white/5"></div>
                            <svg className="absolute inset-0 w-full h-full rotate-[-90deg]" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#1a1a1a" strokeWidth="8" />
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#6366f1" strokeWidth="8" strokeDasharray="90 300" strokeDashoffset="-200" strokeLinecap="round" className="drop-shadow-[0_0_10px_rgba(99,102,241,0.5)]" />
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#4338ca" strokeWidth="8" strokeDasharray="30 300" strokeDashoffset="-230" strokeLinecap="round" />
                            </svg>

                            <div className="absolute inset-0 flex flex-col items-center justify-center">
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">Duration</div>
                                <div className="text-4xl font-black text-white tracking-tighter">{data.hours}<span className="text-lg text-gray-600">h</span></div>
                                <div className="text-xs text-indigo-400 font-bold mt-1 flex items-center gap-1">
                                    <Activity size={10}/> RESTORED
                                </div>
                            </div>

                            <div className="absolute inset-0 animate-[spin_60s_linear_infinite]">
                                <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-3">
                                    <div className="w-6 h-6 bg-[#020202] border border-indigo-500 rounded-full flex items-center justify-center shadow-[0_0_15px_#6366f1]">
                                        <Moon size={12} className="text-indigo-400"/>
                                    </div>
                                </div>
                                <div className="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-3">
                                    <div className="w-6 h-6 bg-[#020202] border border-yellow-500 rounded-full flex items-center justify-center">
                                        <Sun size={12} className="text-yellow-400"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-8 mt-8 w-full">
                            <div className="text-center">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1">Wake Up</div>
                                <div className="text-xl font-bold text-white flex items-center justify-center gap-2">
                                    <Clock size={14} className="text-yellow-500"/> {data.wakeTime}
                                </div>
                            </div>
                            <div className="text-center">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1">Latency</div>
                                <div className="text-xl font-bold text-white flex items-center justify-center gap-2">
                                    <Activity size={14} className="text-indigo-500"/> {data.latency}m
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // SYNERGY LINK (Indirect Stimulation) - WITH ANIMATED BEAMS
        const SynergyLink = () => {
            const [activeBeam, setActiveBeam] = useState(0);
            const [pulsePhase, setPulsePhase] = useState(0);
            
            useEffect(() => {
                if (!document.getElementById('synergy-link-animations')) {
                    const style = document.createElement('style');
                    style.id = 'synergy-link-animations';
                    style.textContent = `
                        @keyframes beam-pulse { 
                            0%, 100% { opacity: 0.3; transform: scaleX(0.8); } 
                            50% { opacity: 1; transform: scaleX(1); } 
                        }
                        @keyframes beam-flow {
                            0% { background-position: 100% 0; }
                            100% { background-position: -100% 0; }
                        }
                        @keyframes node-pulse {
                            0%, 100% { box-shadow: 0 0 10px rgba(20,184,166,0.3); }
                            50% { box-shadow: 0 0 25px rgba(20,184,166,0.6); }
                        }
                        @keyframes particle-flow {
                            0% { left: 0%; opacity: 0; }
                            20% { opacity: 1; }
                            80% { opacity: 1; }
                            100% { left: 100%; opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            useEffect(() => {
                const beamInterval = setInterval(() => setActiveBeam(b => (b + 1) % 3), 2000);
                const pulseInterval = setInterval(() => setPulsePhase(p => (p + 0.1) % (Math.PI * 2)), 50);
                return () => { clearInterval(beamInterval); clearInterval(pulseInterval); };
            }, []);
            
            const getMuscleStimulation = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const totalSets = history.reduce((sum, w) => sum + (w.sets?.length || 0), 0);
                const baseStim = Math.min(100, Math.floor(totalSets / 2));
                return [
                    { name: 'TRICEPS', pct: Math.min(100, baseStim + 15), angle: -60, color: '#06b6d4', position: 'top' },
                    { name: 'DELTS', pct: Math.min(100, baseStim - 10), angle: 60, color: '#8b5cf6', position: 'right' },
                    { name: 'CHEST', pct: Math.min(100, baseStim + 30), angle: 180, color: '#f43f5e', position: 'left' },
                ];
            };
            const muscles = getMuscleStimulation();

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[450px] shadow-2xl">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-teal-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Share2 className="text-teal-500" size={18} />
                                SYNERGY.NET
                            </h2>
                            <p className="text-[10px] text-teal-500/60 font-mono font-bold mt-1">INDIRECT STIMULATION</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-teal-500/30 text-[10px] font-black uppercase bg-teal-500/10 text-teal-400 animate-pulse">
                            LINKED
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] relative flex flex-col items-center justify-center p-6 overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(20,184,166,0.05)_0%,_transparent_70%)]"></div>
                        
                        <div className="relative w-[300px] h-[300px] flex items-center justify-center">
                            <div className="absolute z-20 flex flex-col items-center justify-center w-28 h-28 rounded-full bg-black border-4 border-teal-500" style={{animation: 'node-pulse 2s ease-in-out infinite'}}>
                                <span className="text-[9px] font-bold text-teal-400 uppercase tracking-widest mb-1">PRIMARY</span>
                                <span className="text-xl font-black text-white leading-none">BENCH</span>
                                <span className="text-[8px] text-gray-500 mt-1">PRESS</span>
                            </div>

                            <svg className="absolute inset-0 w-full h-full" viewBox="0 0 300 300">
                                <defs>
                                    {muscles.map((m, i) => (
                                        <linearGradient key={`beam-grad-${i}`} id={`beam-grad-${i}`} x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" stopColor="#14b8a6" stopOpacity="0.8"/>
                                            <stop offset="50%" stopColor={m.color} stopOpacity="1"/>
                                            <stop offset="100%" stopColor={m.color} stopOpacity="0.3"/>
                                        </linearGradient>
                                    ))}
                                </defs>
                                
                                {muscles.map((m, i) => {
                                    const cx = 150, cy = 150;
                                    const rad = (m.angle * Math.PI) / 180;
                                    const endX = cx + Math.cos(rad) * 110;
                                    const endY = cy + Math.sin(rad) * 110;
                                    const isActive = activeBeam === i;
                                    const pulseOpacity = 0.4 + Math.sin(pulsePhase + i) * 0.3;
                                    
                                    return (
                                        <g key={m.name}>
                                            <line x1={cx} y1={cy} x2={endX} y2={endY} 
                                                  stroke={`url(#beam-grad-${i})`}
                                                  strokeWidth={isActive ? 4 : 2}
                                                  strokeLinecap="round"
                                                  style={{ 
                                                      opacity: isActive ? 1 : pulseOpacity,
                                                      filter: isActive ? 'drop-shadow(0 0 8px rgba(20,184,166,0.8))' : 'none',
                                                      transition: 'all 0.3s'
                                                  }}
                                            />
                                            {isActive && (
                                                <circle cx={cx + Math.cos(rad) * (55 + Math.sin(pulsePhase * 3) * 40)} 
                                                        cy={cy + Math.sin(rad) * (55 + Math.sin(pulsePhase * 3) * 40)} 
                                                        r="4" 
                                                        fill="white" 
                                                        style={{filter: 'drop-shadow(0 0 6px white)'}}
                                                />
                                            )}
                                        </g>
                                    );
                                })}
                            </svg>

                            {muscles.map((m, i) => {
                                const rad = (m.angle * Math.PI) / 180;
                                const x = 50 + Math.cos(rad) * 42;
                                const y = 50 + Math.sin(rad) * 42;
                                const isActive = activeBeam === i;
                                
                                return (
                                    <div key={m.name} 
                                         className="absolute bg-[#0a0a0a] border-2 p-2 rounded-lg text-center min-w-[75px] transition-all duration-300"
                                         style={{
                                             left: `${x}%`, top: `${y}%`, 
                                             transform: 'translate(-50%, -50%)',
                                             borderColor: isActive ? m.color : 'rgba(20,184,166,0.3)',
                                             boxShadow: isActive ? `0 0 15px ${m.color}40` : 'none'
                                         }}>
                                        <div className="text-[9px] font-bold uppercase" style={{color: m.color}}>{m.name}</div>
                                        <div className="text-lg font-black text-white">{m.pct}%</div>
                                        <div className="h-1 w-full bg-gray-800 rounded mt-1 overflow-hidden">
                                            <div className="h-full rounded transition-all duration-500" style={{width: `${m.pct}%`, backgroundColor: m.color}}></div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        
                        <div className="mt-4 flex gap-3 text-[9px] font-mono text-gray-500">
                            <span className="flex items-center gap-1"><div className="w-1.5 h-1.5 rounded-full bg-teal-500 animate-pulse"></div> ACTIVE LINKS: {muscles.length}</span>
                            <span className="flex items-center gap-1"><Zap size={10} className="text-teal-400"/> SYNERGY: HIGH</span>
                        </div>
                    </div>
                </div>
            );
        };

        // TEMPORAL ENGINE (Chronos Gate) - ENHANCED WITH PROPER ANIMATIONS
        const TemporalEngine = () => {
            const [pulse, setPulse] = useState(0);
            const [waveData, setWaveData] = useState(() => Array.from({length: 32}, (_, i) => ({ offset: i * 0.3, amplitude: 0.5 + Math.random() * 0.5 })));
            const [clockAngle, setClockAngle] = useState(0);
            
            useEffect(() => {
                if (!document.getElementById('temporal-engine-animations')) {
                    const style = document.createElement('style');
                    style.id = 'temporal-engine-animations';
                    style.textContent = `
                        @keyframes clock-tick { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(6deg); } }
                        @keyframes gate-pulse { 0%, 100% { box-shadow: 0 0 20px rgba(168,85,247,0.3); } 50% { box-shadow: 0 0 50px rgba(168,85,247,0.6); } }
                        @keyframes wave-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.9; } }
                        @keyframes orbital-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                        @keyframes orbital-spin-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            useEffect(() => {
                const interval = setInterval(() => {
                    setPulse(p => (p + 0.08) % (Math.PI * 2));
                    setClockAngle(a => (a + 0.5) % 360);
                }, 50);
                return () => clearInterval(interval);
            }, []);

            const getTemporalData = () => {
                const history = JSON.parse(localStorage.getItem('neon_fit_workout_history') || '[]');
                const totalDuration = history.reduce((sum, w) => sum + (w.duration || 45), 0);
                const totalSets = history.reduce((sum, w) => sum + (w.sets?.length || 0), 0);
                const avgRest = totalSets > 0 ? Math.round(90 - (totalSets * 0.5)) : 90;
                const density = totalDuration > 300 ? 'PEAK' : totalDuration > 200 ? 'HIGH' : totalDuration > 100 ? 'MED' : 'LOW';
                const efficiency = Math.min(100, Math.round(totalDuration * 0.8));
                return { tut: Math.floor(totalDuration * 0.6), avgRest, density, efficiency, totalSessions: history.length };
            };
            const data = getTemporalData();

            return (
                <div className="relative w-full max-w-md bg-[#050005] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[520px] shadow-2xl group">
                    <div className="bg-[#0f050f] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-purple-900/5"></div>
                        <div>
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Clock className="text-purple-500" size={18} style={{animation: 'clock-tick 1s ease-in-out infinite'}} />
                                CHRONOS.GATE
                            </h2>
                            <p className="text-[10px] text-purple-500/60 font-mono font-bold mt-1">TEMPORAL EFFICIENCY</p>
                        </div>
                        <div className="px-2 py-1 rounded border border-purple-500/30 text-[10px] font-black uppercase bg-purple-500/10 text-purple-400 animate-pulse">
                            {data.density}
                        </div>
                    </div>

                    <div className="flex-1 bg-[#050005] relative flex flex-col items-center justify-center p-6 overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(168,85,247,0.08)_0%,_transparent_60%)]"></div>
                        
                        <div className="relative w-[260px] h-[260px] flex items-center justify-center">
                            <div className="absolute inset-0 rounded-full border-2 border-dashed border-purple-900/30" style={{animation: 'orbital-spin 25s linear infinite'}}></div>
                            <div className="absolute inset-3 rounded-full border-[3px] border-purple-500/15 border-t-purple-500/60" style={{animation: 'orbital-spin-reverse 12s linear infinite'}}></div>
                            <div className="absolute inset-6 rounded-full border border-cyan-500/20" style={{animation: 'orbital-spin 8s linear infinite'}}>
                                <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-cyan-400 rounded-full" style={{boxShadow: '0 0 12px #06b6d4, 0 0 25px #06b6d4'}}></div>
                                <div className="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-2 h-2 bg-purple-400 rounded-full" style={{boxShadow: '0 0 8px #a855f7'}}></div>
                            </div>
                            <div className="absolute inset-10 rounded-full border border-purple-500/10" style={{animation: 'orbital-spin-reverse 5s linear infinite'}}>
                                <div className="absolute right-0 top-1/2 translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-pink-400 rounded-full" style={{boxShadow: '0 0 8px #f472b6'}}></div>
                            </div>

                            <div className="absolute inset-14 rounded-full bg-[#12051a] border-2 border-purple-500/50 flex flex-col items-center justify-center z-10" style={{animation: 'gate-pulse 3s ease-in-out infinite'}}>
                                <div className="text-[8px] text-purple-300/60 font-mono uppercase mb-1 tracking-widest">TUT TOTAL</div>
                                <div className="text-4xl font-black text-white tracking-tighter leading-none">{data.tut}</div>
                                <div className="text-sm text-purple-400 font-bold">MINUTES</div>
                            </div>
                            
                            <svg className="absolute inset-0 w-full h-full" viewBox="0 0 260 260">
                                <line x1="130" y1="130" x2={130 + Math.cos((clockAngle - 90) * Math.PI / 180) * 80} y2={130 + Math.sin((clockAngle - 90) * Math.PI / 180) * 80} 
                                      stroke="rgba(168,85,247,0.3)" strokeWidth="1" strokeLinecap="round"/>
                            </svg>
                        </div>

                        <div className="w-full mt-5 relative z-10">
                            <div className="flex justify-between items-center mb-2 px-2">
                                <div className="flex items-center gap-2 text-[10px] font-bold text-gray-500 uppercase">
                                    <Waves size={12} className="text-purple-400"/> Circadian Waveform
                                </div>
                                <span className="text-[9px] text-green-400 bg-green-900/20 px-2 py-0.5 rounded border border-green-500/20 font-bold">SYNCED</span>
                            </div>
                            <div className="h-12 w-full bg-[#0a0508] rounded-xl border border-purple-500/10 relative overflow-hidden flex items-end px-1 gap-[2px]">
                                {waveData.map((w, i) => {
                                    const h = 25 + Math.sin(w.offset + pulse * 2) * w.amplitude * 30 + Math.sin(pulse * 3 + i * 0.2) * 10;
                                    const glowOpacity = 0.4 + Math.sin(pulse + i * 0.15) * 0.3;
                                    return (
                                        <div key={i} 
                                             className="flex-1 rounded-t-sm" 
                                             style={{ 
                                                 height: `${Math.max(10, h)}%`, 
                                                 background: `linear-gradient(to top, rgba(168,85,247,${glowOpacity}), rgba(168,85,247,${glowOpacity * 0.3}))`,
                                                 transition: 'height 0.1s ease-out'
                                             }}></div>
                                    );
                                })}
                                <div className="absolute inset-0 bg-gradient-to-t from-transparent via-transparent to-purple-500/10 pointer-events-none"></div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-[#0f050f] border-t border-white/10 p-4">
                        <div className="grid grid-cols-3 gap-3">
                            <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5">
                                <Hourglass size={16} className="text-cyan-400 mb-1"/>
                                <div className="text-lg font-black text-white leading-none">{data.avgRest}s</div>
                                <div className="text-[7px] text-gray-500 uppercase tracking-wider mt-0.5">REST</div>
                            </div>
                            <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5">
                                <Zap size={16} className="text-yellow-400 mb-1"/>
                                <div className="text-lg font-black text-white leading-none">{data.efficiency}%</div>
                                <div className="text-[7px] text-gray-500 uppercase tracking-wider mt-0.5">EFFICACY</div>
                            </div>
                            <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5">
                                <Activity size={16} className="text-purple-400 mb-1"/>
                                <div className="text-lg font-black text-white leading-none">{data.totalSessions}</div>
                                <div className="text-[7px] text-gray-500 uppercase tracking-wider mt-0.5">SESSIONS</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 1. NEON TRACKER V7 (Fighter HUD with Particles)
        const NeonTracker = ({ score, sessions, sets, status }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const [showInfo, setShowInfo] = useState(false);
            
            const animState = useRef({
                sessions: 0,
                sets: 0,
                score: 0,
                rotation: 0,
                pulse: 0,
            });

            const particles = useRef([]);

            // Stats Grid Data
            const statsGrid = [
                { label: 'HRV', value: '72ms', icon: Zap, color: 'cyan' },
                { label: 'KCAL', value: '3420', icon: Flame, color: 'orange' },
                { label: 'FOCUS', value: '94%', icon: Target, color: 'purple' },
                { label: 'LOAD', value: '68%', icon: TrendingUp, color: 'green' },
                { label: 'RANK', value: '#12', icon: Trophy, color: 'yellow' },
                { label: 'RECO', value: '88%', icon: Heart, color: 'blue' },
            ];

            // Initialize particles
            useEffect(() => {
                if (particles.current.length === 0) {
                    for(let i = 0; i < 40; i++) {
                        particles.current.push({
                            x: 0, y: 0,
                            r: Math.random() * 1.5,
                            speed: 0.005 + Math.random() * 0.01,
                            angle: Math.random() * Math.PI * 2,
                            dist: 0.4 + Math.random() * 0.5,
                        });
                    }
                }
            }, []);

            // Canvas render loop
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d', { alpha: true });
                if (!ctx) return;

                let animationId;

                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1;
                    const rect = containerRef.current.getBoundingClientRect();
                    const size = rect.width;

                    canvas.width = size * dpr;
                    canvas.height = size * dpr;
                    canvas.style.width = `${size}px`;
                    canvas.style.height = `${size}px`;
                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    ctx.scale(dpr, dpr);
                };

                window.addEventListener('resize', handleResize);
                setTimeout(handleResize, 0);

                const toRad = (deg) => (deg * Math.PI) / 180;

                const draw = () => {
                    if (!canvas) return;
                    
                    // Animation Physics
                    const lerp = (start, end, factor) => start + (end - start) * factor;
                    animState.current.sessions = lerp(animState.current.sessions, sessions.current / sessions.max, 0.05);
                    animState.current.sets = lerp(animState.current.sets, sets.current / sets.max, 0.05);
                    animState.current.score = lerp(animState.current.score, score / 100, 0.04);
                    
                    animState.current.rotation += 0.002;
                    animState.current.pulse = (Math.sin(Date.now() / 500) + 1) * 0.5;

                    const size = canvas.width / (window.devicePixelRatio || 1);
                    const cx = size / 2;
                    const cy = size / 2;
                    const r = size * 0.40;

                    ctx.clearRect(0, 0, size, size);
                    ctx.globalCompositeOperation = 'screen';

                    // 1. BACKGROUND GRID (Fighter Jet Style - Rotating ellipses)
                    ctx.save();
                    ctx.strokeStyle = 'rgba(217, 70, 239, 0.1)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for(let i = 0; i < 5; i++) {
                        const rot = (i * Math.PI/2.5) + animState.current.rotation;
                        ctx.ellipse(cx, cy, r*1.1, r*0.6, rot, 0, Math.PI * 2);
                    }
                    ctx.stroke();
                    ctx.restore();

                    // 2. RINGS (Fighter HUD Style with Gradients)
                    const drawFighterRing = (radius, width, progress, hueStart, hueEnd) => {
                        const startAngle = toRad(145);
                        const totalAngle = toRad(250);
                        const endAngle = startAngle + (totalAngle * progress);

                        ctx.save();
                        ctx.lineCap = 'round';
                        
                        // Gradient
                        const gradient = ctx.createLinearGradient(cx - radius, cy, cx + radius, cy);
                        gradient.addColorStop(0, `hsl(${hueStart}, 100%, 50%)`);
                        gradient.addColorStop(1, `hsl(${hueEnd}, 100%, 60%)`);

                        // Track background
                        ctx.beginPath();
                        ctx.arc(cx, cy, radius, startAngle, startAngle + totalAngle);
                        ctx.lineWidth = width;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                        ctx.stroke();
                        
                        // Glowing Stroke
                        ctx.shadowBlur = 20;
                        ctx.shadowColor = `hsl(${hueEnd}, 100%, 50%)`;
                        ctx.beginPath();
                        ctx.arc(cx, cy, radius, startAngle, endAngle);
                        ctx.lineWidth = width;
                        ctx.strokeStyle = gradient;
                        ctx.stroke();
                        
                        // Inner White Core (Tube effect)
                        ctx.shadowBlur = 5;
                        ctx.lineWidth = width * 0.3;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.stroke();

                        ctx.restore();
                    };

                    // Outer Ring (Deep Indigo/Violet) - FREQ
                    drawFighterRing(r * 1.0, size * 0.035, animState.current.sessions, 240, 260);
                    // Middle Ring (Hot Pink/Fuchsia) - VOL
                    drawFighterRing(r * 0.85, size * 0.035, animState.current.sets, 310, 340);
                    // Inner Ring (Gold/Amber) - Score
                    drawFighterRing(r * 0.70, size * 0.035, animState.current.score, 30, 50);

                    // 3. PARTICLES (Floating orbital dust)
                    ctx.save();
                    particles.current.forEach(p => {
                        p.angle += p.speed;
                        const xRadius = r * 0.8 * p.dist;
                        const yRadius = r * 0.8 * p.dist;
                        
                        const px = cx + Math.cos(p.angle) * xRadius;
                        const py = cy + Math.sin(p.angle) * yRadius;
                        
                        const scale = 0.5 + (Math.sin(p.angle * 2) + 1) * 0.5;
                        ctx.beginPath();
                        ctx.arc(px, py, p.r * scale, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 255, 255, ${scale * 0.8})`;
                        ctx.fill();
                    });
                    ctx.restore();

                    animationId = requestAnimationFrame(draw);
                };

                draw();
                return () => {
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(animationId);
                };
            }, [sessions, sets, score]);

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden shadow-2xl transition-all hover:border-white/20 group">
                    
                    {/* PART 1: VISUALIZER (FIGHTER HUD) */}
                    <div className="relative h-[440px] w-full bg-gradient-to-b from-[#050505] to-[#020202] border-b border-white/10">
                        
                        {/* Header Overlay */}
                        <div className="absolute top-0 left-0 w-full p-5 flex justify-between items-center z-20">
                            <div className="flex items-center gap-2">
                                <Crosshair className="text-cyan-400 animate-spin-slow" size={20} />
                                <h2 className="font-display font-bold text-white tracking-[0.2em] uppercase text-lg">FIGHTER.HUD</h2>
                            </div>
                            
                            {/* INFO BUTTON */}
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => setShowInfo(!showInfo)}
                                    className="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-cyan-400 hover:bg-white/10 transition-colors"
                                >
                                    {showInfo ? <X size={14} /> : <AlertCircle size={14} />}
                                </button>
                                <div className="px-3 py-1 border border-green-500/50 bg-green-500/10 text-green-400 text-[10px] font-black tracking-widest rounded uppercase animate-pulse flex items-center">
                                    READY
                                </div>
                            </div>
                        </div>
                        <div className="absolute top-12 left-5 z-20 flex items-center gap-2">
                            <div className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></div>
                            <span className="text-[10px] text-cyan-400 font-mono font-bold tracking-widest">LIVE TELEMETRY</span>
                        </div>

                        {/* Canvas Container */}
                        <div className="absolute inset-0 flex items-center justify-center pt-12" ref={containerRef}>
                            <canvas ref={canvasRef} className="w-full h-full relative z-10" style={{ mixBlendMode: 'screen' }} />
                        </div>

                        {/* Center Data (TARGET LOCKED) */}
                        <div className="absolute inset-0 flex items-center justify-center z-20 pointer-events-none pt-12">
                            <div className="flex flex-col items-center justify-center mt-4">
                                <div className="text-[10px] text-white font-black tracking-[0.4em] mb-1 uppercase drop-shadow-[0_0_5px_rgba(255,255,255,0.8)] animate-pulse">
                                    TARGET LOCKED
                                </div>
                                {/* BIG NUMBER (Gold/Yellow Gradient) */}
                                <div className="text-8xl font-display font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-100 to-yellow-500 drop-shadow-[0_0_25px_rgba(234,179,8,0.5)] tracking-tighter leading-none">
                                    {Math.round(score)}
                                </div>
                                <div className="h-1 w-16 bg-cyan-500 rounded-full mt-4 shadow-[0_0_10px_#06b6d4]"></div>
                            </div>
                        </div>

                        {/* Floating Badges */}
                        {/* Left Badge - FREQ (Deep Indigo/Violet) */}
                        <div className="absolute top-[55%] left-4 -translate-y-1/2 z-30">
                            <div className="bg-[#0f0a1a] border border-indigo-500/40 p-3 rounded-xl shadow-[0_0_20px_rgba(99,102,241,0.2)] flex flex-col items-center w-20 backdrop-blur-sm">
                                <div className="text-[9px] font-bold text-indigo-400 mb-1 flex items-center gap-1"><RefreshCw size={10}/> FREQ</div>
                                <div className="text-2xl font-display font-bold text-white leading-none">
                                    {sessions.current}<span className="text-[10px] text-gray-500 font-mono">/{sessions.max}</span>
                                </div>
                            </div>
                        </div>
                        {/* Right Badge - VOL (Hot Pink/Fuchsia) */}
                        <div className="absolute top-[55%] right-4 -translate-y-1/2 z-30">
                            <div className="bg-[#1a0b1a] border border-fuchsia-500/40 p-3 rounded-xl shadow-[0_0_20px_rgba(217,70,239,0.2)] flex flex-col items-center w-20 backdrop-blur-sm">
                                <div className="text-[9px] font-bold text-fuchsia-400 mb-1 flex items-center gap-1"><Layers size={10}/> VOL</div>
                                <div className="text-2xl font-display font-bold text-white leading-none">
                                    {sets.current}<span className="text-[10px] text-gray-500 font-mono">/{sets.max}</span>
                                </div>
                            </div>
                        </div>

                        {/* INFO OVERLAY (Shows on button click) */}
                        {showInfo && (
                            <div className="absolute inset-0 z-40 bg-black/80 backdrop-blur-md flex flex-col justify-center items-center p-8 text-center">
                                {/* Close button */}
                                <button 
                                    onClick={() => setShowInfo(false)}
                                    className="absolute top-5 right-5 w-10 h-10 rounded-full bg-white/10 border border-white/20 flex items-center justify-center text-white hover:bg-white/20 transition-colors"
                                >
                                    <X size={20} />
                                </button>
                                <h3 className="text-xl font-display font-bold text-white mb-6 tracking-widest border-b border-white/20 pb-2">LEGEND</h3>
                                
                                <div className="space-y-6 w-full">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.5)] flex items-center justify-center">
                                            <RefreshCw size={20} className="text-indigo-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-indigo-400 font-bold text-sm tracking-wider">FREQUENCY</div>
                                            <div className="text-[10px] text-gray-400">Séances / Objectif</div>
                                        </div>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-fuchsia-500 shadow-[0_0_15px_rgba(217,70,239,0.5)] flex items-center justify-center">
                                            <Layers size={20} className="text-fuchsia-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-fuchsia-400 font-bold text-sm tracking-wider">VOLUME</div>
                                            <div className="text-[10px] text-gray-400">Séries / Capacité</div>
                                        </div>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full border-4 border-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.5)] flex items-center justify-center">
                                            <Target size={20} className="text-yellow-400"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-yellow-400 font-bold text-sm tracking-wider">INTENSITY</div>
                                            <div className="text-[10px] text-gray-400">Score Global</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* PART 2: DATA GRID */}
                    <div className="bg-[#080808] p-5 border-t border-white/5 relative z-10">
                        {/* Grid 3x2 */}
                        <div className="grid grid-cols-3 gap-3 mb-6">
                            {statsGrid.map((stat, i) => (
                                <GridCard key={i} stat={stat} />
                            ))}
                        </div>

                        {/* XP BAR */}
                        <div className="relative pt-1">
                            <div className="flex justify-between items-end mb-2">
                                <span className="text-xs font-bold text-cyan-400 tracking-widest uppercase">XP LEVEL 24</span>
                                <span className="text-[10px] font-mono text-gray-500">1850 / 2500</span>
                            </div>
                            <div className="h-2 w-full bg-[#1a1a1a] rounded-full overflow-hidden border border-white/5">
                                <div className="h-full bg-gradient-to-r from-cyan-500 via-blue-600 to-purple-600 w-[75%] shadow-[0_0_15px_rgba(6,182,212,0.6)]"></div>
                            </div>
                        </div>
                    </div>

                </div>
            );
        };

        // Grid Card Component
        const GridCard = ({ stat }) => {
            const styles = {
                cyan:   { border: 'border-cyan-500/40', text: 'text-cyan-400', shadow: 'shadow-[0_0_15px_rgba(6,182,212,0.1)]' },
                orange: { border: 'border-orange-500/40', text: 'text-orange-400', shadow: 'shadow-[0_0_15px_rgba(249,115,22,0.1)]' },
                purple: { border: 'border-purple-500/40', text: 'text-purple-400', shadow: 'shadow-[0_0_15px_rgba(168,85,247,0.1)]' },
                green:  { border: 'border-green-500/40', text: 'text-green-400', shadow: 'shadow-[0_0_15px_rgba(34,197,94,0.1)]' },
                yellow: { border: 'border-yellow-500/40', text: 'text-yellow-400', shadow: 'shadow-[0_0_15px_rgba(234,179,8,0.1)]' },
                blue:   { border: 'border-blue-500/40', text: 'text-blue-400', shadow: 'shadow-[0_0_15px_rgba(59,130,246,0.1)]' },
            };
            
            const s = styles[stat.color];
            const IconComp = stat.icon;

            return (
                <div className={`flex flex-col items-center justify-center p-3 rounded-xl border bg-[#0a0a0a] transition-all hover:-translate-y-1 ${s.border} ${s.shadow}`}>
                    <div className={`mb-2 ${s.text} opacity-90`}><IconComp size={16} /></div>
                    <div className="text-xl font-display font-bold text-white leading-none mb-1">{stat.value}</div>
                    <div className={`text-[9px] font-black uppercase tracking-widest opacity-60 ${s.text}`}>{stat.label}</div>
                </div>
            );
        };

        const MiniStat = ({ icon, label, value, color }) => (
            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default h-24">
                <div className="text-gray-500 mb-1 opacity-80">{icon}</div>
                <div className="text-lg font-display font-bold text-white leading-none mb-1">{value}</div>
                <div className={`text-[9px] font-black uppercase tracking-widest ${color}`}>{label}</div>
            </div>
        );

        // 2. KINETIC RADAR (Weekly Progress with Animations)
        const WeeklyProgress = ({ weeksData = [], summary = null }) => {
            const [hoveredWeek, setHoveredWeek] = useState(null);
            const [animReady, setAnimReady] = useState(false);
            const [rpeDisplay, setRpeDisplay] = useState(0);
            const radarRef = useRef(null);
            const pathRef = useRef(null);
            const requestRef = useRef(0);
            const rotationRef = useRef(0);
            
            const WEEKS = weeksData.length > 0 ? weeksData : getWeeksData();
            const currentWeekData = WEEKS.find(w => w.status === 'current') || WEEKS[WEEKS.length - 1] || { volume: 0 };
            const currentWeekIndex = WEEKS.findIndex(w => w.status === 'current');
            const peakWeek = WEEKS.reduce((max, w, i) => w.volume > max.volume ? { ...w, index: i } : max, { volume: 0, index: 0 });
            
            const avgRpe = 7.5 + (Math.random() * 1.5);
            const effReps = Math.round(WEEKS.reduce((sum, w) => sum + (w.volume / 150), 0));
            const fatigue = Math.min(95, Math.round(50 + (currentWeekIndex / WEEKS.length) * 40));
            
            const weekColors = ['#22d3ee', '#d946ef', '#f97316', '#ef4444'];
            
            useEffect(() => {
                if (!document.getElementById('kinetic-radar-animations')) {
                    const style = document.createElement('style');
                    style.id = 'kinetic-radar-animations';
                    style.textContent = `
                        @keyframes radar-pulse { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.02); } }
                        @keyframes radar-sweep { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                        @keyframes node-pulse { 0%, 100% { box-shadow: 0 0 10px currentColor, 0 0 20px currentColor; } 50% { box-shadow: 0 0 20px currentColor, 0 0 40px currentColor; } }
                        @keyframes path-draw { from { stroke-dashoffset: 400; } to { stroke-dashoffset: 0; } }
                        @keyframes glow-breathe { 0%, 100% { filter: blur(60px) brightness(0.8); } 50% { filter: blur(80px) brightness(1.2); } }
                    `;
                    document.head.appendChild(style);
                }
                setTimeout(() => setAnimReady(true), 100);
                
                let current = 0;
                const target = avgRpe;
                const interval = setInterval(() => {
                    current += (target - current) * 0.1;
                    if (Math.abs(target - current) < 0.01) { current = target; clearInterval(interval); }
                    setRpeDisplay(current);
                }, 50);
                return () => clearInterval(interval);
            }, []);
            
            const center = 160;
            const radius = 120;
            const weekPositions = WEEKS.map((w, i) => {
                const angle = (-90 + (i * 90)) * (Math.PI / 180);
                const dist = radius * (0.5 + (w.volume / (peakWeek.volume || 1)) * 0.5);
                return {
                    x: center + Math.cos(angle) * dist,
                    y: center + Math.sin(angle) * dist
                };
            });
            
            const pathData = weekPositions.length > 0 
                ? `M ${weekPositions[0].x},${weekPositions[0].y} ` + weekPositions.slice(1).map(p => `L ${p.x},${p.y}`).join(' ')
                : '';
            
            return (
                <div className="relative w-full max-w-md bg-[#050505] border border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-fuchsia-500/30 shadow-2xl z-20 overflow-hidden group">
                    <div className="bg-[#0a0a0a] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(45deg,transparent_25%,rgba(217,70,239,0.03)_50%,transparent_75%)] bg-[length:250%_250%] animate-[shimmer_3s_infinite]"></div>
                        <div className="flex items-center gap-2 relative z-10">
                            <Target className="text-fuchsia-400" size={18} />
                            <h2 className="font-display font-bold text-white tracking-widest uppercase text-lg">KINETIC.RADAR</h2>
                        </div>
                        <div className="relative z-10 flex items-center gap-2">
                            <div className="w-2 h-2 rounded-full bg-fuchsia-500 animate-pulse"></div>
                            <span className="text-[10px] font-mono text-fuchsia-400 uppercase tracking-wider">HYPERTROPHY TRACKING ACTIVE</span>
                        </div>
                    </div>
                    
                    <div className="relative bg-[#020202] flex items-center justify-center p-6 h-[380px] overflow-hidden">
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[250px] h-[250px] rounded-full bg-fuchsia-600/10 animate-[glow-breathe_4s_ease-in-out_infinite]"></div>
                        
                        <svg viewBox="0 0 320 320" className="w-full h-full max-w-[320px] z-10">
                            <defs>
                                <filter id="radarGlow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                                <linearGradient id="pathGradKinetic" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stopColor="#22d3ee" /><stop offset="50%" stopColor="#d946ef" /><stop offset="100%" stopColor="#f97316" />
                                </linearGradient>
                            </defs>
                            
                            {[0.3, 0.5, 0.7, 0.9, 1].map((scale, i) => (
                                <circle key={i} cx={center} cy={center} r={radius * scale} fill="none" stroke={i === 4 ? '#d946ef' : 'rgba(255,255,255,0.05)'} strokeWidth={i === 4 ? 1.5 : 0.5} strokeDasharray={i === 4 ? 'none' : '2 4'} opacity={i === 4 ? 0.4 : 0.3} className={i === 4 ? 'animate-[radar-pulse_3s_ease-in-out_infinite]' : ''} />
                            ))}
                            
                            {[0, 45, 90, 135].map((angle) => (
                                <line key={angle} x1={center} y1={center} x2={center + Math.cos(angle * Math.PI / 180) * radius} y2={center + Math.sin(angle * Math.PI / 180) * radius} stroke="rgba(255,255,255,0.05)" strokeWidth="0.5" />
                            ))}
                            
                            {animReady && pathData && (
                                <>
                                    <path d={pathData} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                    <path d={pathData} fill="none" stroke="url(#pathGradKinetic)" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" filter="url(#radarGlow)" strokeDasharray="400" className="animate-[path-draw_2s_ease-out_forwards]" />
                                </>
                            )}
                            
                            {weekPositions.map((pos, i) => {
                                const isCurrent = WEEKS[i]?.status === 'current';
                                const isPeak = i === peakWeek.index;
                                const color = weekColors[i % weekColors.length];
                                const nodeSize = isPeak ? 14 : isCurrent ? 12 : 10;
                                return (
                                    <g key={i} onMouseEnter={() => setHoveredWeek(i)} onMouseLeave={() => setHoveredWeek(null)} style={{ cursor: 'pointer' }}>
                                        {(isCurrent || isPeak) && (
                                            <circle cx={pos.x} cy={pos.y} r={nodeSize + 6} fill="none" stroke={color} strokeWidth="1" opacity="0.3" className="animate-[radar-pulse_2s_ease-in-out_infinite]" />
                                        )}
                                        <circle cx={pos.x} cy={pos.y} r={nodeSize / 2} fill="none" stroke={color} strokeWidth={isPeak ? 3 : 2} filter="url(#radarGlow)" className={isCurrent || isPeak ? 'animate-[node-pulse_2s_ease-in-out_infinite]' : ''} style={{ color }} />
                                        {isPeak && <circle cx={pos.x} cy={pos.y} r={nodeSize / 2 - 3} fill={color} opacity="0.8" />}
                                    </g>
                                );
                            })}
                            
                            <foreignObject x={center - 50} y={center - 40} width="100" height="80">
                                <div className="flex flex-col items-center justify-center h-full text-center">
                                    <div className="text-[9px] font-mono text-gray-500 uppercase tracking-[0.15em] mb-1">RPE AVG</div>
                                    <div className="text-4xl font-black text-fuchsia-400 leading-none drop-shadow-[0_0_10px_rgba(217,70,239,0.5)]">{rpeDisplay.toFixed(1)}</div>
                                </div>
                            </foreignObject>
                        </svg>
                    </div>
                    
                    <div className="bg-[#0a0a0a] border-t border-white/10 px-6 py-4">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center gap-3">
                                <div className="w-1 h-10 bg-gradient-to-b from-fuchsia-500 to-fuchsia-700 rounded-full"></div>
                                <div>
                                    <div className="text-xl font-black text-white">SEM {currentWeekIndex + 1}</div>
                                    <div className="text-[10px] font-mono text-fuchsia-400 uppercase">PEAK LOAD</div>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-black text-white">{(currentWeekData.volume / 1000).toFixed(1)}<span className="text-sm text-gray-500">k</span></div>
                                <div className="text-[10px] font-mono text-gray-500 uppercase">VOLUME</div>
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-3 gap-3">
                            <div className="bg-[#111] rounded-xl p-3 border border-white/5 flex flex-col items-center hover:border-cyan-500/30 transition-all">
                                <div className="flex items-center gap-1 text-gray-400 mb-1"><RotateCcw size={12} /><span className="text-[9px] uppercase font-bold">RPE AVG</span></div>
                                <div className="text-lg font-black text-white">{avgRpe.toFixed(1)}<span className="text-[10px] text-gray-500">/10</span></div>
                            </div>
                            <div className="bg-[#111] rounded-xl p-3 border border-white/5 flex flex-col items-center hover:border-fuchsia-500/30 transition-all">
                                <div className="flex items-center gap-1 text-gray-400 mb-1"><Dumbbell size={12} /><span className="text-[9px] uppercase font-bold">EFF. REPS</span></div>
                                <div className="text-lg font-black text-white">{effReps}<span className="text-[10px] text-gray-500"> Total</span></div>
                            </div>
                            <div className="bg-[#111] rounded-xl p-3 border border-white/5 flex flex-col items-center hover:border-orange-500/30 transition-all">
                                <div className="flex items-center gap-1 text-gray-400 mb-1"><Activity size={12} /><span className="text-[9px] uppercase font-bold">FATIGUE</span></div>
                                <div className="text-lg font-black text-white">{fatigue}<span className="text-[10px] text-gray-500">%</span></div>
                                <div className="text-[8px] text-orange-400 font-mono">Systemic</div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-[#050505] border-t border-white/5 py-2 text-center">
                        <span className="text-[9px] font-mono text-gray-600 tracking-widest">// NEONFIT SYSTEM V1.0 //</span>
                    </div>
                </div>
            );
        };

        // 3. ACTIVITY CHART (7 jours) - ENHANCED WITH ANIMATIONS
        const getDailyActivityData = () => window.StatsData ? window.StatsData.getDailyActivity() : [
            { day: 'Lun', volume: 0, sets: 0, active: false },
            { day: 'Mar', volume: 0, sets: 0, active: false },
            { day: 'Mer', volume: 0, sets: 0, active: false },
            { day: 'Jeu', volume: 0, sets: 0, active: false },
            { day: 'Ven', volume: 0, sets: 0, active: false },
            { day: 'Sam', volume: 0, sets: 0, active: false },
            { day: 'Dim', volume: 0, sets: 0, active: false }
        ];

        const ActivityChart = () => {
            const [data, setData] = useState(getDailyActivityData());
            const [hoveredDay, setHoveredDay] = useState(null);
            const [animatedHeights, setAnimatedHeights] = useState([0, 0, 0, 0, 0, 0, 0]);
            const [pulse, setPulse] = useState(0);
            
            useEffect(() => {
                if (!document.getElementById('activity-chart-animations')) {
                    const style = document.createElement('style');
                    style.id = 'activity-chart-animations';
                    style.textContent = `
                        @keyframes bar-rise { from { transform: scaleY(0); } to { transform: scaleY(1); } }
                        @keyframes bar-glow { 0%, 100% { filter: drop-shadow(0 0 4px rgba(34,211,238,0.5)); } 50% { filter: drop-shadow(0 0 10px rgba(34,211,238,0.9)); } }
                        @keyframes spark { 0% { opacity: 0; transform: translateY(0) scale(0); } 50% { opacity: 1; transform: translateY(-10px) scale(1); } 100% { opacity: 0; transform: translateY(-20px) scale(0); } }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            useEffect(() => {
                const refresh = () => setData(getDailyActivityData());
                refresh();
                const interval = setInterval(refresh, 5000);
                return () => clearInterval(interval);
            }, []);
            
            useEffect(() => {
                const pulseInterval = setInterval(() => setPulse(p => (p + 0.05) % (Math.PI * 2)), 50);
                return () => clearInterval(pulseInterval);
            }, []);
            
            useEffect(() => {
                const maxVol = Math.max(...data.map(d => d.volume), 1);
                const targetHeights = data.map(d => maxVol > 0 ? (d.volume / maxVol) * 70 : 0);
                
                let frame = 0;
                const animateBars = () => {
                    frame += 0.03;
                    if (frame >= 1) {
                        setAnimatedHeights(targetHeights);
                    } else {
                        const eased = 1 - Math.pow(1 - frame, 3);
                        setAnimatedHeights(targetHeights.map((h, i) => h * Math.min(1, eased + i * 0.05)));
                        requestAnimationFrame(animateBars);
                    }
                };
                animateBars();
            }, [data]);

            const maxVolume = Math.max(...data.map(d => d.volume), 1);
            const totalVolume = data.reduce((s, d) => s + d.volume, 0);
            const activeDays = data.filter(d => d.active).length;
            const todayIndex = new Date().getDay();
            const todayAdjusted = todayIndex === 0 ? 6 : todayIndex - 1;

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group min-h-[380px]">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div>
                            <h3 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase">
                                <Activity size={18} className="text-cyan-400" style={{animation: 'bar-glow 2s ease-in-out infinite'}} />
                                ACTIVITÉ 7J
                            </h3>
                            <p className="text-[10px] text-gray-400 font-mono font-bold mt-1">VOLUME QUOTIDIEN</p>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border border-cyan-500/50 text-cyan-500 bg-cyan-500/10 animate-pulse">
                                {activeDays}/7 JOURS
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 bg-[#020202] p-6 relative overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none"></div>
                        <div className="absolute inset-0 bg-gradient-to-t from-cyan-900/5 to-transparent pointer-events-none"></div>
                        
                        <svg className="w-full h-44 overflow-visible relative z-10" viewBox="0 0 280 110" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="activityGradNew" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stopColor="#22d3ee" stopOpacity="0.9"/>
                                    <stop offset="50%" stopColor="#22d3ee" stopOpacity="0.5"/>
                                    <stop offset="100%" stopColor="#22d3ee" stopOpacity="0.1"/>
                                </linearGradient>
                                <linearGradient id="todayGrad" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stopColor="#f59e0b" stopOpacity="0.9"/>
                                    <stop offset="100%" stopColor="#f59e0b" stopOpacity="0.2"/>
                                </linearGradient>
                                <filter id="barGlowNew">
                                    <feGaussianBlur stdDeviation="3" result="blur"/>
                                    <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                </filter>
                            </defs>
                            
                            {[0.25, 0.5, 0.75, 1].map((pct, i) => (
                                <g key={i}>
                                    <line x1="0" y1={100 - pct * 80} x2="280" y2={100 - pct * 80} stroke="rgba(255,255,255,0.05)" strokeDasharray="4 4"/>
                                    <text x="276" y={100 - pct * 80 + 3} textAnchor="end" className="text-[6px] fill-gray-600">{Math.round(pct * 100)}%</text>
                                </g>
                            ))}

                            {data.map((d, i) => {
                                const barWidth = 28;
                                const gap = (280 - barWidth * 7) / 8;
                                const x = gap + i * (barWidth + gap);
                                const barHeight = animatedHeights[i];
                                const y = 95 - barHeight;
                                const isHovered = hoveredDay === i;
                                const isToday = i === todayAdjusted;
                                const glowIntensity = 0.6 + Math.sin(pulse + i * 0.5) * 0.4;
                                
                                return (
                                    <g key={i} 
                                       onMouseEnter={() => setHoveredDay(i)} 
                                       onMouseLeave={() => setHoveredDay(null)}
                                       className="cursor-pointer">
                                        <rect x={x} y={95} width={barWidth} height="3" rx="1.5" fill="rgba(255,255,255,0.1)"/>
                                        
                                        <rect x={x} y={y} width={barWidth} height={barHeight} rx="4"
                                              fill={isToday ? "url(#todayGrad)" : (d.active ? "url(#activityGradNew)" : "rgba(255,255,255,0.08)")}
                                              filter={d.active || isToday ? "url(#barGlowNew)" : ""}
                                              style={{ 
                                                  opacity: isHovered ? 1 : (d.active ? glowIntensity : 0.5),
                                                  transformOrigin: 'bottom',
                                                  transition: 'opacity 0.2s'
                                              }}/>
                                        
                                        {(d.active || isToday) && (
                                            <rect x={x} y={y} width={barWidth} height="3" rx="1.5"
                                                  fill={isToday ? "#f59e0b" : "#22d3ee"} 
                                                  style={{filter: `drop-shadow(0 0 6px ${isToday ? '#f59e0b' : '#22d3ee'})`}}/>
                                        )}
                                        
                                        {d.active && (
                                            <circle cx={x + barWidth/2} cy={y - 5} r={2 + Math.sin(pulse * 2 + i) * 1} 
                                                    fill="#22d3ee" style={{opacity: 0.5 + Math.sin(pulse * 3 + i) * 0.5}}/>
                                        )}
                                        
                                        <text x={x + barWidth/2} y="108" textAnchor="middle" 
                                              className={`text-[9px] font-black ${isToday ? 'fill-amber-400' : (d.active ? 'fill-cyan-400' : 'fill-gray-600')}`}>
                                            {d.day}
                                        </text>
                                        
                                        {isHovered && (
                                            <g className="animate-fadeIn">
                                                <rect x={x - 12} y={y - 28} width={barWidth + 24} height="24" rx="6" fill="#0a0a0a" stroke={isToday ? "#f59e0b" : "#22d3ee"} strokeWidth="1"/>
                                                <text x={x + barWidth/2} y={y - 18} textAnchor="middle" className="text-[7px] fill-gray-400 font-bold">VOL</text>
                                                <text x={x + barWidth/2} y={y - 9} textAnchor="middle" className="text-[10px] font-black fill-white">
                                                    {d.volume > 0 ? `${(d.volume/1000).toFixed(1)}k` : '—'}
                                                </text>
                                            </g>
                                        )}
                                    </g>
                                );
                            })}
                        </svg>
                    </div>

                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-3 divide-x divide-white/10">
                            <div className="p-3 flex flex-col items-center">
                                <span className="text-[9px] text-gray-500 font-black tracking-widest uppercase mb-1">VOLUME</span>
                                <span className="text-xl font-display font-black text-white">{(totalVolume/1000).toFixed(1)}<span className="text-xs text-cyan-500">k</span></span>
                            </div>
                            <div className="p-3 flex flex-col items-center">
                                <span className="text-[9px] text-gray-500 font-black tracking-widest uppercase mb-1">SÉRIES</span>
                                <span className="text-xl font-display font-black text-white">{data.reduce((s,d) => s + d.sets, 0)}</span>
                            </div>
                            <div className="p-3 flex flex-col items-center">
                                <span className="text-[9px] text-gray-500 font-black tracking-widest uppercase mb-1">STREAK</span>
                                <span className="text-xl font-display font-black text-amber-400">{activeDays}<span className="text-xs text-gray-500">j</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. VOLUME GAUGE
        const VolumeGauge = ({ volume, maxVolume = 25000, optimalMin = 15000, optimalMax = 22000, stats }) => {
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const currentValRef = useRef(0);
            const targetValRef = useRef(volume);
            useEffect(() => { targetValRef.current = volume; }, [volume]);
            useEffect(() => {
                const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d', { alpha: true }); if (!ctx) return;
                let animationId;
                const handleResize = () => {
                    if (!containerRef.current || !canvas) return;
                    const dpr = window.devicePixelRatio || 1; 
                    const rect = containerRef.current.getBoundingClientRect(); 
                    const size = Math.min(rect.width - 48, rect.height - 48, 350);
                    canvas.width = size * dpr; canvas.height = size * dpr; 
                    canvas.style.width = `${size}px`; canvas.style.height = `${size}px`; 
                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    ctx.scale(dpr, dpr);
                };
                window.addEventListener('resize', handleResize); setTimeout(handleResize, 100);
                const toRad = (deg) => (deg * Math.PI) / 180;
                const createCarbonPattern = () => {
                    const pCanvas = document.createElement('canvas'); pCanvas.width = 8; pCanvas.height = 8; const pCtx = pCanvas.getContext('2d');
                    if (pCtx) { pCtx.fillStyle = '#050505'; pCtx.fillRect(0, 0, 8, 8); pCtx.fillStyle = '#161616'; pCtx.beginPath(); pCtx.moveTo(0, 8); pCtx.lineTo(8, 0); pCtx.lineTo(8, 8); pCtx.fill(); }
                    return ctx.createPattern(pCanvas, 'repeat');
                };
                const draw = () => {
                    if (!canvas || !containerRef.current) return;
                    const diff = targetValRef.current - currentValRef.current;
                    if (Math.abs(diff) < 0.1) currentValRef.current = targetValRef.current; else currentValRef.current += diff * 0.08;
                    const size = canvas.width / (window.devicePixelRatio || 1); const cx = size / 2; const cy = size / 2; const r = size * 0.45;
                    const percent = Math.min(1, Math.max(0, currentValRef.current / maxVolume));
                    let themeColor = '#22d3ee';
                    const isOptimal = currentValRef.current >= optimalMin && currentValRef.current <= optimalMax;
                    const isOver = currentValRef.current > optimalMax;
                    if (isOptimal) themeColor = '#fbbf24'; else if (isOver) themeColor = '#ef4444';
                    
                    ctx.clearRect(0, 0, size, size);
                    ctx.save(); ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 30; ctx.shadowOffsetY = 10; ctx.beginPath(); ctx.arc(cx, cy, r * 1.05, 0, Math.PI * 2);
                    const bezelGrad = ctx.createLinearGradient(0, 0, size, size); bezelGrad.addColorStop(0, '#334155'); bezelGrad.addColorStop(0.5, '#0f172a'); bezelGrad.addColorStop(1, '#1e293b');
                    ctx.fillStyle = bezelGrad; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2); const pattern = createCarbonPattern(); if (pattern) ctx.fillStyle = pattern; ctx.fill();
                    const vignette = ctx.createRadialGradient(cx, cy, r * 0.6, cx, cy, r); vignette.addColorStop(0, 'rgba(0,0,0,0)'); vignette.addColorStop(1, 'rgba(0,0,0,0.9)'); ctx.fillStyle = vignette; ctx.fill(); ctx.restore();
                    
                    const startAng = toRad(135); const totalAng = toRad(270);
                    ctx.save();
                    const optStartPct = optimalMin / maxVolume; const optEndPct = optimalMax / maxVolume;
                    const optStartAng = startAng + (totalAng * optStartPct); const optEndAng = startAng + (totalAng * optEndPct);
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.85, optStartAng, optEndAng); ctx.lineWidth = r * 0.08; ctx.strokeStyle = 'rgba(251, 191, 36, 0.15)'; ctx.stroke();
                    ctx.beginPath(); ctx.arc(cx, cy, r * 0.92, optStartAng, optEndAng); ctx.lineWidth = 2; ctx.strokeStyle = '#fbbf24'; ctx.stroke(); ctx.restore();

                    ctx.save();
                    const tickCount = 50;
                    for (let i = 0; i <= tickCount; i++) {
                        const t = i / tickCount; const angle = startAng + (totalAng * t); const isMajor = i % 10 === 0; const isLit = t <= percent;
                        const outerRad = r * 0.82; const innerRad = outerRad - (isMajor ? r * 0.08 : r * 0.04);
                        const x1 = cx + Math.cos(angle) * innerRad; const y1 = cy + Math.sin(angle) * innerRad;
                        const x2 = cx + Math.cos(angle) * outerRad; const y2 = cy + Math.sin(angle) * outerRad;
                        ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
                        if (isLit) { ctx.strokeStyle = isMajor ? themeColor : 'rgba(255,255,255,0.5)'; ctx.lineWidth = isMajor ? 3 : 1; ctx.shadowColor = themeColor; ctx.shadowBlur = 10; } 
                        else { ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.shadowBlur = 0; }
                        ctx.stroke();
                        if (isMajor) {
                            const textRad = r * 0.65; const tx = cx + Math.cos(angle) * textRad; const ty = cy + Math.sin(angle) * textRad;
                            ctx.font = `bold ${Math.max(10, size * 0.04)}px "Orbitron", sans-serif`; ctx.fillStyle = isLit ? '#fff' : '#475569'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(`${Math.round((t * maxVolume) / 1000)}k`, tx, ty);
                        }
                    }
                    ctx.restore();

                    // LCD
                    ctx.save(); const lcdY = cy + r * 0.4; const lcdW = r * 0.6; const lcdH = r * 0.25;
                    ctx.fillStyle = '#000'; ctx.beginPath(); ctx.roundRect(cx - lcdW/2, lcdY - lcdH/2, lcdW, lcdH, 4); ctx.fill(); ctx.strokeStyle = '#334155'; ctx.lineWidth = 1; ctx.stroke();
                    ctx.font = `bold ${size * 0.08}px "Orbitron", monospace`; ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.shadowColor = themeColor; ctx.shadowBlur = 15;
                    ctx.fillText(`${Math.round(currentValRef.current).toLocaleString()}`, cx, lcdY);
                    ctx.font = `bold ${size * 0.03}px "Inter", sans-serif`; ctx.fillStyle = themeColor; ctx.shadowBlur = 0; ctx.fillText("TOTAL LOAD (KG)", cx, lcdY + size * 0.06); ctx.restore();

                    // Needle
                    ctx.save(); const needleAngle = startAng + (totalAng * percent); const needleLen = r * 0.85;
                    ctx.translate(cx, cy); ctx.rotate(needleAngle); ctx.shadowColor = themeColor; ctx.shadowBlur = 20;
                    ctx.beginPath(); ctx.moveTo(0, -4); ctx.lineTo(needleLen, 0); ctx.lineTo(0, 4); ctx.lineTo(-15, 0); ctx.fillStyle = '#fff'; ctx.fill();
                    ctx.beginPath(); ctx.moveTo(needleLen * 0.7, -2); ctx.lineTo(needleLen, 0); ctx.lineTo(needleLen * 0.7, 2); ctx.fillStyle = themeColor; ctx.fill(); ctx.restore();
                    ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, 6, 0, Math.PI * 2); ctx.fillStyle = '#cbd5e1'; ctx.fill(); ctx.beginPath(); ctx.arc(cx, cy, 2, 0, Math.PI * 2); ctx.fillStyle = '#0f172a'; ctx.fill(); ctx.restore();

                    animationId = requestAnimationFrame(draw);
                };
                draw();
                return () => { window.removeEventListener('resize', handleResize); cancelAnimationFrame(animationId); };
            }, [maxVolume, optimalMin, optimalMax]);

            const isOptimal = volume >= optimalMin && volume <= optimalMax;
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h3 className="font-display font-bold text-white tracking-widest flex items-center gap-2 uppercase"><TrendingUp size={18} className="text-cyan-400" />Volume Load</h3><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">WEEKLY ACCUMULATION</p></div>
                        <div className={`px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-wider border ${isOptimal ? 'border-amber-500/50 text-amber-500 bg-amber-500/10' : 'border-cyan-500/50 text-cyan-500 bg-cyan-500/10'}`}>{isOptimal ? 'OPTIMAL ZONE' : 'BUILDING'}</div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex justify-center items-center relative" ref={containerRef}>
                        <div className="absolute inset-0 bg-cyan-500/5 blur-3xl rounded-full transform scale-75 pointer-events-none"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] opacity-50 [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)] pointer-events-none"></div>
                        <canvas ref={canvasRef} className="relative z-10 w-full aspect-square max-w-[350px]" />
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-2 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Layers size={12} /> Total Sets</span><span className="text-2xl font-display font-black text-white">{stats.sets}</span></div>
                            <div className="p-4 flex flex-col items-center hover:bg-white/5 transition-colors cursor-default"><span className="text-[10px] text-gray-500 font-black tracking-widest uppercase mb-1 flex items-center gap-1"><Clock size={12} /> TUT (MIN)</span><span className="text-2xl font-display font-black text-white">{Math.floor(stats.tut / 60)}<span className="text-sm text-gray-500">:{String(stats.tut % 60).padStart(2, '0')}</span></span></div>
                        </div>
                    </div>
                    <div className={`py-1 text-center text-[8px] font-mono font-bold uppercase tracking-[0.2em] transition-colors duration-500 ${isOptimal ? 'bg-amber-500/20 text-amber-400' : 'bg-cyan-900/20 text-cyan-400'}`}>{isOptimal ? 'HYPERTROPHY RANGE ACTIVE' : 'ACCUMULATION PHASE'}</div>
                </div>
            );
        };

        // 4. MUSCLE HUD (Radar Chart)
        const MuscleHud = ({ musclesData }) => {
            const MUSCLES = musclesData && musclesData.length > 0 ? musclesData : getMusclesHUD();
            const [selectedMuscle, setSelectedMuscle] = useState(MUSCLES[0] || { id: '1', name: 'N/A', sets: 0, volume: 0, type: 'primary', normalized: 0, intensity: 0, recovery: 100 });
            const [hoveredMuscleId, setHoveredMuscleId] = useState(null);
            const [buildFactor, setBuildFactor] = useState(0);
            useEffect(() => { let start = 0; const animate = () => { start += 0.02; if (start >= 1) setBuildFactor(1); else { setBuildFactor(Math.pow(start, 0.5)); requestAnimationFrame(animate); } }; animate(); }, []);
            const size = 300; const center = size / 2; const radius = (size / 2) - 50; const angleStep = MUSCLES.length > 0 ? (Math.PI * 2) / MUSCLES.length : Math.PI * 2;
            const getCoordinates = (index, value) => { const angle = index * angleStep - Math.PI / 2; const r = radius * value * buildFactor; return { x: center + Math.cos(angle) * r, y: center + Math.sin(angle) * r, angle }; };
            const polygonPoints = useMemo(() => MUSCLES.map((m, i) => { const { x, y } = getCoordinates(i, m.normalized || 0); return `${x},${y}`; }).join(' '), [buildFactor, MUSCLES]);
            const getWebPoints = (factor) => MUSCLES.map((_, i) => { const angle = i * angleStep - Math.PI / 2; const r = radius * factor; return `${center + Math.cos(angle) * r},${center + Math.sin(angle) * r}`; }).join(' ');

            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="text-xl font-display font-black text-white tracking-widest uppercase flex items-center gap-2"><Cpu className="text-cyan-400" size={20} /> BIO-METRICS</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">VOLUME DISTRIBUTION ANALYSIS</p></div>
                        <div className="flex gap-2"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-gray-400 font-mono">{MUSCLES.length} ZONES</div></div>
                    </div>
                    <div className="relative flex-1 bg-[#020202] flex items-center justify-center p-6 group/chart">
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-cyan-900/10 via-transparent to-transparent opacity-60"></div>
                            <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)]"></div>
                            <div className="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/5 to-transparent h-[10px] w-full animate-scan pointer-events-none"></div>
                        </div>
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[400px] overflow-visible relative z-10">
                            <defs>
                                <linearGradient id="radarGradient" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#22d3ee" stopOpacity="0.6" /><stop offset="100%" stopColor="#8b5cf6" stopOpacity="0.1" /></linearGradient>
                                <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            {[0.25, 0.5, 0.75, 1].map((factor, i) => (<polygon key={`grid-${i}`} points={getWebPoints(factor)} fill="none" stroke={i === 3 ? "rgba(255,255,255,0.2)" : "rgba(255, 255, 255, 0.05)"} strokeWidth={i === 3 ? "1.5" : "1"} strokeDasharray={i !== 3 ? "4 4" : ""} />))}
                            {MUSCLES.map((_, i) => { const { x, y } = getCoordinates(i, 1); return (<line key={`axis-${i}`} x1={center} y1={center} x2={x} y2={y} stroke="rgba(255, 255, 255, 0.1)" strokeWidth="1" />); })}
                            <polygon points={polygonPoints} fill="url(#radarGradient)" stroke="#22d3ee" strokeWidth="3" filter="url(#glow)" className="drop-shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-300" strokeDasharray="1000" strokeDashoffset={1000 * (1 - buildFactor)} />
                            {MUSCLES.map((muscle, i) => {
                                const { x, y } = getCoordinates(i, muscle.normalized); const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                                return (
                                    <g key={`point-${i}`} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)} className="cursor-pointer">
                                        <circle cx={x} cy={y} r="20" fill="transparent" />
                                        <circle cx={x} cy={y} r={isHovered || isSelected ? 6 : 3} fill={muscle.type === 'primary' ? 'white' : '#94a3b8'} stroke={isSelected ? '#facc15' : '#22d3ee'} strokeWidth={isHovered || isSelected ? 3 : 2} className="transition-all duration-300" />
                                        {isSelected && (<circle cx={x} cy={y} r="12" fill="none" stroke="#facc15" strokeWidth="1" opacity="0.5"><animate attributeName="r" from="6" to="25" dur="1.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.8" to="0" dur="1.5s" repeatCount="indefinite" /></circle>)}
                                    </g>
                                );
                            })}
                        </svg>
                        {MUSCLES.map((muscle, i) => {
                            const angle = i * angleStep - Math.PI / 2; const labelRadius = radius + 35; const lx = center + Math.cos(angle) * labelRadius; const ly = center + Math.sin(angle) * labelRadius;
                            const leftPct = (lx / size) * 100; const topPct = (ly / size) * 100; const isPrimary = muscle.type === 'primary'; const isHovered = hoveredMuscleId === muscle.id; const isSelected = selectedMuscle.id === muscle.id;
                            return (
                                <div key={`label-${i}`} className={`absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 z-50 flex flex-col items-center group/label cursor-pointer`} style={{ left: `${leftPct}%`, top: `${topPct}%` }} onMouseEnter={() => setHoveredMuscleId(muscle.id)} onMouseLeave={() => setHoveredMuscleId(null)} onClick={() => setSelectedMuscle(muscle)}>
                                    <div className={`flex items-center gap-1.5 px-2 py-1 rounded border backdrop-blur-md transition-all duration-300 ${isSelected ? 'bg-yellow-500/10 border-yellow-500 text-yellow-400 scale-110 shadow-[0_0_15px_rgba(234,179,8,0.4)]' : isHovered ? 'bg-cyan-500/10 border-cyan-400 text-white scale-105' : isPrimary ? 'bg-black/80 border-white/20 text-gray-200' : 'bg-black/60 border-transparent text-gray-500 hover:text-gray-300'}`}>
                                        {isPrimary && <Zap size={10} className={isSelected ? 'text-yellow-400' : 'text-cyan-400'} fill={isSelected ? "currentColor" : "none"}/>}
                                        <span className="text-[10px] md:text-xs font-black tracking-wider whitespace-nowrap">{muscle.name}</span>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0">
                        <div className="grid grid-cols-3 divide-x divide-white/10">
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><Activity size={12} /> INTENSITÉ</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.intensity > 8 ? 'text-red-500' : 'text-white'}`}>{selectedMuscle.intensity}<span className="text-sm text-gray-600">/10</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center bg-white/5 relative overflow-hidden group"><div className="absolute inset-0 bg-cyan-500/5 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div><div className="text-xs text-cyan-400 font-black uppercase tracking-[0.2em] mb-1 relative z-10">{selectedMuscle.name}</div><div className="text-xl font-display font-black text-white relative z-10">{selectedMuscle.volume.toLocaleString()} <span className="text-sm font-sans text-gray-500 font-medium">KG</span></div></div>
                            <div className="p-4 flex flex-col items-center justify-center hover:bg-white/5 transition-colors cursor-default"><div className="text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1 flex items-center gap-1"><RefreshCw size={12} /> RECOVERY</div><div className={`text-2xl font-display font-black leading-none ${selectedMuscle.recovery < 50 ? 'text-orange-500' : 'text-emerald-500'}`}>{selectedMuscle.recovery}%</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. INTENSITY ZONES
        const IntensityZones = ({ zonesData }) => {
            const ZONES = zonesData && zonesData.length > 0 ? zonesData : getZones();
            const [active, setActive] = useState(false);
            const [selectedZone, setSelectedZone] = useState(null);
            useEffect(() => { const timer = setTimeout(() => setActive(true), 200); return () => clearTimeout(timer); }, []);
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group min-h-[400px]">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Battery className="text-cyan-400 -rotate-90" size={20} /> POWER DIST.</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">CAPACITEURS D'INTENSITÉ</p></div>
                        <div className="flex gap-2"><div className="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_10px_#22c55e]"></div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] p-6 flex flex-col justify-center gap-6 relative">
                        <div className="absolute right-0 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-white/10 to-transparent"></div>
                        {ZONES.map((zone) => {
                            const isSelected = selectedZone === zone.id;
                            return (
                                <div key={zone.id} className="relative group/bar cursor-pointer" onMouseEnter={() => setSelectedZone(zone.id)} onMouseLeave={() => setSelectedZone(null)}>
                                    <div className="flex justify-between items-end mb-2">
                                        <div className="flex items-center gap-2"><div className={`w-1.5 h-1.5 rounded-sm ${zone.color} ${zone.shadow} shadow-[0_0_8px_currentColor]`}></div><span className={`text-[10px] font-black uppercase tracking-widest transition-colors ${isSelected ? 'text-white' : 'text-gray-500'}`}>{zone.label}</span></div>
                                        <span className="text-[10px] font-mono text-gray-400">{zone.range}</span>
                                    </div>
                                    <div className="h-10 w-full bg-[#080808] border border-white/5 rounded flex p-1 relative overflow-hidden">
                                        <div className="absolute inset-0 bg-[linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:10px_100%]"></div>
                                        <div className={`h-full rounded-sm transition-all duration-1000 ease-out relative overflow-hidden flex items-center ${zone.color}`} style={{ width: active ? `${zone.percent}%` : '0%' }}>
                                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full -translate-x-full animate-[shimmer_2s_infinite]"></div>
                                            <div className="absolute inset-0 w-full h-full bg-[repeating-linear-gradient(90deg,transparent,transparent_4px,rgba(0,0,0,0.8)_4px,rgba(0,0,0,0.8)_5px)]"></div>
                                        </div>
                                        <div className="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2"><span className={`text-xl font-display font-black z-10 drop-shadow-md ${isSelected ? 'text-white' : 'text-gray-600'}`}>{zone.percent}%</span></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 h-16 relative">
                        <div className="absolute inset-0 flex items-center justify-between px-6">
                            {selectedZone ? (<><div className="flex flex-col animate-slideIn"><span className="text-[9px] text-gray-500 uppercase font-bold">Volume Sets</span><span className="text-xl font-display font-bold text-white">{ZONES.find(z => z.id === selectedZone)?.sets || 0} <span className="text-sm text-gray-600">SÉRIES</span></span></div><div className="flex items-center gap-1 text-cyan-400 animate-pulse"><Activity size={14} /><span className="text-[9px] font-bold">ANALYZING</span></div></>) : (<div className="w-full flex justify-center items-center text-[10px] text-gray-600 font-mono tracking-widest animate-pulse">// SYSTEM READY //</div>)}
                        </div>
                    </div>
                </div>
            );
        };

        // 6. MUSCLE WORKLOAD (Turbine) - PROPER CURVED BLADES
        const MuscleWorkload = ({ musclesTurbineData }) => {
            const MUSCLES_T = musclesTurbineData && musclesTurbineData.length > 0 ? musclesTurbineData : getMusclesTurbine();
            const [hoveredId, setHoveredId] = useState(null);
            const [rotation, setRotation] = useState(0);
            const [buildFactor, setBuildFactor] = useState(0);
            
            useEffect(() => {
                if (!document.getElementById('kinetic-load-animations')) {
                    const style = document.createElement('style');
                    style.id = 'kinetic-load-animations';
                    style.textContent = `
                        @keyframes turbine-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                        @keyframes blade-glow { 0%, 100% { filter: drop-shadow(0 0 4px currentColor); } 50% { filter: drop-shadow(0 0 12px currentColor); } }
                    `;
                    document.head.appendChild(style);
                }
            }, []);
            
            useEffect(() => { 
                let frame = 0; 
                const animate = () => { 
                    frame += 0.015; 
                    if (frame >= 1) setBuildFactor(1); 
                    else { setBuildFactor(1 - Math.pow(1 - frame, 3)); requestAnimationFrame(animate); } 
                }; 
                animate(); 
            }, []);
            
            useEffect(() => {
                if (hoveredId) return;
                const interval = setInterval(() => setRotation(r => (r + 0.5) % 360), 30);
                return () => clearInterval(interval);
            }, [hoveredId]);
            
            const size = 300; const cx = size / 2; const cy = size / 2; const innerRadius = 50; const maxRadius = (size / 2) - 15; 
            const maxVol = Math.max(...MUSCLES_T.map(m => m.volume), 1);
            const numBlades = MUSCLES_T.length || 6;
            
            const polarToCartesian = (radius, angleDeg) => {
                const rad = (angleDeg - 90) * Math.PI / 180;
                return { x: cx + radius * Math.cos(rad), y: cy + radius * Math.sin(rad) };
            };
            
            const describeCurvedBlade = (centerAngle, bladeLength, bladeWidth) => {
                const tipAngle = centerAngle;
                const leftAngle = centerAngle - bladeWidth / 2;
                const rightAngle = centerAngle + bladeWidth / 2;
                
                const innerLeft = polarToCartesian(innerRadius + 5, leftAngle);
                const innerRight = polarToCartesian(innerRadius + 5, rightAngle);
                const tip = polarToCartesian(innerRadius + bladeLength, tipAngle);
                
                const ctrlLeft = polarToCartesian(innerRadius + bladeLength * 0.6, leftAngle - 8);
                const ctrlRight = polarToCartesian(innerRadius + bladeLength * 0.6, rightAngle + 8);
                
                return `M ${innerLeft.x} ${innerLeft.y} Q ${ctrlLeft.x} ${ctrlLeft.y} ${tip.x} ${tip.y} Q ${ctrlRight.x} ${ctrlRight.y} ${innerRight.x} ${innerRight.y} A ${innerRadius + 5} ${innerRadius + 5} 0 0 0 ${innerLeft.x} ${innerLeft.y} Z`;
            };
            
            const activeMuscle = useMemo(() => MUSCLES_T.find(m => m.id === hoveredId) || (MUSCLES_T.length > 0 ? MUSCLES_T.reduce((prev, current) => (prev.volume > current.volume) ? prev : current) : { id: 'none', name: 'N/A', volume: 0, color: '#666' }), [hoveredId, MUSCLES_T]);
            
            return (
                <div className="relative w-full max-w-md bg-black border-[2px] border-white/10 rounded-3xl flex flex-col h-full min-h-[550px] transition-all duration-500 hover:border-white/20 hover:shadow-[0_0_50px_rgba(0,0,0,0.5)] z-20 overflow-hidden group">
                    <div className="bg-[#050505] px-6 py-5 border-b border-white/10 flex justify-between items-center z-10 shrink-0">
                        <div><h2 className="font-display font-black text-white tracking-widest flex items-center gap-2 uppercase"><Fan className="text-cyan-400 animate-spin" size={20} /> KINETIC LOAD</h2><p className="text-[10px] text-gray-400 font-mono font-bold mt-1">DISTRIBUTION DE PUISSANCE</p></div>
                        <div className="flex gap-1"><div className="px-2 py-1 bg-white/5 rounded border border-white/10 text-[10px] text-cyan-400 font-mono font-bold animate-pulse">LIVE</div></div>
                    </div>
                    <div className="flex-1 bg-[#020202] relative flex items-center justify-center p-4 overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-cyan-900/10 via-black to-black pointer-events-none"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[95%] h-[95%] border border-white/5 rounded-full opacity-20"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[75%] h-[75%] border border-cyan-500/10 rounded-full opacity-30 border-dashed" style={{animation: 'turbine-spin 30s linear infinite reverse'}}></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[55%] h-[55%] border border-purple-500/10 rounded-full opacity-20" style={{animation: 'turbine-spin 20s linear infinite'}}></div>
                        
                        <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full max-h-[380px] overflow-visible relative z-10">
                            <defs>
                                {MUSCLES_T.map(m => (
                                    <linearGradient key={m.id} id={`blade-grad-${m.id}`} x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stopColor={m.color} stopOpacity="0.9" />
                                        <stop offset="50%" stopColor={m.color} stopOpacity="0.7" />
                                        <stop offset="100%" stopColor={m.color} stopOpacity="0.4" />
                                    </linearGradient>
                                ))}
                                <filter id="blade-glow-filter"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            </defs>
                            
                            <g style={{ transform: `rotate(${rotation}deg)`, transformOrigin: 'center', transition: hoveredId ? 'transform 0.3s ease-out' : 'none' }}>
                                {MUSCLES_T.map((muscle, i) => {
                                    const anglePerBlade = 360 / numBlades;
                                    const centerAngle = i * anglePerBlade;
                                    const normalizedVol = muscle.volume / maxVol;
                                    const bladeLength = 30 + (normalizedVol * 70 * buildFactor);
                                    const bladeWidth = anglePerBlade * 0.7;
                                    const isHovered = hoveredId === muscle.id;
                                    
                                    return (
                                        <g key={muscle.id} 
                                           onMouseEnter={() => setHoveredId(muscle.id)} 
                                           onMouseLeave={() => setHoveredId(null)} 
                                           className="cursor-pointer"
                                           style={{ opacity: hoveredId && !isHovered ? 0.4 : 1, transition: 'opacity 0.3s' }}>
                                            <path 
                                                d={describeCurvedBlade(centerAngle, bladeLength, bladeWidth)} 
                                                fill={`url(#blade-grad-${muscle.id})`} 
                                                stroke={isHovered ? 'white' : muscle.color}
                                                strokeWidth={isHovered ? 2 : 0.5}
                                                filter={isHovered ? "url(#blade-glow-filter)" : undefined}
                                                style={{ 
                                                    transform: isHovered ? 'scale(1.08)' : 'scale(1)', 
                                                    transformOrigin: 'center',
                                                    transition: 'transform 0.3s, stroke-width 0.3s'
                                                }} 
                                            />
                                        </g>
                                    );
                                })}
                            </g>
                            
                            <circle cx={cx} cy={cy} r={innerRadius} fill="#0a0a0a" stroke="#222" strokeWidth="3" />
                            <circle cx={cx} cy={cy} r={innerRadius - 8} fill="none" stroke={activeMuscle.color} strokeWidth="2" strokeDasharray="6 3" style={{animation: 'turbine-spin 4s linear infinite', transformOrigin: 'center'}}/>
                            <circle cx={cx} cy={cy} r={innerRadius - 15} fill="#050505" stroke="#333" strokeWidth="1" />
                            
                            <foreignObject x={cx - innerRadius + 10} y={cy - 18} width={(innerRadius - 10) * 2} height={36}>
                                <div className="w-full h-full flex flex-col items-center justify-center text-center">
                                    <div className="text-[8px] font-mono text-gray-500 tracking-widest">TARGET</div>
                                    <div className="text-sm font-black text-white leading-none uppercase tracking-wide">{activeMuscle.name.substring(0, 5)}</div>
                                </div>
                            </foreignObject>
                        </svg>
                        
                        <div className="absolute bottom-4 left-0 w-full px-6 flex justify-between items-end pointer-events-none">
                            <div className="flex flex-col"><span className="text-[9px] text-gray-500 font-mono mb-1">SELECTED ZONE</span><span className="text-2xl font-display font-black text-white leading-none drop-shadow-md">{activeMuscle.name}</span></div>
                            <div className="flex flex-col items-end"><span className="text-[9px] text-gray-500 font-mono mb-1">VOLUME LOAD</span><div className="flex items-baseline gap-1"><span className="text-2xl font-display font-black leading-none" style={{ color: activeMuscle.color }}>{(activeMuscle.volume / 1000).toFixed(1)}</span><span className="text-xs font-bold text-gray-400">k</span></div></div>
                        </div>
                    </div>
                    <div className="bg-[#080808] border-t border-white/10 shrink-0 p-1">
                        <div className="flex justify-center gap-4 py-3 flex-wrap">
                            {MUSCLES_T.slice(0, 4).map(m => (<div key={m.id} className="flex items-center gap-1.5 opacity-70 hover:opacity-100 transition-opacity cursor-default"><div className="w-2 h-2 rounded-full shadow-[0_0_5px_currentColor]" style={{ backgroundColor: m.color }}></div><span className="text-[9px] font-bold text-gray-300 uppercase tracking-wide">{m.name}</span></div>))}
                            <div className="flex items-center gap-1.5 opacity-50"><span className="text-[9px] font-bold text-gray-500">+{MUSCLES_T.length - 4} MORE</span></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 7. BIO SCANNER (DNA Helix + Body Composition) - CONNECTED TO STATSDATA
        const BioScanner = () => {
            const canvasRef = useRef(null);
            
            const bodyData = window.StatsData ? window.StatsData.getBodyComposition() : {
                currentWeight: 74.5, startWeight: 80.2, goalWeight: 70.0, bodyFat: 14.2, height: 178
            };
            
            const { currentWeight, startWeight, goalWeight, bodyFat, height } = bodyData;
            const progress = ((startWeight - currentWeight) / (startWeight - goalWeight)) * 100;
            const bmi = (currentWeight / ((height / 100) ** 2)).toFixed(1);
            const leanMass = (currentWeight * (1 - bodyFat / 100)).toFixed(1);
            const fatMass = (currentWeight * (bodyFat / 100)).toFixed(1);
            
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                let time = 0;
                let animId;

                const render = () => {
                    const w = canvas.width = canvas.clientWidth * 2;
                    const h = canvas.height = canvas.clientHeight * 2;
                    ctx.scale(2, 2);
                    ctx.clearRect(0, 0, w, h);
                    time += 0.02;

                    const strands = 2;
                    const amplitude = 25;
                    const period = 80;
                    const particlesPerStrand = 18;
                    const cw = canvas.clientWidth;
                    const ch = canvas.clientHeight;

                    for (let s = 0; s < strands; s++) {
                        const offset = s * Math.PI;
                        for (let i = 0; i < particlesPerStrand; i++) {
                            const y = (i / particlesPerStrand) * ch;
                            const x = cw / 2 + Math.sin((y / period) + time + offset) * amplitude;
                            
                            ctx.beginPath();
                            ctx.arc(x, y, 4, 0, Math.PI * 2);
                            ctx.fillStyle = s === 0 ? '#06b6d4' : '#d946ef';
                            ctx.shadowBlur = 8;
                            ctx.shadowColor = s === 0 ? '#06b6d4' : '#d946ef';
                            ctx.fill();
                            ctx.shadowBlur = 0;
                            
                            if (s === 0) {
                                const x2 = cw / 2 + Math.sin((y / period) + time + Math.PI) * amplitude;
                                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                                ctx.lineWidth = 1;
                                ctx.beginPath();
                                ctx.moveTo(x, y);
                                ctx.lineTo(x2, y);
                                ctx.stroke();
                            }
                        }
                    }

                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                    animId = requestAnimationFrame(render);
                };
                
                render();
                return () => cancelAnimationFrame(animId);
            }, []);

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden min-h-[420px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-cyan-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Scale className="text-cyan-500" size={18} />
                                BIO.SCANNER
                            </h2>
                            <p className="text-[10px] text-cyan-500/60 font-mono font-bold mt-1">COMPOSITION ANALYSIS</p>
                        </div>
                        <div className="px-2 py-1 bg-emerald-500/10 border border-emerald-500/30 rounded text-[10px] text-emerald-400 font-mono font-bold">
                            ATHLETE
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] relative flex flex-col items-center justify-center p-6">
                        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-purple-900/10 via-transparent to-transparent pointer-events-none"></div>
                        
                        <div className="flex w-full items-center justify-between relative z-10">
                            <div className="text-right flex-1">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1 tracking-wider">Current Mass</div>
                                <div className="text-4xl font-display font-black text-white leading-none">
                                    {currentWeight}<span className="text-lg text-gray-600 ml-1">kg</span>
                                </div>
                                <div className="text-xs text-emerald-400 flex items-center justify-end gap-1 mt-2">
                                    <TrendingDown size={12}/> -{(startWeight - currentWeight).toFixed(1)}kg
                                </div>
                            </div>

                            <div className="w-24 h-52 relative mx-4 flex-shrink-0">
                                <canvas ref={canvasRef} className="w-full h-full" style={{ imageRendering: 'crisp-edges' }} />
                            </div>

                            <div className="text-left flex-1">
                                <div className="text-[9px] text-gray-500 uppercase font-mono mb-1 tracking-wider">Adipose Tissue</div>
                                <div className="text-4xl font-display font-black text-white leading-none">
                                    {bodyFat}<span className="text-lg text-gray-600 ml-1">%</span>
                                </div>
                                <div className="text-xs text-cyan-400 mt-2 font-bold uppercase tracking-wide">
                                    Athlete Zone
                                </div>
                            </div>
                        </div>

                        <div className="w-full mt-8 relative z-10">
                            <div className="flex justify-between text-[9px] font-mono text-gray-500 mb-2">
                                <span>START: {startWeight}kg</span>
                                <span className="text-cyan-400 font-bold">{progress.toFixed(0)}%</span>
                                <span>GOAL: {goalWeight}kg</span>
                            </div>
                            <div className="h-2 bg-gray-800/50 rounded-full overflow-hidden relative border border-white/5">
                                <div 
                                    className="absolute inset-y-0 left-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-fuchsia-500 rounded-full transition-all duration-1000"
                                    style={{ width: `${Math.min(progress, 100)}%` }}
                                ></div>
                                <div 
                                    className="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-[0_0_10px_white,0_0_20px_rgba(255,255,255,0.5)] border-2 border-cyan-400 transition-all duration-1000"
                                    style={{ left: `calc(${Math.min(progress, 100)}% - 6px)` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-[#080808] border-t border-white/10 px-6 py-4">
                        <div className="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">BMI</div>
                                <div className="text-lg font-display font-bold text-white">{bmi}</div>
                            </div>
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">Lean Mass</div>
                                <div className="text-lg font-display font-bold text-cyan-400">{leanMass}<span className="text-xs text-gray-500">kg</span></div>
                            </div>
                            <div>
                                <div className="text-[9px] text-gray-500 font-mono uppercase mb-1">Fat Mass</div>
                                <div className="text-lg font-display font-bold text-purple-400">{fatMass}<span className="text-xs text-gray-500">kg</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 8. BIO SYNTHETICS (Morphological Scanner with Hex Body) - CONNECTED TO STATSDATA
        const BioSynthetics = () => {
            const morphData = window.StatsData ? window.StatsData.getMorphologyData() : null;
            
            const MUSCLE_DATA = morphData ? [
                { id: 'chest', label: 'PECTORALIS', score: morphData.muscles.find(m => m.label === 'PECTORAUX')?.score || 50, symmetry: 52, type: 'push', sets: morphData.muscles.find(m => m.label === 'PECTORAUX')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'PECTORAUX')?.volume || 0 },
                { id: 'back', label: 'DORSALS', score: morphData.muscles.find(m => m.label === 'DOS')?.score || 50, symmetry: 48, type: 'pull', sets: morphData.muscles.find(m => m.label === 'DOS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'DOS')?.volume || 0 },
                { id: 'shoulders', label: 'DELTOIDS', score: morphData.muscles.find(m => m.label === 'ÉPAULES')?.score || 50, symmetry: 50, type: 'push', sets: morphData.muscles.find(m => m.label === 'ÉPAULES')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'ÉPAULES')?.volume || 0 },
                { id: 'arms', label: 'BRACHII', score: morphData.muscles.find(m => m.label === 'BRAS')?.score || 50, symmetry: 45, type: 'pull', sets: morphData.muscles.find(m => m.label === 'BRAS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'BRAS')?.volume || 0 },
                { id: 'legs', label: 'QUADRICEPS', score: morphData.muscles.find(m => m.label === 'JAMBES')?.score || 50, symmetry: 50, type: 'legs', sets: morphData.muscles.find(m => m.label === 'JAMBES')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'JAMBES')?.volume || 0 },
                { id: 'core', label: 'ABDOMINALS', score: morphData.muscles.find(m => m.label === 'ABDOS')?.score || 20, symmetry: 50, type: 'pull', sets: morphData.muscles.find(m => m.label === 'ABDOS')?.sets || 0, volume: morphData.muscles.find(m => m.label === 'ABDOS')?.volume || 0 },
            ] : [
                { id: 'chest', label: 'PECTORALIS', score: 50, symmetry: 52, type: 'push', sets: 0, volume: 0 },
                { id: 'back', label: 'DORSALS', score: 50, symmetry: 48, type: 'pull', sets: 0, volume: 0 },
                { id: 'shoulders', label: 'DELTOIDS', score: 50, symmetry: 50, type: 'push', sets: 0, volume: 0 },
                { id: 'arms', label: 'BRACHII', score: 50, symmetry: 45, type: 'pull', sets: 0, volume: 0 },
                { id: 'legs', label: 'QUADRICEPS', score: 50, symmetry: 50, type: 'legs', sets: 0, volume: 0 },
                { id: 'core', label: 'ABDOMINALS', score: 20, symmetry: 50, type: 'pull', sets: 0, volume: 0 },
            ];
            
            const distribution = morphData?.distribution || { push: 33, pull: 34, legs: 33 };

            const [selectedZone, setSelectedZone] = useState(MUSCLE_DATA[0]);

            const getTypeColor = (type) => {
                if (type === 'push') return '#ef4444';
                if (type === 'pull') return '#3b82f6';
                return '#eab308';
            };

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[600px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-blue-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <User className="text-blue-500" size={18} />
                                BIO.SYNTHETICS
                            </h2>
                            <p className="text-[10px] text-blue-500/60 font-mono font-bold mt-1 flex items-center gap-1">
                                <ScanLine size={10} className="animate-spin-slow"/>
                                MORPHOLOGICAL SCAN
                            </p>
                        </div>
                        <div className="px-2 py-1 rounded border border-blue-500/30 text-[10px] font-black uppercase tracking-wider bg-blue-500/10 text-blue-400">
                            SYMMETRY: 92%
                        </div>
                    </div>

                    <div className="relative bg-[#010101] flex-1 p-4 flex flex-col items-center justify-center overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.05)_1px,transparent_1px)] bg-[size:40px_40px]"></div>

                        <div className="relative w-[300px] h-[400px]">
                            <div className="absolute left-0 right-0 h-[2px] bg-blue-400 shadow-[0_0_15px_#3b82f6] z-30 pointer-events-none animate-scan opacity-80"></div>
                            <div className="absolute left-0 right-0 h-[20px] bg-gradient-to-b from-blue-500/20 to-transparent z-30 pointer-events-none animate-scan"></div>

                            <svg viewBox="0 0 200 300" className="w-full h-full drop-shadow-2xl">
                                <defs>
                                    <filter id="glowBody">
                                        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                        <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                    </filter>
                                </defs>

                                <path d="M 100 20 L 115 30 L 115 50 L 100 60 L 85 50 L 85 30 Z" fill="#111" stroke="#333" strokeWidth="1" />
                                
                                <g onClick={() => setSelectedZone(MUSCLE_DATA[0])} className="cursor-pointer">
                                    <path d="M 100 65 L 130 65 L 125 95 L 100 105 L 75 95 L 70 65 Z" 
                                        fill={selectedZone.id === 'chest' ? '#ef4444' : '#1a0505'} 
                                        stroke="#ef4444" 
                                        strokeWidth={selectedZone.id === 'chest' ? 2 : 1}
                                        className="transition-colors duration-300"
                                        opacity={selectedZone.id === 'chest' ? 1 : 0.6}
                                    />
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[5])} className="cursor-pointer">
                                    <path d="M 100 105 L 120 100 L 120 130 L 100 140 L 80 130 L 80 100 Z" 
                                        fill={selectedZone.id === 'core' ? '#3b82f6' : '#050a1a'} 
                                        stroke="#3b82f6" 
                                        strokeWidth={selectedZone.id === 'core' ? 2 : 1}
                                        opacity={selectedZone.id === 'core' ? 1 : 0.6}
                                    />
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[2])} className="cursor-pointer">
                                    <circle cx="65" cy="70" r="12" fill={selectedZone.id === 'shoulders' ? '#ef4444' : '#111'} stroke="#ef4444" opacity="0.8"/>
                                    <circle cx="135" cy="70" r="12" fill={selectedZone.id === 'shoulders' ? '#ef4444' : '#111'} stroke="#ef4444" opacity="0.8"/>
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[3])} className="cursor-pointer">
                                    <rect x="50" y="85" width="15" height="40" rx="5" fill={selectedZone.id === 'arms' ? '#3b82f6' : '#111'} stroke="#3b82f6"/>
                                    <rect x="135" y="85" width="15" height="40" rx="5" fill={selectedZone.id === 'arms' ? '#3b82f6' : '#111'} stroke="#3b82f6"/>
                                </g>

                                <g onClick={() => setSelectedZone(MUSCLE_DATA[4])} className="cursor-pointer">
                                    <path d="M 100 140 L 130 150 L 125 220 L 105 230 L 100 180 Z" fill={selectedZone.id === 'legs' ? '#eab308' : '#1a1a05'} stroke="#eab308"/>
                                    <path d="M 100 140 L 100 180 L 95 230 L 75 220 L 70 150 Z" fill={selectedZone.id === 'legs' ? '#eab308' : '#1a1a05'} stroke="#eab308"/>
                                </g>
                            </svg>

                            <div className="absolute top-10 left-0">
                                <div className="flex items-center gap-1 text-[9px] text-red-500 font-bold bg-red-900/20 px-2 py-0.5 rounded border border-red-500/30">
                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></span> PUSH {distribution.push}%
                                </div>
                            </div>
                            <div className="absolute top-20 right-0">
                                <div className="flex items-center gap-1 text-[9px] text-blue-500 font-bold bg-blue-900/20 px-2 py-0.5 rounded border border-blue-500/30">
                                    <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span> PULL {distribution.pull}%
                                </div>
                            </div>
                            <div className="absolute bottom-20 left-0">
                                <div className="flex items-center gap-1 text-[9px] text-yellow-500 font-bold bg-yellow-900/20 px-2 py-0.5 rounded border border-yellow-500/30">
                                    <span className="w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"></span> LEGS {distribution.legs}%
                                </div>
                            </div>
                        </div>

                        <div className="w-full bg-[#080808] border border-white/10 rounded-xl p-3 mb-2 relative overflow-hidden">
                            <div className="flex justify-between text-[9px] font-mono text-gray-500 mb-1">
                                <span>LEFT SIDE</span>
                                <span className="text-white font-bold">LATERAL BALANCE</span>
                                <span>RIGHT SIDE</span>
                            </div>
                            <div className="h-2 bg-gray-800 rounded-full relative">
                                <div className="absolute top-0 bottom-0 left-1/2 w-0.5 bg-white z-10"></div>
                                <div 
                                    className="absolute top-0 bottom-0 bg-blue-500 rounded-full transition-all duration-500"
                                    style={{ 
                                        left: selectedZone.symmetry > 50 ? '50%' : `${selectedZone.symmetry}%`, 
                                        right: selectedZone.symmetry > 50 ? `${100 - selectedZone.symmetry}%` : '50%',
                                        backgroundColor: selectedZone.symmetry === 50 ? '#10b981' : Math.abs(50 - selectedZone.symmetry) > 5 ? '#ef4444' : '#3b82f6'
                                    }}
                                ></div>
                            </div>
                            <div className="flex justify-between text-[8px] font-mono text-gray-600 mt-1">
                                <span>{(100 - selectedZone.symmetry)}%</span>
                                <span className={Math.abs(50 - selectedZone.symmetry) > 5 ? "text-red-500" : "text-green-500"}>
                                    {Math.abs(50 - selectedZone.symmetry) < 2 ? 'PERFECT' : 'IMBALANCE DETECTED'}
                                </span>
                                <span>{selectedZone.symmetry}%</span>
                            </div>
                        </div>
                    </div>

                    <div className="bg-[#080808] border-t border-white/10 p-5">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-white/5 rounded-lg border border-white/10 flex items-center justify-center">
                                    <Layers size={18} style={{color: getTypeColor(selectedZone.type)}} />
                                </div>
                                <div>
                                    <h3 className="text-white font-display font-bold text-lg leading-none">{selectedZone.label}</h3>
                                    <p className="text-[10px] text-gray-500 font-mono uppercase mt-1">
                                        Type: <span style={{color: getTypeColor(selectedZone.type)}}>{selectedZone.type.toUpperCase()}</span>
                                    </p>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-black text-white">{selectedZone.score}<span className="text-sm text-gray-600">%</span></div>
                                <div className="text-[8px] text-gray-500 font-black uppercase tracking-widest">Activation</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-2">
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">SETS</div>
                                <div className="text-sm font-bold text-white">{selectedZone.sets || 0}</div>
                            </div>
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">VOL</div>
                                <div className="text-sm font-bold text-white">{selectedZone.volume ? (selectedZone.volume / 1000).toFixed(1) + 'k' : '0'}</div>
                            </div>
                            <div className="bg-[#111] p-2 rounded text-center border border-white/5">
                                <div className="text-[8px] text-gray-500">FREQ</div>
                                <div className="text-sm font-bold text-white">{Math.ceil(selectedZone.sets / 4) || 0}x</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 9. CHALLENGE SYSTEM (Special Ops / Bounties) - CONNECTED TO STATSDATA
        const ChallengeSystem = () => {
            const challenges = window.StatsData ? window.StatsData.getChallengesData() : [
                { id: 1, title: 'IRON CLAD', desc: 'Soulever 100T en un mois', progress: 0, target: 100, reward: 'Titan Badge', color: 'cyan' },
                { id: 2, title: 'VELOCITY', desc: 'Maintenir densité >500kg/min pour 3 séances', progress: 0, target: 3, reward: 'Speed Demon', color: 'orange' },
                { id: 3, title: 'WIDOWMAKER', desc: 'Série de 20 reps au Squat', progress: 0, target: 1, reward: 'Legs of Steel', color: 'red' },
            ];

            const colors = {
                cyan: { text: 'text-cyan-400', bg: 'bg-cyan-500', border: 'border-cyan-500/30' },
                orange: { text: 'text-orange-400', bg: 'bg-orange-500', border: 'border-orange-500/30' },
                red: { text: 'text-red-400', bg: 'bg-red-500', border: 'border-red-500/30' },
                purple: { text: 'text-purple-400', bg: 'bg-purple-500', border: 'border-purple-500/30' }
            };

            const completedCount = challenges.filter(c => (c.progress / c.target) >= 1).length;

            return (
                <div className="relative w-full max-w-md bg-[#020202] border border-white/10 rounded-3xl flex flex-col overflow-hidden group min-h-[500px] shadow-2xl hover:border-white/20 transition-all">
                    
                    <div className="bg-[#050505] px-6 py-4 border-b border-white/10 flex justify-between items-center z-10 relative">
                        <div className="absolute inset-0 bg-yellow-900/5"></div>
                        <div className="relative z-10">
                            <h2 className="font-display font-black text-white tracking-widest uppercase flex items-center gap-2 text-lg">
                                <Crosshair className="text-yellow-500" size={18} />
                                SPECIAL OPS
                            </h2>
                            <p className="text-[10px] text-yellow-600 font-mono font-bold mt-1">ACTIVE BOUNTIES</p>
                        </div>
                        <div className="flex -space-x-2">
                            {completedCount > 0 && (
                                <div className="w-6 h-6 rounded-full bg-emerald-500 border-2 border-black flex items-center justify-center text-[10px] font-bold text-black">{completedCount}</div>
                            )}
                            <div className="w-6 h-6 rounded-full bg-yellow-500 border-2 border-black flex items-center justify-center text-[10px] font-bold text-black">{challenges.length}</div>
                        </div>
                    </div>

                    <div className="flex-1 bg-[#010101] p-6 flex flex-col gap-4">
                        {challenges.map(challenge => {
                            const pct = Math.min((challenge.progress / challenge.target) * 100, 100);
                            const isDone = pct >= 100;
                            const c = colors[challenge.color] || colors.cyan;

                            return (
                                <div key={challenge.id} className={`bg-[#0a0a0a] border rounded-xl p-4 relative overflow-hidden group hover:bg-[#111] transition-colors ${c.border}`}>
                                    <Target className="absolute -right-4 -bottom-4 text-white/5 group-hover:scale-110 transition-transform duration-500" size={80} />
                                    
                                    <div className="flex justify-between items-start mb-2 relative z-10">
                                        <div>
                                            <div className={`text-[9px] font-black uppercase tracking-widest mb-1 ${c.text}`}>OPERATION</div>
                                            <h3 className="text-white font-display font-bold text-xl">{challenge.title}</h3>
                                        </div>
                                        <div className={`p-1.5 rounded border ${isDone ? 'bg-emerald-500/20 border-emerald-500/50' : 'bg-white/5 border-white/10'}`}>
                                            {isDone ? <Check size={14} className="text-emerald-400"/> : <Target size={14} className="text-gray-500"/>}
                                        </div>
                                    </div>
                                    
                                    <p className="text-xs text-gray-400 font-mono mb-4 relative z-10">{challenge.desc}</p>
                                    
                                    <div className="relative z-10">
                                        <div className="flex justify-between text-[9px] font-bold text-gray-500 mb-1">
                                            <span>PROGRESS</span>
                                            <span className={isDone ? 'text-emerald-400' : ''}>{challenge.progress} / {challenge.target}</span>
                                        </div>
                                        <div className="h-1.5 w-full bg-gray-800 rounded-full overflow-hidden">
                                            <div className={`h-full ${isDone ? 'bg-emerald-500' : c.bg} transition-all duration-1000`} style={{width: `${pct}%`}}></div>
                                        </div>
                                    </div>

                                    <div className="mt-3 flex items-center gap-2 text-[9px] text-gray-300 font-bold bg-white/5 w-fit px-2 py-1 rounded relative z-10 border border-white/5">
                                        <Trophy size={10} className="text-yellow-400"/>
                                        REWARD: {challenge.reward}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [loading, setLoading] = useState(true);
            const [bootStep, setBootStep] = useState(0);
            const [importMessage, setImportMessage] = useState(null);
            
            // --- DATA INTEGRATION FROM STATSDATA ---
            const [summary, setSummary] = useState({ score: 0, sessions: 0, maxSessions: 5, sets: 0, maxSets: 60, volume: 0, xp: 0 });
            const [zones, setZones] = useState(getZones());
            const [musclesTurbine, setMusclesTurbine] = useState(getMusclesTurbine());
            const [musclesHUD, setMusclesHUD] = useState(getMusclesHUD());
            const [weeksData, setWeeksData] = useState(getWeeksData());

            const refreshData = () => {
                if (window.StatsData) {
                    const s = window.StatsData.getSummary();
                    setSummary(s);
                    setZones(getZones());
                    setMusclesTurbine(getMusclesTurbine());
                    setMusclesHUD(getMusclesHUD());
                    setWeeksData(getWeeksData());
                }
            };

            useEffect(() => {
                refreshData();
                window.addEventListener('storage', refreshData);
                const interval = setInterval(refreshData, 5000);
                return () => {
                    window.removeEventListener('storage', refreshData);
                    clearInterval(interval);
                };
            }, []);

            const handleExport = () => {
                if (window.StatsData) {
                    window.StatsData.downloadBackup();
                    setImportMessage({ type: 'success', text: 'Backup téléchargé!' });
                    setTimeout(() => setImportMessage(null), 3000);
                }
            };

            const handleImport = () => {
                if (window.StatsData) {
                    window.StatsData.triggerImport((result) => {
                        setImportMessage({ type: result.success ? 'success' : 'error', text: result.message });
                        if (result.success) refreshData();
                        setTimeout(() => setImportMessage(null), 3000);
                    });
                }
            };

            // Boot Sequence
            useEffect(() => {
                if (!loading) return;
                const timeouts = [
                    setTimeout(() => setBootStep(1), 500),
                    setTimeout(() => setBootStep(2), 1200),
                    setTimeout(() => setBootStep(3), 2000),
                    setTimeout(() => setLoading(false), 2800),
                ];
                return () => timeouts.forEach(clearTimeout);
            }, [loading]);
            
            // Scramble Effect on title after loading
            useEffect(() => {
                if (loading) return;
                if (window.ScrambleEffect) {
                    const title = document.querySelector('h1.font-display');
                    const footer = document.querySelector('footer .font-mono');
                    if (title) window.ScrambleEffect.scramble(title, { delay: 100, speed: 25 });
                    if (footer) window.ScrambleEffect.scramble(footer, { delay: 300, speed: 20 });
                }
            }, [loading]);

            if (loading) {
                return (
                    <div className="fixed inset-0 bg-[#020202] text-cyan-500 font-mono z-50 flex flex-col items-center justify-center p-8 select-none">
                        <div className="w-full max-w-[300px] flex flex-col gap-4">
                            <div className="flex justify-between items-center border-b border-cyan-900/50 pb-2 mb-4">
                                <span className="text-xs font-bold tracking-[0.2em] animate-pulse">NEON.FIT V2.5</span>
                                <Power size={14} className="animate-spin-slow"/>
                            </div>
                            <div className="space-y-1 text-[10px] uppercase tracking-wider text-cyan-700">
                                <div className={bootStep >= 0 ? 'text-cyan-400' : ''}>[ SYSTEM_BOOT ] ... OK</div>
                                <div className={bootStep >= 1 ? 'text-cyan-400' : ''}>[ MEMORY_CHECK ] ... 64TB OK</div>
                                <div className={bootStep >= 2 ? 'text-cyan-400' : ''}>[ LOADING_USER_DATA ] ... OK</div>
                                <div className={bootStep >= 3 ? 'text-cyan-400' : ''}>[ ESTABLISHING_LINK ] ... SECURE</div>
                            </div>
                            <div className="h-1 w-full bg-cyan-900/30 mt-8 relative overflow-hidden"><div className="absolute inset-y-0 left-0 bg-cyan-400 animate-[slideIn_2.5s_ease-out_forwards]"></div></div>
                            <div className="mt-2 text-center text-xs text-cyan-600 animate-pulse">{bootStep === 3 ? 'ACCESS GRANTED' : 'INITIALIZING...'}</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#010101] text-white font-sans overflow-x-hidden relative selection:bg-cyan-500/30 pb-20">
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-fuchsia-900/10 blur-[120px] rounded-full mix-blend-screen"></div>
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 [mask-image:linear-gradient(to_bottom,transparent,black_80%)]"></div>
                    </div>
                    
                    <header className="sticky top-0 left-0 w-full z-40 bg-[#010101]/80 backdrop-blur-lg border-b border-white/5 transition-all duration-300">
                        <div className="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
                            <div><h1 className="font-display font-black text-xl tracking-tighter text-white flex items-center gap-1"><Fingerprint size={18} className="text-cyan-400" />NEON<span className="text-cyan-400">.FIT</span></h1></div>
                            <div className="flex gap-2">
                                <button onClick={handleExport} className="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/20 transition-all active:scale-95" title="Exporter backup"><Download size={14} /></button>
                                <button onClick={handleImport} className="w-8 h-8 flex items-center justify-center rounded-full bg-blue-500/10 border border-blue-500/30 text-blue-400 hover:bg-blue-500/20 transition-all active:scale-95" title="Importer backup"><Plus size={14} /></button>
                                <button onClick={refreshData} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:bg-white/10 transition-all active:scale-95"><RotateCcw size={14} /></button>
                            </div>
                        </div>
                        {importMessage && (
                            <div className={`mx-4 mb-2 px-4 py-2 rounded-lg text-sm font-medium ${importMessage.type === 'success' ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' : 'bg-red-500/20 text-red-400 border border-red-500/30'}`}>
                                {importMessage.text}
                            </div>
                        )}
                    </header>

                    <main className="relative z-10 w-full max-w-md mx-auto px-4 py-6 flex flex-col gap-6">
                        <div className="animate-slideIn" style={{ animationDelay: '0.1s' }}><NeonTracker score={summary.score} sessions={{ current: summary.sessions, max: summary.maxSessions }} sets={{ current: summary.sets, max: summary.maxSets }} status={summary.score > 80 ? 'consistent' : 'warning'} /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.2s' }}><ActivityChart /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.3s' }}><WeeklyProgress weeksData={weeksData} summary={summary} /></div>
                        <div className="animate-slideIn" style={{ animationDelay: '0.4s' }}><VolumeGauge volume={summary.volume} maxVolume={25000} stats={{ sets: summary.sets, tut: 2450, sessions: summary.sessions }} /></div>
                        <div className="grid gap-6">
                            <div className="animate-slideIn" style={{ animationDelay: '0.4s' }}><MuscleWorkload musclesTurbineData={musclesTurbine} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.5s' }}><IntensityZones zonesData={zones} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.6s' }}><MuscleHud musclesData={musclesHUD} /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.7s' }}><BioScanner /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.8s' }}><BioSynthetics /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '0.9s' }}><ChallengeSystem /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.0s' }}><CommandCenter /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.1s' }}><ConsistencyLog /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.2s' }}><HybridCore /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.3s' }}><InjuryMap /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.4s' }}><MorphoTimeline /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.5s' }}><NutritionFuel /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.6s' }}><PilotProfile /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.7s' }}><PowerMetrics /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.8s' }}><SeasonTrack /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '1.9s' }}><SleepCycle /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '2.0s' }}><SynergyLink /></div>
                            <div className="animate-slideIn" style={{ animationDelay: '2.1s' }}><TemporalEngine /></div>
                        </div>
                    </main>

                    <footer className="fixed bottom-0 left-0 w-full bg-[#050505]/90 backdrop-blur border-t border-white/5 py-4 z-40">
                        <div className="max-w-md mx-auto flex justify-center text-[10px] text-gray-600 font-mono tracking-widest uppercase">// END OF STREAM //</div>
                    </footer>
                </div>
            );
        };

        // RENDER
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
